<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="zhywyt" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="zhywyt&#39;s blog">
<meta property="og:url" content="https://hexothemedemo.github.io/page/8/index.html">
<meta property="og:site_name" content="zhywyt&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhywyt">
<meta name="twitter:card" content="summary">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="zhywyt&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/Yelee/css/style.css">



    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>zhywyt&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: 
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/Yelee/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/Yelee/"></a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/Yelee/">主页</a></li>
                        
                            <li><a href="/Yelee/archives/">所有文章</a></li>
                        
                            <li><a href="/Yelee/tags/">标签云</a></li>
                        
                            <li><a href="/Yelee/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/Yelee/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/encrypt/" rel="tag">encrypt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E5%8D%9A%E5%AE%A2/" rel="tag">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/" rel="tag">技术文档</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E8%AF%97%E4%B8%8E%E6%95%A3%E6%96%87/" rel="tag">诗与散文</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3/" rel="tag">错误解决</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/Yelee/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/Yelee/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/Yelee/">主页</a></li>
                
                    <li><a href="/Yelee/archives/">所有文章</a></li>
                
                    <li><a href="/Yelee/tags/">标签云</a></li>
                
                    <li><a href="/Yelee/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/Yelee/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-CG/games系列课程/games101/games101 HomeWork1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/6295/" class="article-date">
      <time datetime="2023-07-23T19:20:00.000Z" itemprop="datePublished">2023-07-23</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/6295/">games101 HomeWork1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="games101-HomeWork-1"><a href="#games101-HomeWork-1" class="headerlink" title="games101 HomeWork 1"></a>games101 HomeWork 1</h1><p><strong>说起来我自己写games101的作业也是曲曲折折，虚拟机很卡就拿VS配环境，Windows不会配环境，就装Linux，现在装上了Linux，却因为没有经验把Windows格式化了（我是真的沙比），好在还是开始做了，也挺顺利的，所以再来记录一下作业。</strong></p>
<p><code>这里是作业框架的下载</code><a target="_blank" rel="noopener" href="https://github.com/zhywyt/games101HomeWork/blob/master/GAMES101_Homework_S2021.zip">作业框架下载</a></p>
<h2 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">导航</a></p>
<h2 id="基础部分"><a href="#基础部分" class="headerlink" title="基础部分"></a>基础部分</h2><p><strong>这里需要完成两个函数，一个是模型变换矩阵，一个是透视投影矩阵。</strong></p>
<h3 id="模型变换矩阵"><a href="#模型变换矩阵" class="headerlink" title="模型变换矩阵"></a>模型变换矩阵</h3><p><strong>逐个元素地构建模型变换矩阵并返回该矩阵。在此函数中，你只需要实现三维中绕 z 轴旋转的变换矩阵，而不用处理平移与缩放。</strong><br>这个部分的实现非常简单，只需要记住这个公式就好了。这里给出绕三个轴旋转的旋转矩阵：</p>
<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723163718966-702050321_1726324482509.png" alt="image"><br>代码实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Matrix4f <span class="title function_">get_model_matrix</span><span class="params">(<span class="type">float</span> rotation_angle)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Matrix4f model = Eigen::Matrix4f::Identity();</span><br><span class="line">	<span class="comment">//角度制转弧度制</span></span><br><span class="line">    rotation_angle = rotation_angle / <span class="number">180.0f</span> * MY_PI;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement this function</span></span><br><span class="line">    <span class="comment">// Create the model matrix for rotating the triangle around the Z axis.</span></span><br><span class="line">    <span class="comment">// Then return it.</span></span><br><span class="line">    model &lt;&lt; <span class="built_in">cos</span>(rotation_angle), -<span class="built_in">sin</span>(rotation_angle), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="built_in">sin</span>(rotation_angle), <span class="built_in">cos</span>(rotation_angle), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="透视投影矩阵"><a href="#透视投影矩阵" class="headerlink" title="透视投影矩阵"></a>透视投影矩阵</h3><p><strong>使用给定的参数逐个元素地构建透视投影矩阵并返回<br>该矩阵。</strong><br>这个题目的参数定义其实不是很明显（至少位蒙b了很久），先看一下函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Matrix4f <span class="title function_">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio, <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span><br></pre></td></tr></table></figure>

<p>来解读一下前两个参数，<code>eye_fov</code>指的是摄像机的垂直可视角度，<code>aspect_ratio</code>指的是摄像机的长宽比。使用这四个值也能算出正交投影矩阵。（下图只供参考）<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723170957949-2034192099_1726324482509.png" alt="image"></p>
<p>我们从<strong>透视投影矩阵</strong>开始：<br>根据课堂上的推导，我们已经知道透视投影矩阵的最终结果，并且所需要的值只有<code>zNear</code>和<code>zFar</code>，于是我们能直接写出这个矩阵：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">P &lt;&lt; zNear, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, zNear, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, zNear + zFar, -zNear * zFar,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>然后是我们的<strong>正交投影</strong>部分了，正交投影需要用到的数据有六个，分别是长方体的参数。<br><strong>$$[l,r]\times[b,t]\times[f,n]$$</strong><br>先把正的数据处理掉，直接给出答案，再证明</p>
<ul>
<li>\(t&#x3D;zNear*tan(eye\_fov&#x2F;2)\)<strong>（弧度化后）</strong></li>
<li>\(r&#x3D;t*aspect\_ratio\)<br>另外的<code>l</code>和<code>b</code>分别等于<code>r</code>和<code>t</code>的相反数。<br><strong>证明如下：（仅供参考）</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723192721320-985482425_1726324498534.png" alt="image"></li>
</ul>
<p>最后还剩下<code>n</code>和<code>f</code>，这两个数和他们的名字差别很大，分别是后和前，赋值的时候需要小心，而且他们的值并不是zNear和zFar分别赋值，而是相反数赋值。如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = -zNear;</span><br><span class="line">n = -zFar;</span><br></pre></td></tr></table></figure>

<p>有了数据，我们就可进行投影矩阵的实现了，正交投影矩阵如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">      eye_fov = eye_fov / <span class="number">180</span> * MY_PI;</span><br><span class="line">      <span class="type">float</span> l, r, b, t, n, f;</span><br><span class="line">      <span class="comment">//注意这里的f和n代表的意义</span></span><br><span class="line">      f = -zNear;</span><br><span class="line">      n = -zFar;</span><br><span class="line">      t = -zNear * <span class="built_in">tan</span>(eye_fov/<span class="number">2</span>);</span><br><span class="line">      b = -t;</span><br><span class="line">      r = t * aspect_ratio;</span><br><span class="line">      l = -r;</span><br><span class="line">      S &lt;&lt; <span class="number">2</span> / (r - l), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">          <span class="number">0</span>, <span class="number">2</span> / (t - b), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">          <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span> / (n - f), <span class="number">0</span>,</span><br><span class="line">          <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">      M &lt;&lt; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -(r + l) / <span class="number">2</span>,</span><br><span class="line">          <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -(t + b) / <span class="number">2</span>,</span><br><span class="line">          <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -(n + f) / <span class="number">2</span>,</span><br><span class="line">          <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"><span class="comment">//S*M得到正交投影矩阵</span></span><br></pre></td></tr></table></figure>

<p>普通要求代码汇总</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp</span></span><br><span class="line"><span class="type">bool</span> ProjectMode=<span class="literal">true</span>;<span class="comment">//这是一个控制模式的参数</span></span><br><span class="line">Eigen::Matrix4f <span class="title function_">get_model_matrix</span><span class="params">(<span class="type">float</span> rotation_angle)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Matrix4f model = Eigen::Matrix4f::Identity();</span><br><span class="line">    rotation_angle = rotation_angle / <span class="number">180.0f</span> * MY_PI;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement this function</span></span><br><span class="line">    <span class="comment">// Create the model matrix for rotating the triangle around the Z axis.</span></span><br><span class="line">    <span class="comment">// Then return it.</span></span><br><span class="line">    model &lt;&lt; <span class="built_in">cos</span>(rotation_angle), -<span class="built_in">sin</span>(rotation_angle), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="built_in">sin</span>(rotation_angle), <span class="built_in">cos</span>(rotation_angle), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br><span class="line">Eigen::Matrix4f <span class="title function_">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio,</span></span><br><span class="line"><span class="params">                                      <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Students will implement this function</span></span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f projection = Eigen::Matrix4f::Identity();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement this function</span></span><br><span class="line">    <span class="comment">// Create the projection matrix for the given parameters.</span></span><br><span class="line">    <span class="comment">// Then return it.</span></span><br><span class="line">    <span class="keyword">if</span> (!ProjectMode)</span><br><span class="line">    &#123;</span><br><span class="line">        Eigen::Matrix4f S, M, P;</span><br><span class="line">        eye_fov = eye_fov / <span class="number">180</span> * MY_PI;</span><br><span class="line">        <span class="type">float</span> l, r, b, t, n, f;</span><br><span class="line">        <span class="comment">//注意这里的f和n代表的意义</span></span><br><span class="line">        f = -zNear;</span><br><span class="line">        n = -zFar;</span><br><span class="line">        t = -zNear * <span class="built_in">tan</span>(eye_fov/<span class="number">2</span>);</span><br><span class="line">        b = -t;</span><br><span class="line">        r = t * aspect_ratio;</span><br><span class="line">        l = -r;</span><br><span class="line">        S &lt;&lt; <span class="number">2</span> / (r - l), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">2</span> / (t - b), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span> / (n - f), <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">        M &lt;&lt; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -(r + l) / <span class="number">2</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -(t + b) / <span class="number">2</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -(n + f) / <span class="number">2</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">        P &lt;&lt; zNear, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, zNear, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, zNear + zFar, -zNear * zFar,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> S * M * P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">//这是精简版本</span></span><br><span class="line">    &#123;</span><br><span class="line">        eye_fov = eye_fov / <span class="number">180</span> * MY_PI;</span><br><span class="line">        projection &lt;&lt; <span class="number">1</span> / (aspect_ratio * <span class="built_in">tan</span>(eye_fov / <span class="number">2.0f</span>)), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span> / <span class="built_in">tan</span>(eye_fov / <span class="number">2.0f</span>), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -(zFar + zNear) / (zFar - zNear), <span class="number">2</span> * zFar * zNear / (zNear - zFar),</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> projection;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="提升部分"><a href="#提升部分" class="headerlink" title="提升部分"></a>提升部分</h2><p><strong>提升部分要求：在 main.cpp 中构造一个函数，该函数的作用是得到绕任意<br>过原点的轴的旋转变换矩阵。根据101中的推导，我们需要计算的东西并不多，按要求写好就行了。我选择重载<code>get_model_matrix</code>函数，来实现任意旋转轴的旋转操作。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723180917586-325759970_1726324498534.png" alt="image"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Matrix4f <span class="title function_">get_rotation</span><span class="params">(Vector3f axis, <span class="type">float</span> rotation_angle)</span></span><br><span class="line">&#123;</span><br><span class="line">    rotation_angle = rotation_angle / <span class="number">180.0f</span> * MY_PI;</span><br><span class="line">    Eigen::Matrix4f Result = Eigen::Matrix4f::Identity();</span><br><span class="line">    Eigen::Matrix3f I = Eigen::Matrix3f::Identity();<span class="comment">//单位矩阵</span></span><br><span class="line">    Eigen::Matrix3f N = Eigen::Matrix3f::Identity();</span><br><span class="line">    Eigen::Matrix3f ResultMat3 = Eigen::Matrix3f::Identity();</span><br><span class="line">    N &lt;&lt; <span class="number">0</span>, -axis[<span class="number">2</span>], axis[<span class="number">1</span>],</span><br><span class="line">        axis[<span class="number">2</span>], <span class="number">0</span>, -axis[<span class="number">0</span>],</span><br><span class="line">        -axis[<span class="number">1</span>], axis[<span class="number">0</span>], <span class="number">0</span>;</span><br><span class="line">    ResultMat3 = I * <span class="built_in">cos</span>(rotation_angle) + (<span class="number">1</span> - <span class="built_in">cos</span>(rotation_angle)) * axis * axis.transpose() + <span class="built_in">sin</span>(rotation_angle) * N;</span><br><span class="line">    Result &lt;&lt; ResultMat3(<span class="number">0</span>, <span class="number">0</span>), ResultMat3(<span class="number">0</span>, <span class="number">1</span>), ResultMat3(<span class="number">0</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">        ResultMat3(<span class="number">1</span>, <span class="number">0</span>), ResultMat3(<span class="number">1</span>, <span class="number">1</span>), ResultMat3(<span class="number">1</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">        ResultMat3(<span class="number">2</span>, <span class="number">0</span>), ResultMat3(<span class="number">2</span>, <span class="number">1</span>), ResultMat3(<span class="number">2</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其余代码和普通要求一致。得到结果如下：</p>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p><strong>因为是第一次作业，所以我这里给出编译的操作：</strong><br><strong>先来到作业目录</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723181838712-1375160081_1726324498534.png" alt="image"><br><strong>创建build文件夹</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723181927110-204538746_1726324498534.png" alt="image"><br><strong>来到build文件夹</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723181942749-1954478356_1726324498534.png" alt="image"><br><strong>使用上级目录创建项目文件</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182058006-810824329_1726324512496.png" alt="image"><br><strong>构建编译，这里的<code>-j8</code>是表示调用的核心数量，最后一句<code>target Rasterizer</code>表示可执行文件为<code>Rasterizer</code></strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182200125-1543010988_1726324512496.png" alt="image"><br><strong>运行</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182329557-1209278165_1726324512496.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182350084-1534632391_1726324525543.png" alt="image"><br><strong>按下Esc或者Ctrl+C停止</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182430085-709525676_1726324512496.png" alt="image"><br><strong>全部指令汇总</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="keyword">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line"><span class="keyword">make</span> -j8</span><br><span class="line">./Rasterizer</span><br></pre></td></tr></table></figure>

<h3 id="普通要求"><a href="#普通要求" class="headerlink" title="普通要求"></a>普通要求</h3><p><strong>运行指令与结果</strong></p>
<h4 id="Rasterizer-不带参数运行"><a href="#Rasterizer-不带参数运行" class="headerlink" title="./Rasterizer 不带参数运行"></a><code>./Rasterizer</code> 不带参数运行</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182350084-1534632391_1726324525543.png" alt="image"></p>
<h4 id="Rasterizer-r-0-output-png无旋转保存图片"><a href="#Rasterizer-r-0-output-png无旋转保存图片" class="headerlink" title="./Rasterizer -r 0 output.png无旋转保存图片"></a><code>./Rasterizer -r 0 output.png</code>无旋转保存图片</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182912917-826297831_1726324525543.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723182924063-1605934167_1726324525543.png" alt="image"></p>
<h4 id="Rasterizer-r-90-output90-png旋转保存图片"><a href="#Rasterizer-r-90-output90-png旋转保存图片" class="headerlink" title="./Rasterizer -r 90 output90.png旋转保存图片"></a><code>./Rasterizer -r 90 output90.png</code>旋转保存图片</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723183330813-824782173_1726324525543.png" alt="image"></p>
<h3 id="提升要求"><a href="#提升要求" class="headerlink" title="提升要求"></a>提升要求</h3><p><strong>先介绍一下main函数的两个参数<code>argc</code>和<code>argv</code></strong></p>
<ul>
<li><code>argc</code><strong>全称arugment count，表示调用程序的时候，传入的参数的个数。</strong></li>
<li><code>argv</code><strong>全称argument vector，表示调用程序的时候，传入的参数向量，类型为字符串</strong><br><strong>默认的，<code>argv[0]</code>是调用程序的完整路径，然后<code>argv[0]-argv[argc-1]</code>都是可以访问的字符串。在程序中，我们可以使用标准库定义的<code>stof</code>函数，把字符串转成浮点型，或者使用<code>stod</code>把字符串转化成整形。知道这一点之后，我们就可以设计一个<code>main</code>函数来把我们自定义的旋转轴作为参数传入程序了。</strong></li>
</ul>
<p><strong>这里是我自己设计的一个传参方案，有兴趣的可以读一下程序。</strong></p>
<p>main.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Triangle.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rasterizer.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">double</span> MY_PI = <span class="number">3.1415926</span>;</span><br><span class="line"><span class="type">bool</span> ProjectMode=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_view_matrix</span><span class="params">(Eigen::Vector3f eye_pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Eigen::Matrix4f view = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f translate;</span><br><span class="line">    translate &lt;&lt; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -eye_pos[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -eye_pos[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">        -eye_pos[<span class="number">2</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    view = translate * view;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_model_matrix</span><span class="params">(<span class="type">float</span> rotation_angle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Eigen::Matrix4f model = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line">    rotation_angle = rotation_angle / <span class="number">180.0f</span> * MY_PI;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement this function</span></span><br><span class="line">    <span class="comment">// Create the model matrix for rotating the triangle around the Z axis.</span></span><br><span class="line">    <span class="comment">// Then return it.</span></span><br><span class="line">    model &lt;&lt; <span class="built_in">cos</span>(rotation_angle), -<span class="built_in">sin</span>(rotation_angle), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="built_in">sin</span>(rotation_angle), <span class="built_in">cos</span>(rotation_angle), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rodrigues rotation formula</span></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_rotation</span><span class="params">(Vector3f axis, <span class="type">float</span> angle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    angle = angle / <span class="number">180.0f</span> * MY_PI;</span><br><span class="line">    Eigen::Matrix4f Result = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line">    Eigen::Matrix3f E = Eigen::Matrix3f::<span class="built_in">Identity</span>();</span><br><span class="line">    Eigen::Matrix3f N = Eigen::Matrix3f::<span class="built_in">Identity</span>();</span><br><span class="line">    Eigen::Matrix3f ResultMat3 = Eigen::Matrix3f::<span class="built_in">Identity</span>();</span><br><span class="line">    N &lt;&lt; <span class="number">0</span>, -axis[<span class="number">2</span>], axis[<span class="number">1</span>],</span><br><span class="line">        axis[<span class="number">2</span>], <span class="number">0</span>, -axis[<span class="number">0</span>],</span><br><span class="line">        -axis[<span class="number">1</span>], axis[<span class="number">0</span>], <span class="number">0</span>;</span><br><span class="line">    ResultMat3 = E * <span class="built_in">cos</span>(angle) + (<span class="number">1</span> - <span class="built_in">cos</span>(angle)) * axis * axis.<span class="built_in">transpose</span>() + <span class="built_in">sin</span>(angle) * N;</span><br><span class="line">    Result &lt;&lt; <span class="built_in">ResultMat3</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="built_in">ResultMat3</span>(<span class="number">0</span>, <span class="number">1</span>), <span class="built_in">ResultMat3</span>(<span class="number">0</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">        <span class="built_in">ResultMat3</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="built_in">ResultMat3</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">ResultMat3</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">        <span class="built_in">ResultMat3</span>(<span class="number">2</span>, <span class="number">0</span>), <span class="built_in">ResultMat3</span>(<span class="number">2</span>, <span class="number">1</span>), <span class="built_in">ResultMat3</span>(<span class="number">2</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Students will implement this function</span></span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f projection = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement this function</span></span><br><span class="line">    <span class="comment">// Create the projection matrix for the given parameters.</span></span><br><span class="line">    <span class="comment">// Then return it.</span></span><br><span class="line">    <span class="keyword">if</span> (!ProjectMode)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;Protable answer&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">        Eigen::Matrix4f S, M, P;</span><br><span class="line">        eye_fov = eye_fov / <span class="number">180</span> * MY_PI;</span><br><span class="line">        <span class="type">float</span> l, r, b, t, n, f;</span><br><span class="line">        <span class="comment">//注意这里的f和n代表的意义</span></span><br><span class="line">        f = -zNear;</span><br><span class="line">        n = -zFar;</span><br><span class="line">        t = -zNear * <span class="built_in">tan</span>(eye_fov/<span class="number">2</span>);</span><br><span class="line">        b = -t;</span><br><span class="line">        r = t * aspect_ratio;</span><br><span class="line">        l = -r;</span><br><span class="line">        S &lt;&lt; <span class="number">2</span> / (r - l), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">2</span> / (t - b), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span> / (n - f), <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">        M &lt;&lt; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -(r + l) / <span class="number">2</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -(t + b) / <span class="number">2</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -(n + f) / <span class="number">2</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">        P &lt;&lt; zNear, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, zNear, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, zNear + zFar, -zNear * zFar,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> S * M * P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;true answer&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">        eye_fov = eye_fov / <span class="number">180</span> * MY_PI;</span><br><span class="line">        projection &lt;&lt; <span class="number">1</span> / (aspect_ratio * <span class="built_in">tan</span>(eye_fov / <span class="number">2.0f</span>)), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span> / <span class="built_in">tan</span>(eye_fov / <span class="number">2.0f</span>), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, -(zFar + zNear) / (zFar - zNear), <span class="number">2</span> * zFar * zNear / (zNear - zFar),</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> projection;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> angle = <span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> command_line = <span class="literal">false</span>;</span><br><span class="line">    Eigen::Vector3f axis = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.f</span>, <span class="number">1.f</span>, <span class="number">0.f</span>);</span><br><span class="line">    std::string filename = <span class="string">&quot;output.png&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(argc&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">        std::cout&lt;&lt;argv[<span class="number">1</span>]&lt;&lt;std::endl;</span><br><span class="line">        <span class="keyword">if</span>(argv[<span class="number">1</span>][<span class="number">1</span>]==<span class="string">&#x27;m&#x27;</span>)<span class="comment">//使用精简版本</span></span><br><span class="line">            ProjectMode=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(argv[<span class="number">1</span>][<span class="number">1</span>]==<span class="string">&#x27;p&#x27;</span>)<span class="comment">//使用便阅读版本</span></span><br><span class="line">            ProjectMode=<span class="literal">false</span>;</span><br><span class="line">        std::cout&lt;&lt;ProjectMode&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (argc &gt;= <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;argc&lt;&lt;std::endl;</span><br><span class="line"></span><br><span class="line">        angle = std::<span class="built_in">stof</span>(argv[<span class="number">2</span>]); <span class="comment">// -r by default</span></span><br><span class="line">        <span class="keyword">if</span> (argc == <span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            command_line = <span class="literal">true</span>;</span><br><span class="line">            filename = std::<span class="built_in">string</span>(argv[<span class="number">3</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(argc==<span class="number">6</span>)&#123;<span class="comment">//DIY(</span></span><br><span class="line">        axis.<span class="built_in">x</span>()=std::<span class="built_in">stof</span>(argv[<span class="number">3</span>]);</span><br><span class="line">        axis.<span class="built_in">y</span>()=std::<span class="built_in">stof</span>(argv[<span class="number">4</span>]);</span><br><span class="line">        axis.<span class="built_in">z</span>()=std::<span class="built_in">stof</span>(argv[<span class="number">5</span>]);</span><br><span class="line">        axis.<span class="built_in">normalize</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">rst::rasterizer <span class="title">r</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f eye_pos = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>&#125;;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;Eigen::Vector3f&gt; pos&#123;&#123;<span class="number">2</span>, <span class="number">0</span>, <span class="number">-2</span>&#125;, &#123;<span class="number">0</span>, <span class="number">2</span>, <span class="number">-2</span>&#125;, &#123;<span class="number">-2</span>, <span class="number">0</span>, <span class="number">-2</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;Eigen::Vector3i&gt; ind&#123;&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> pos_id = r.<span class="built_in">load_positions</span>(pos);</span><br><span class="line">    <span class="keyword">auto</span> ind_id = r.<span class="built_in">load_indices</span>(ind);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> frame_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (command_line)</span><br><span class="line">    &#123;</span><br><span class="line">        r.<span class="built_in">clear</span>(rst::Buffers::Color | rst::Buffers::Depth);</span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">set_model</span>(<span class="built_in">get_model_matrix</span>(angle));</span><br><span class="line">        r.<span class="built_in">set_view</span>(<span class="built_in">get_view_matrix</span>(eye_pos));</span><br><span class="line">        r.<span class="built_in">set_projection</span>(<span class="built_in">get_projection_matrix</span>(<span class="number">45</span>, <span class="number">1</span>, <span class="number">0.1</span>, <span class="number">50</span>));</span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">draw</span>(pos_id, ind_id, rst::Primitive::Triangle);</span><br><span class="line">        <span class="function">cv::Mat <span class="title">image</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>, CV_32FC3, r.frame_buffer().data())</span></span>;</span><br><span class="line">        image.<span class="built_in">convertTo</span>(image, CV_8UC3, <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">        cv::<span class="built_in">imwrite</span>(filename, image);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (key != <span class="number">27</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r.<span class="built_in">clear</span>(rst::Buffers::Color | rst::Buffers::Depth);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">set_model</span>(<span class="built_in">get_model_matrix</span>(angle));</span><br><span class="line">        <span class="comment">//DIY</span></span><br><span class="line">        <span class="keyword">if</span> (argc == <span class="number">6</span>)&#123;</span><br><span class="line">            r.<span class="built_in">set_model</span>(<span class="built_in">get_rotation</span>(axis, angle));</span><br><span class="line">            std::cout&lt;&lt;<span class="string">&quot;axis x:&quot;</span>&lt;&lt;axis.<span class="built_in">x</span>()&lt;&lt;<span class="string">&quot; y:&quot;</span>&lt;&lt;axis.<span class="built_in">y</span>()&lt;&lt;<span class="string">&quot; z:&quot;</span>&lt;&lt;axis.<span class="built_in">z</span>()&lt;&lt;std::endl&lt;&lt;<span class="string">&quot;angle:&quot;</span>&lt;&lt;angle&lt;&lt;std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        r.<span class="built_in">set_view</span>(<span class="built_in">get_view_matrix</span>(eye_pos));</span><br><span class="line">        r.<span class="built_in">set_projection</span>(<span class="built_in">get_projection_matrix</span>(<span class="number">45</span>, <span class="number">1</span>, <span class="number">0.1</span>, <span class="number">50</span>));</span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">draw</span>(pos_id, ind_id, rst::Primitive::Triangle);</span><br><span class="line"></span><br><span class="line">        <span class="function">cv::Mat <span class="title">image</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>, CV_32FC3, r.frame_buffer().data())</span></span>;</span><br><span class="line">        image.<span class="built_in">convertTo</span>(image, CV_8UC3, <span class="number">1.0f</span>);</span><br><span class="line">        cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">        key = cv::<span class="built_in">waitKey</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;frame count: &quot;</span> &lt;&lt; frame_count++ &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key == <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            angle += <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (key == <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            angle -= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>部分效果如下：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723191930953-2112061334_1726324525543.png" alt="image"><br><strong>可执行操作如下</strong></p>
<ul>
<li><code>./Rasterizer -p</code> 使用便阅读版本矩阵进行计算</li>
<li><code>./Rasterizer -m</code>使用简便版本矩阵进行计算<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723194245183-317989357_1726324535490.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230723194232384-1821610204_1726324535490.png" alt="image"></li>
</ul>
<p><strong>games101 Hw1 到此就结束啦！</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576366.html">下一篇:图形填充</a></p>
<hr>
<h2 id="2023-8-17"><a href="#2023-8-17" class="headerlink" title="2023.8.17"></a>2023.8.17</h2><p>写完之后，感觉少了点什么，于是便有了下面的东西。</p>
<h2 id="框架解读"><a href="#框架解读" class="headerlink" title="框架解读"></a>框架解读</h2><p><strong>作业一的文件如下</strong></p>
<ul>
<li>main.cpp</li>
<li>rasterizer.cpp</li>
<li>rasterizer.hpp</li>
<li>Triangle.cpp</li>
<li>Triangle.hpp</li>
</ul>
<p><strong>读框架代码要从接口开始，也就是头文件，我们先注意一下各个头文件的引用情况：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------------</span><br><span class="line"><span class="comment">//main</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Triangle.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rasterizer.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line">---------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">//raserizer.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Triangle.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line">---------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">//Triangle.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line">---------------------------------------------</span><br></pre></td></tr></table></figure>

<p><strong>可以看到，<code>Triangle.hpp</code>是一个独立的类，只需要依赖数学库<code>Eigen</code>，我们从这个三角形类开始。</strong></p>
<h3 id="Triangle"><a href="#Triangle" class="headerlink" title="Triangle"></a>Triangle</h3><h4 id="数据成员"><a href="#数据成员" class="headerlink" title="数据成员"></a>数据成员</h4><p><strong>这里用到的三角形类存储了一个三角形的顶点部分信息，以达到绘制一个线框所需要的数据结构。具体有这些：</strong></p>
<ul>
<li><code>Vector3f v[3];</code> 顶点坐标</li>
<li><code>Vector3f color[3];</code> 顶点颜色</li>
<li><code>Vector2f tex_coords[3];</code> 纹理坐标</li>
<li><code>Vector3f normal[3];</code> 法线方向<br><strong>其中只有顶点坐标在作业一中用到了。</strong></li>
</ul>
<h4 id="接口函数"><a href="#接口函数" class="headerlink" title="接口函数"></a>接口函数</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//访问顶点坐标</span></span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">a</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> v[<span class="number">0</span>]; &#125;</span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">b</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> v[<span class="number">1</span>]; &#125;</span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">c</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> v[<span class="number">2</span>]; &#125;</span><br><span class="line"><span class="comment">//设置顶点坐标、法线、颜色、纹理坐标</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setVertex</span><span class="params">(<span class="type">int</span> ind, Vector3f ver)</span></span>; <span class="comment">/*set i-th vertex coordinates */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setNormal</span><span class="params">(<span class="type">int</span> ind, Vector3f n)</span></span>;   <span class="comment">/*set i-th vertex normal vector*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setColor</span><span class="params">(<span class="type">int</span> ind, <span class="type">float</span> r, <span class="type">float</span> g, <span class="type">float</span> b)</span></span>; <span class="comment">/*set i-th vertex color*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setTexCoord</span><span class="params">(<span class="type">int</span> ind, <span class="type">float</span> s,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">float</span> t)</span></span>; <span class="comment">/*set i-th vertex texture coordinate*/</span></span><br><span class="line"><span class="comment">//到Vec4的转化，方便进行矩阵计算</span></span><br><span class="line"><span class="function">std::array&lt;Vector4f, 3&gt; <span class="title">toVector4</span><span class="params">()</span> <span class="type">const</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="函数实现"><a href="#函数实现" class="headerlink" title="函数实现"></a>函数实现</h4><p><strong>只有一个函数是值的讲解的<code>toVector4</code>：这个函数把三角形顶点坐标转化为齐次坐标后返回。</strong></p>
<p><strong><code>std::transform</code>是一个通用算法，用于对输入范围中的元素执行给定的操作，并将结果存储在输出范围中。在这个例子中，我们使用<code>std::transform(std::begin(v), std::end(v), res.begin(), [](auto&amp; vec) &#123; ... &#125;)</code>来将v数组中的每个<code>Vector4f</code>对象转换为<code>res</code>数组中的对应对象。<code>[](auto&amp; vec) &#123; ... &#125;</code>是一个<code>lambda</code>表达式，用于定义转换操作。</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::array&lt;Vector4f, 3&gt; <span class="title">Triangle::toVector4</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;Vector4f, 3&gt; res;</span><br><span class="line">    std::<span class="built_in">transform</span>(std::<span class="built_in">begin</span>(v), std::<span class="built_in">end</span>(v), res.<span class="built_in">begin</span>(), [](<span class="keyword">auto</span>&amp; vec) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Vector4f</span>(vec.<span class="built_in">x</span>(), vec.<span class="built_in">y</span>(), vec.<span class="built_in">z</span>(), <span class="number">1.f</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="rasterizer"><a href="#rasterizer" class="headerlink" title="rasterizer"></a>rasterizer</h3><p><strong>这个类就很有意思了，从类的数据成员开始看：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">rasterizer</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//三个投影矩阵</span></span><br><span class="line">    Eigen::Matrix4f model;</span><br><span class="line">    Eigen::Matrix4f view;</span><br><span class="line">    Eigen::Matrix4f projection;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//顶点缓存</span></span><br><span class="line">    std::map&lt;<span class="type">int</span>, std::vector&lt;Eigen::Vector3f&gt;&gt; pos_buf;</span><br><span class="line">	std::map&lt;<span class="type">int</span>, std::vector&lt;Eigen::Vector3i&gt;&gt; ind_buf;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//颜色缓存</span></span><br><span class="line">    std::vector&lt;Eigen::Vector3f&gt; frame_buf;</span><br><span class="line">    <span class="comment">//深度缓存 暂未使用</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; depth_buf;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//显示区域参数</span></span><br><span class="line">    <span class="type">int</span> width, height;</span><br><span class="line">	<span class="comment">//工具</span></span><br><span class="line">    <span class="type">int</span> next_id = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong><code>frame_buf</code>存储的是最后的颜色结果，虽然直译是指框架缓存。（英语不好，勿喷）</strong><br><strong>有了这些数据成员，就开开始写数据的构造和赋值了。构造只有对显示区域参数的初始化：</strong></p>
<h4 id="构造"><a href="#构造" class="headerlink" title="构造"></a>构造</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//raterizer.cpp</span></span><br><span class="line">rst::rasterizer::<span class="built_in">rasterizer</span>(<span class="type">int</span> w, <span class="type">int</span> h) : <span class="built_in">width</span>(w), <span class="built_in">height</span>(h)</span><br><span class="line">&#123;</span><br><span class="line">    frame_buf.<span class="built_in">resize</span>(w * h);</span><br><span class="line">    depth_buf.<span class="built_in">resize</span>(w * h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="赋值"><a href="#赋值" class="headerlink" title="赋值"></a>赋值</h4><p><strong>需要外部输入的数据成员还有</strong></p>
<ul>
<li><strong>model</strong></li>
<li><strong>view</strong></li>
<li><strong>projection</strong></li>
<li><strong>pos_buf</strong></li>
<li><strong>ind_buf</strong></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> rst::rasterizer::<span class="built_in">set_model</span>(<span class="type">const</span> Eigen::Matrix4f&amp; m)&#123;</span><br><span class="line">    model = m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> rst::rasterizer::<span class="built_in">set_view</span>(<span class="type">const</span> Eigen::Matrix4f&amp; v)&#123;</span><br><span class="line">    view = v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> rst::rasterizer::<span class="built_in">set_projection</span>(<span class="type">const</span> Eigen::Matrix4f&amp; p)&#123;</span><br><span class="line">    projection = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//导入顶点坐标和顶点索引</span></span><br><span class="line">rst::pos_buf_id rst::rasterizer::<span class="built_in">load_positions</span>(<span class="type">const</span> std::vector&lt;Eigen::Vector3f&gt; &amp;positions)&#123;</span><br><span class="line">    <span class="keyword">auto</span> id = <span class="built_in">get_next_id</span>();</span><br><span class="line">    pos_buf.<span class="built_in">emplace</span>(id, positions);</span><br><span class="line">    <span class="keyword">return</span> &#123;id&#125;;</span><br><span class="line">&#125;</span><br><span class="line">rst::ind_buf_id rst::rasterizer::<span class="built_in">load_indices</span>(<span class="type">const</span> std::vector&lt;Eigen::Vector3i&gt; &amp;indices)&#123;</span><br><span class="line">    <span class="keyword">auto</span> id = <span class="built_in">get_next_id</span>();</span><br><span class="line">    ind_buf.<span class="built_in">emplace</span>(id, indices);</span><br><span class="line">    <span class="keyword">return</span> &#123;id&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>上面三个MVP函数是非常简单的，没什么好讲的，但是导入顶点坐标和索引的函数，可得好好讲讲。</strong><br><strong>首先是为什么这个两个函数返回值分别是<code>rst::pos_buf_id</code>和<code>rst::ind_buf_id</code> ，在原代码框架里给了这么一段解释：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> For the curious : The draw function takes two buffer id&#x27;s as its arguments.</span></span><br><span class="line"><span class="comment"> These two structs make sure that if you mix up with their orders, the</span></span><br><span class="line"><span class="comment"> compiler won&#x27;t compile it. Aka : Type safety</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">对于感兴趣的人 : draw 函数接受两个缓冲区ID作为参数。</span></span><br><span class="line"><span class="comment">这些两个结构体确保如果将它们顺序混乱，编译器不会编译它。</span></span><br><span class="line"><span class="comment">又名 : 类型安全</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">pos_buf_id</span>&#123;</span><br><span class="line">    <span class="type">int</span> pos_id = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ind_buf_id</span>&#123;</span><br><span class="line">    <span class="type">int</span> ind_id = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>在我们的<code>draw</code>函数里面，直接对id进行了下标访问，因为我们不希望再去浪费查找的时间，这样一个设计可以让程序高效而安全。这就像是给一个整形变量贴上了标签一样。两个不同的返回值类型的存在，使得我们可以存在相同的id在<code>pos_buf</code>和<code>ind_buf</code>中，而不会产生问题。</strong></p>
<p><strong>而至于为什么要返回这么一个值呢？</strong></p>
<p><strong>这是因为我们在使用rasterizer类的时候，需要获得导入数据的控制<code>buf_id</code>，才能对导入的数据进行访问。</strong></p>
<h4 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h4><p><strong>数据成员的初始化和赋值都已经解决了，接下来就是如何准确的进行光栅化的问题了。光栅化要做的事情就两件，一、把颜色缓存填充好；二、深度缓存填充好。</strong></p>
<h5 id="一、颜色缓存"><a href="#一、颜色缓存" class="headerlink" title="一、颜色缓存"></a>一、颜色缓存</h5><p><strong>首先实现一个填充颜色的小函数<code>rst::rasterizer::set_pixel(const Eigen::Vector3f&amp; point, const Eigen::Vector3f&amp; color)</code></strong><br><strong>作为rst::rasterizer 类的成员函数，他需要设置指定点的颜色，但是注意<code>frame_buf</code>是一个数组，数组意味着越界的风险，所以需要在设置之前判断下标的位置。</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (point.<span class="built_in">x</span>() &lt; <span class="number">0</span> || point.<span class="built_in">x</span>() &gt;= width ||</span><br><span class="line">        point.<span class="built_in">y</span>() &lt; <span class="number">0</span> || point.<span class="built_in">y</span>() &gt;= height) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">auto</span> ind = (height-point.<span class="built_in">y</span>())*width + point.<span class="built_in">x</span>();</span><br><span class="line">    frame_buf[ind] = color;</span><br></pre></td></tr></table></figure>

<h5 id="二、深度缓存"><a href="#二、深度缓存" class="headerlink" title="二、深度缓存"></a>二、深度缓存</h5><p>这个作业没有涉及到深度缓存，因为绘制的是一个平面的三角形，所以深度缓存留到下一次作业讲解。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/计算机图形学笔记三——橡皮筋技术和椭圆扫描算法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/45431/" class="article-date">
      <time datetime="2023-04-23T17:02:00.000Z" itemprop="datePublished">2023-04-23</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/45431/">计算机图形学笔记三——橡皮筋技术和椭圆扫描算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/articles/17341756.html">上一篇：圆形、圆弧段的绘制算法</a><br><a href="">下一篇：暂无</a></p>
<h2 id="橡皮筋技术"><a href="#橡皮筋技术" class="headerlink" title="橡皮筋技术"></a>橡皮筋技术</h2><p><strong>橡皮筋技术就是可以使得用户进行可视化编辑，也就是在编辑的时候，图像能够进行实时的变化。这是一种非常实用的技术，接下来和大家讲解一下这个技术。</strong><br><strong>我们有鼠标点击回调函数，还有鼠标移动回调函数。我们需要的是在鼠标点击过后，移动鼠标能够预览我们绘制的图像。比如这是有无橡皮筋技术的对比：</strong></p>
<blockquote>
<p>有橡皮筋技术</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230423171637658-1332099408_1726324535490.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230423171650023-1401375962_1726324535490.png" alt="image"><br><strong>随着鼠标的移动，我们的最后一个顶点会跟着移动，可以达到很好的编辑效果。</strong></p>
<blockquote>
<p>没有橡皮筋技术</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230423183552757-447416362_1726324535490.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230423183610070-1324517669_1726324554561.png" alt="image"><br><strong>每次都会确定一个顶点位置，不能进行实时的更改。</strong><br><strong>橡皮筋技术的实现需要的两个函数和一个枚举：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//鼠标点击回调函数</span></span><br><span class="line"><span class="built_in">glutMouseFunc</span>(onMouse);</span><br><span class="line"><span class="comment">//鼠标移动回调函数</span></span><br><span class="line"><span class="built_in">glutPassiveMotionFunc</span>(onMouseMove);</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">	MOVE,</span><br><span class="line">	NONE</span><br><span class="line">&#125;MOUSEMODE;</span><br></pre></td></tr></table></figure>

<h3 id="鼠标点击回调函数"><a href="#鼠标点击回调函数" class="headerlink" title="鼠标点击回调函数"></a>鼠标点击回调函数</h3><p><strong>处理点击事件时，我们设置第一次点击创建两个顶点。想象一下，点击一次后，我们移动会带动第二个点移动，也就是说我们第一次点击需要创建两个顶点。在后面的点击只需要创建一个。并且把<code>MouseMode</code>更新为<code>MOVE</code></strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*这里是onMouse(GLint button, GLint state, GLint x, GLint y)*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果点击状态是按下</span></span><br><span class="line"><span class="keyword">if</span> (state == GLUT_DOWN) &#123;</span><br><span class="line">	<span class="comment">//如果是鼠标左键</span></span><br><span class="line">	<span class="keyword">if</span> (button == GLUT_LEFT_BUTTON) &#123;</span><br><span class="line">		<span class="comment">//如果是第一个点，多创建一个顶点</span></span><br><span class="line">		<span class="keyword">if</span> (!Vertex.<span class="built_in">size</span>())</span><br><span class="line">			Vertex.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x, y));</span><br><span class="line">		Vertex.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x, y));</span><br><span class="line">		<span class="comment">//设置控制点的位置</span></span><br><span class="line">		ctrlPoint = Vertex.<span class="built_in">size</span>();</span><br><span class="line">		<span class="comment">//修改控制模式</span></span><br><span class="line">		MouseMode = MOVE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="鼠标移动回调函数"><a href="#鼠标移动回调函数" class="headerlink" title="鼠标移动回调函数"></a>鼠标移动回调函数</h3><p><strong>在创建顶点过后，我们在鼠标移动回调函数中对最后一格顶点进行位置的更改，我们也可以叫最后一个顶点为临时顶点。</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*这里是onMouseMove(GLint xMouse, GLint yMouse)*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果控制装填是移动</span></span><br><span class="line"><span class="keyword">if</span> (MouseMode == MOVE) &#123;</span><br><span class="line">	Vertex[ctrlPoint - <span class="number">1</span>].first = xMouse, Vertex[ctrlPoint - <span class="number">1</span>].second = yMouse;</span><br><span class="line">	<span class="comment">//发送重绘信息</span></span><br><span class="line">	<span class="built_in">glutPostRedisplay</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="额外的——使用右键进行顶点的消除和暂停绘制"><a href="#额外的——使用右键进行顶点的消除和暂停绘制" class="headerlink" title="额外的——使用右键进行顶点的消除和暂停绘制"></a>额外的——使用右键进行顶点的消除和暂停绘制</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*这里是onMouse(GLint button, GLint state, GLint x, GLint y)*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果按下的是右键</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (button == GLUT_RIGHT_BUTTON) &#123;</span><br><span class="line">	<span class="comment">//如果正在进行橡皮筋操作</span></span><br><span class="line">	<span class="keyword">if</span> (MouseMode == MOVE) &#123;</span><br><span class="line">		<span class="comment">//停止橡皮筋操作（停止实时绘画）</span></span><br><span class="line">		MouseMode = NONE;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//否则为删除模式，判断顶点位置</span></span><br><span class="line">	<span class="keyword">auto</span> ibeg = Vertex.<span class="built_in">begin</span>();</span><br><span class="line">	<span class="keyword">while</span> (ibeg != Vertex.<span class="built_in">end</span>()) &#123;</span><br><span class="line">		<span class="comment">//模糊搜索，先绘制的顶点先删除（距离都满足条件的话）</span></span><br><span class="line">		<span class="keyword">if</span> (((x - ibeg-&gt;first) * (x - ibeg-&gt;first)) + ((y - ibeg-&gt;second) * (y - ibeg-&gt;second)) &lt; <span class="number">400</span>) &#123;</span><br><span class="line">			<span class="comment">//找到了，删除该顶点</span></span><br><span class="line">			Vertex.<span class="built_in">erase</span>(ibeg);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		ibeg++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里是可以用于前面圆和圆弧绘制的测试代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">你可以使用左键绘制顶点</span></span><br><span class="line"><span class="comment">你可以使用右键删除顶点</span></span><br><span class="line"><span class="comment">直线的绘制沿着顶点顺序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gl/glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DrawLine.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DrawRound.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> m_POINT_SIZE 10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> m_LINE_SIZE 2</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">	MOVE,</span><br><span class="line">	NONE</span><br><span class="line">&#125;MOUSEMODE;</span><br><span class="line"></span><br><span class="line">vector&lt;pair&lt;GLint, GLint &gt;&gt;Vertex;</span><br><span class="line">MOUSEMODE MouseMode = NONE;</span><br><span class="line">GLint ctrlPoint = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onDisplay</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onReshape</span><span class="params">(GLint w, GLint h)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onMouse</span><span class="params">(GLint button, GLint state, GLint x, GLint y)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onMouseMove</span><span class="params">(GLint xMouse, GLint yMouse)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onReshape</span><span class="params">(GLint w, GLint h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 设置视口大小</span></span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">	<span class="comment">// 切换矩阵模式为投影矩阵</span></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_PROJECTION);</span><br><span class="line">	<span class="comment">// 载入单位矩阵</span></span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();</span><br><span class="line">	<span class="comment">// 进行二维平行投影</span></span><br><span class="line">	<span class="built_in">gluOrtho2D</span>(<span class="number">0</span>, w, h, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 切换矩阵模式为模型矩阵</span></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_MODELVIEW);</span><br><span class="line">	<span class="comment">// 发送重绘</span></span><br><span class="line">	<span class="built_in">glutPostRedisplay</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onMouse</span><span class="params">(GLint button, GLint state, GLint x, GLint y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (state == GLUT_DOWN) &#123;</span><br><span class="line">		<span class="keyword">if</span> (button == GLUT_LEFT_BUTTON) &#123;</span><br><span class="line">			<span class="keyword">if</span>(!Vertex.<span class="built_in">size</span>())</span><br><span class="line">			Vertex.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x, y));</span><br><span class="line">			Vertex.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(x, y));</span><br><span class="line">			ctrlPoint = Vertex.<span class="built_in">size</span>();</span><br><span class="line">			MouseMode = MOVE;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (button == GLUT_RIGHT_BUTTON) &#123;</span><br><span class="line">			<span class="keyword">if</span> (MouseMode == MOVE) &#123;</span><br><span class="line">				MouseMode = NONE;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">auto</span> ibeg = Vertex.<span class="built_in">begin</span>();</span><br><span class="line">			<span class="keyword">while</span> (ibeg != Vertex.<span class="built_in">end</span>()) &#123;</span><br><span class="line">				<span class="keyword">if</span> (((x - ibeg-&gt;first) * (x - ibeg-&gt;first)) + ((y - ibeg-&gt;second) * (y - ibeg-&gt;second)) &lt; <span class="number">400</span>) &#123;</span><br><span class="line">					Vertex.<span class="built_in">erase</span>(ibeg);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				ibeg++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glutPostRedisplay</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onMouseMove</span><span class="params">(GLint xMouse, GLint yMouse)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (MouseMode == MOVE) &#123;</span><br><span class="line">		Vertex[ctrlPoint<span class="number">-1</span>].first = xMouse, Vertex[ctrlPoint<span class="number">-1</span>].second = yMouse;</span><br><span class="line">		<span class="built_in">glutPostRedisplay</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onDisplay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">glClearColor</span>(<span class="number">224</span> / <span class="number">255.0</span>, <span class="number">237</span> / <span class="number">255.0</span>, <span class="number">253</span> / <span class="number">255.0</span>,<span class="number">1.0</span>);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glColor3f</span>(<span class="number">1.0f</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">auto</span> ibeg = Vertex.<span class="built_in">begin</span>(),jbeg=ibeg;</span><br><span class="line">	GLint VertexNum = Vertex.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">while</span> (ibeg != Vertex.<span class="built_in">end</span>()) &#123;</span><br><span class="line">		<span class="built_in">glPointSize</span>(m_POINT_SIZE);</span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POINTS);</span><br><span class="line">		<span class="built_in">glVertex2i</span>(ibeg-&gt;first, ibeg-&gt;second);</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line">		<span class="built_in">glPointSize</span>(m_LINE_SIZE);</span><br><span class="line">		<span class="keyword">if</span>(VertexNum&gt;=<span class="number">2</span>) &#123;</span><br><span class="line">			<span class="comment">//这里可以选择直线绘制方式</span></span><br><span class="line">			<span class="built_in">BRESENHAM_Line</span>(ibeg-&gt;first, ibeg-&gt;second, jbeg-&gt;first, jbeg-&gt;second);</span><br><span class="line">			<span class="comment">//TMP_Line(ibeg-&gt;first, ibeg-&gt;second, jbeg-&gt;first, jbeg-&gt;second);</span></span><br><span class="line">			<span class="comment">//DDA_Line(ibeg-&gt;first, ibeg-&gt;second, jbeg-&gt;first, jbeg-&gt;second);</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//这里是绘制圆形</span></span><br><span class="line">			<span class="comment">//Mid_Circle( jbeg-&gt;first, jbeg-&gt;second,ibeg-&gt;first, ibeg-&gt;second);</span></span><br><span class="line">			<span class="comment">//BRESENHAM_Circle(jbeg-&gt;first, jbeg-&gt;second, ibeg-&gt;first, ibeg-&gt;second);</span></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		jbeg = ibeg;</span><br><span class="line">		ibeg++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//这里是绘制圆弧（只绘制前三个点，可以自己DIY）</span></span><br><span class="line">	<span class="keyword">if</span> (VertexNum &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;Draw CircleArc&quot;</span> &lt;&lt; endl;</span><br><span class="line">		<span class="built_in">DrawCircleArc</span>(Vertex[<span class="number">0</span>].first, Vertex[<span class="number">0</span>].second, Vertex[<span class="number">1</span>].first, Vertex[<span class="number">1</span>].second, Vertex[<span class="number">2</span>].first, Vertex[<span class="number">2</span>].second);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glutSwapBuffers</span>();</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;Once&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">GLint <span class="title">main</span><span class="params">(GLint argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化 glut</span></span><br><span class="line">	<span class="built_in">glutInit</span>(&amp;argc, argv);</span><br><span class="line">	<span class="comment">// 设置 OpenGL 显示模式(双缓存, RGB 颜色模式)</span></span><br><span class="line">	<span class="built_in">glutInitDisplayMode</span>(GLUT_DOUBLE | GLUT_RGB);</span><br><span class="line">	<span class="comment">// 设置窗口初始尺寸</span></span><br><span class="line">	<span class="built_in">glutInitWindowSize</span>(<span class="number">1000</span>,<span class="number">800</span>);</span><br><span class="line">	<span class="comment">// 设置窗口初始位置</span></span><br><span class="line">	<span class="built_in">glutInitWindowPosition</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 设置窗口标题</span></span><br><span class="line">	<span class="built_in">glutCreateWindow</span>(<span class="string">&quot;Terix&quot;</span>);</span><br><span class="line">	<span class="built_in">glutReshapeFunc</span>(onReshape);</span><br><span class="line">	<span class="built_in">glutDisplayFunc</span>(onDisplay);</span><br><span class="line">	<span class="built_in">glutMouseFunc</span>(onMouse);</span><br><span class="line">	<span class="built_in">glutPassiveMotionFunc</span>(onMouseMove);</span><br><span class="line">	<span class="comment">// 设置菜单</span></span><br><span class="line">	<span class="comment">// 进入 glut 事件循环</span></span><br><span class="line">	<span class="built_in">glutMainLoop</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="椭圆扫描算法"><a href="#椭圆扫描算法" class="headerlink" title="椭圆扫描算法"></a>椭圆扫描算法</h2><p><strong>然后我们来介绍一下最后一个绘制圆锥曲线的算法（我的专栏里）——椭圆的绘制.</strong><br><strong>由于椭圆的对称性较圆稍差，它的对称性只有4份，也就是四个卦象内对称，也就是说我们得绘制出第一卦象一整个卦象的图像。当斜率绝对值小于1的时候使用x作为步长，反之为y轴。接下来来推导一下迭代方程和斜率的判别式：</strong><br><strong>设一个椭圆方程为</strong></p>
<p>\[b^2 x^2+a^2 y^2-a^2b^2&#x3D;0 \]</p>
<blockquote>
<p>x轴</p>
</blockquote>
<p><strong>假设当前最佳迭代点为 \((x_i+1, y_i)\)，那么对于下一个迭代点的两种情况：</strong></p>
<p>\[d_i&#x3D;F(x_i+2,y_i-0.5)&#x3D;b^2(x_i+1)^2+a^2(y_i-0.5)^2-a^2b^2 \]</p>
<p><strong>d&lt;0</strong></p>
<p>\[d_i&#x3D;F(x_i+2,y_i-0.5)&#x3D;d+b^2(2x_i+3) \]</p>
<p><strong>d&gt;&#x3D;0</strong></p>
<p>\[d_i&#x3D;F(x_i+2,y_i-1.5)&#x3D;d+b^2(2x_i+3)+a^2(-2y_i+2) \]</p>
<p><strong>迭代终点为斜率的绝对值大于1</strong></p>
<blockquote>
<p>斜率判别式</p>
</blockquote>
<p>\[|k|&#x3D;\frac{a^2(y_i-0.5)}{b^2(x_i+1)} \]</p>
<p><strong>转化为：</strong></p>
<p>\[b^2(x_i+1)&lt;a^2(y_i-0.5) \]</p>
<blockquote>
<p>y轴</p>
</blockquote>
<p><strong>同样的我们可以得到：</strong><br><strong>d&lt;0</strong></p>
<p>\[d_i&#x3D;F(x_i+1.5,y_i-2)&#x3D;d+b^2(2x_i+2)+a^2(-2y_i+3) \]</p>
<p><strong>d&gt;0</strong></p>
<p>\[d_i&#x3D;F(x_i+0.5,y_i-2)&#x3D;d+a^2(-2y_i+3) \]</p>
<p><strong>迭代终点为y&#x3D;&#x3D;0</strong></p>
<p><strong>因为单纯使用函数已经无法很好的维护数据了，所以从椭圆开始我会将所有的算法和所需要的数据结构封装成类。</strong></p>
<p>Ellipt类</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Ellipt</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Ellipt</span>(GLint P1x=<span class="number">0</span>,GLint P1y=<span class="number">0</span>,GLint P2x=<span class="number">0</span>,GLint P2y=<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		m_a = <span class="built_in">abs</span>(<span class="built_in">static_cast</span>&lt;GLint&gt;(P1x - P2x)/<span class="number">2</span>);</span><br><span class="line">		m_b= <span class="built_in">abs</span>(<span class="built_in">static_cast</span>&lt;GLint&gt;(P1y - P2y)/<span class="number">2</span>);</span><br><span class="line">		<span class="comment">//四舍五入</span></span><br><span class="line">		m_R.x = <span class="built_in">static_cast</span>&lt;GLint&gt;(((P1x + P2x) / <span class="number">2.0</span> + <span class="number">0.5</span>));</span><br><span class="line">		m_R.y = <span class="built_in">static_cast</span>&lt;GLint&gt;(((P1y + P2y) / <span class="number">2.0</span> + <span class="number">0.5</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setData</span><span class="params">(GLint P1x, GLint P1y, GLint P2x, GLint P2y)</span> </span>&#123;</span><br><span class="line">		m_a = <span class="built_in">abs</span>(<span class="built_in">static_cast</span>&lt;GLint&gt;(P1x - P2x)/<span class="number">2</span>);</span><br><span class="line">		m_b = <span class="built_in">abs</span>(<span class="built_in">static_cast</span>&lt;GLint&gt;(P1y - P2y)/<span class="number">2</span>);</span><br><span class="line">		<span class="comment">//四舍五入</span></span><br><span class="line">		m_R.x = <span class="built_in">static_cast</span>&lt;GLint&gt;(((P1x + P2x) / <span class="number">2.0</span> + <span class="number">0.5</span>));</span><br><span class="line">		m_R.y = <span class="built_in">static_cast</span>&lt;GLint&gt;(((P1y + P2y) / <span class="number">2.0</span> + <span class="number">0.5</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">MidPt_Elliptse</span>(m_R, m_a, m_b);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	myPoint m_R;</span><br><span class="line">	GLint m_a,m_b;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">MidPt_Elliptse</span><span class="params">(myPoint cPt, GLint a, GLint b)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">glBegin</span>(GL_POINTS);</span><br><span class="line">		GLint x, y, temp = a * <span class="number">7</span> / <span class="number">10</span>, dir[<span class="number">4</span>][<span class="number">2</span>] = &#123;</span><br><span class="line">		&#123; <span class="number">1</span>, <span class="number">1</span> &#125;, &#123; <span class="number">1</span>,<span class="number">-1</span> &#125;,</span><br><span class="line">		&#123; <span class="number">-1</span>,<span class="number">1</span>&#125;, &#123;<span class="number">-1</span>,<span class="number">-1</span> &#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="type">double</span> d;</span><br><span class="line">		x = <span class="number">0</span>, y = b;</span><br><span class="line">		d = b * b + a * a * (-b + <span class="number">0.25</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			<span class="built_in">glVertex2i</span>(cPt.x + x * dir[i][<span class="number">0</span>], cPt.y + y * dir[i][<span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> ((b * b * (x + <span class="number">1</span>)&lt;a * a * (y + <span class="number">0.5</span>))) &#123;</span><br><span class="line">			<span class="keyword">if</span> (d &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				x += <span class="number">1</span>;</span><br><span class="line">				y -= <span class="number">1</span>;</span><br><span class="line">				d += b * b * (<span class="number">2</span> * x + <span class="number">3</span>) + a * a * (<span class="number">-2</span> * y + <span class="number">2</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				x += <span class="number">1</span>;</span><br><span class="line">				d += b * b * (<span class="number">2</span> * x + <span class="number">3</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(cPt.x + x * dir[i][<span class="number">0</span>], cPt.y + y * dir[i][<span class="number">1</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (y &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (d &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">				y -= <span class="number">1</span>;</span><br><span class="line">				d += a * a * (<span class="number">-2</span> * y + <span class="number">3</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				x += <span class="number">1</span>;</span><br><span class="line">				y -= <span class="number">1</span>;</span><br><span class="line">				d += a * a * (<span class="number">-2</span> * y + <span class="number">3</span>) + b * b * (<span class="number">2</span> * x + <span class="number">2</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(cPt.x + x * dir[i][<span class="number">0</span>], cPt.y + y * dir[i][<span class="number">1</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">glFlush</span>();</span><br><span class="line">		<span class="built_in">glEnd</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">``` 其中用到的myPoint类</span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myPoint</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//A point or a vector in R^2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myPoint</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">myPoint</span>(GLint X=<span class="number">0</span>,GLint Y=<span class="number">0</span> ):<span class="built_in">x</span>(X),<span class="built_in">y</span>(Y)&#123;&#125;</span><br><span class="line">	GLint x, y;</span><br><span class="line">&#125;;</span><br><span class="line">myPoint <span class="keyword">operator</span>+(<span class="type">const</span> myPoint&amp; a, <span class="type">const</span> myPoint&amp; b) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">myPoint</span>(a.x + b.x, a.y + b.y);</span><br><span class="line">&#125;</span><br><span class="line">myPoint <span class="keyword">operator</span>-(<span class="type">const</span> myPoint&amp; a, <span class="type">const</span> myPoint&amp; b) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">myPoint</span>(a.x - b.x, a.y - b.y);</span><br><span class="line">&#125;</span><br><span class="line">GLint <span class="keyword">operator</span>*(<span class="type">const</span> myPoint&amp; a, <span class="type">const</span> myPoint&amp; b) &#123;</span><br><span class="line">	<span class="keyword">return</span> a.x * b.x + a.y * b.y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码汇总"><a href="#代码汇总" class="headerlink" title="代码汇总"></a>代码汇总</h2><p><strong>你可以在这里找到目前为止所有的源代码</strong><br><a target="_blank" rel="noopener" href="https://www.aliyundrive.com/s/69yuAJoMRWD" title="阿里">阿里云盘-代码汇总</a><br><a target="_blank" rel="noopener" href="https://gitee.com/zhy2216095277/Computer-graphics-basic-rendering-algorithm" title="gitee">gitee-代码汇总</a></p>
<h2 id="下-上一篇"><a href="#下-上一篇" class="headerlink" title="下&#x2F;上一篇"></a>下&#x2F;上一篇</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/articles/17341756.html">上一篇：圆形、圆弧段的绘制算法</a><br><a href="">下一篇：暂无</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/计算机图形学笔记一——绘制直线的算法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/30828/" class="article-date">
      <time datetime="2023-04-21T20:24:00.000Z" itemprop="datePublished">2023-04-21</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/30828/">计算机图形学笔记一——绘制直线的算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="绘制直线的算法"><a href="#绘制直线的算法" class="headerlink" title="绘制直线的算法"></a>绘制直线的算法</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/articles/17341756.html">下一篇-&gt;圆形的绘制</a></p>
<h2 id="数值微分法"><a href="#数值微分法" class="headerlink" title="数值微分法"></a>数值微分法</h2><p><strong>数值微分法（digital differential analyzer DDA）使用直线的增量方程来计算直线的下一个迭代点像素的方法。直线的微分方程：</strong><br>$$<br>\frac{dy}{dx}&#x3D;\frac{\Delta y}{\Delta x}&#x3D;\frac{y_1-y_0}{x_1-x_0}&#x3D;k<br>$$<br><strong>得到迭代公式：</strong><br>$$<br>x_{i+1}&#x3D;x_i+\beta \Delta x<br>$$<br>$$<br>y_{i+1}&#x3D;y_i +\beta \Delta y<br>$$<br><strong>其中$\beta&#x3D;\frac{1}{max(|\Delta x|,|\Delta y|)}$</strong><br><strong>也就是说，当斜率的绝对值大于1的时候，取y的步长为1，当斜率的绝对值小于1时，取x的步长为1。然后对非步长点进行近似，得到这样的代码</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> x, y;</span><br><span class="line"><span class="type">double</span> k;			<span class="comment">//斜率</span></span><br><span class="line">k = (<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(endy - starty) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(endx - startx));</span><br><span class="line">x = (<span class="type">double</span>)startx, y = (<span class="type">double</span>)starty;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">abs</span>(k) &lt; <span class="number">1.0</span>) &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">abs</span>(endx - startx); i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (endx &gt; startx) &#123;</span><br><span class="line">			x += <span class="number">1</span>;</span><br><span class="line">			y += k;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			x -= <span class="number">1</span>;</span><br><span class="line">			y -= k;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">glVertex2d</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x), <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y + <span class="number">0.5</span>));		<span class="comment">//y四舍五入</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">abs</span>(k) &gt; <span class="number">1.0</span>) &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">abs</span>(endy - starty); i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (endy &gt; starty) &#123;</span><br><span class="line">			y += <span class="number">1</span>;</span><br><span class="line">			x += <span class="number">1.0</span> / k;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			y -= <span class="number">1</span>;</span><br><span class="line">			x -= <span class="number">1.0</span> / k;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">glVertex2d</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x + <span class="number">0.5</span>), <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y));		<span class="comment">//x四舍五入</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>再考虑斜率为0和斜率不存在的情况（垂直x轴和平行x轴），我们可以写出这样的代码，这便是DAA方法的实现。</strong></p>
<p>DAA完整代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DDA_Line</span><span class="params">(<span class="type">int</span> startx, <span class="type">int</span> starty, <span class="type">int</span> endx, <span class="type">int</span> endy)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_POINTS);</span><br><span class="line">	<span class="keyword">if</span> (startx != endx &amp;&amp; starty != endy)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">double</span> x, y;</span><br><span class="line">		<span class="type">double</span> k;			<span class="comment">//斜率</span></span><br><span class="line">		k = (<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(endy - starty) /<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(endx - startx));</span><br><span class="line">		x = (<span class="type">double</span>)startx, y = (<span class="type">double</span>)starty;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">abs</span>(k)&lt;<span class="number">1.0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">abs</span>(endx - startx); i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (endx &gt; startx) &#123;</span><br><span class="line">					x += <span class="number">1</span>;</span><br><span class="line">					y += k;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					x -= <span class="number">1</span>;</span><br><span class="line">					y -= k;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">glVertex2d</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x), <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y<span class="number">+0.5</span>));		<span class="comment">//y四舍五入</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">abs</span>(k) &gt; <span class="number">1.0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">abs</span>(endy - starty); i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (endy &gt; starty) &#123;</span><br><span class="line">					y += <span class="number">1</span>;</span><br><span class="line">					x += <span class="number">1.0</span>/k;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					y -= <span class="number">1</span>;</span><br><span class="line">					x -= <span class="number">1.0</span>/k;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">glVertex2d</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x + <span class="number">0.5</span>), <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y));		<span class="comment">//x四舍五入</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (startx == endx) &#123;<span class="comment">//垂直画线</span></span><br><span class="line">		<span class="keyword">if</span> (starty &lt; endy) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = starty; i &lt; endy; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2d</span>(startx, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (starty &gt; endy) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = endy; i &lt; starty; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2d</span>(startx, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (starty == endy) &#123;<span class="comment">//水平画线</span></span><br><span class="line">		<span class="keyword">if</span> (startx &lt; endx) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = startx; i &lt; endx; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2d</span>(i, starty);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (startx &gt; endx) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = endx; i &lt; startx; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2d</span>(i, starty);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glFlush</span>();</span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="中点画线算法"><a href="#中点画线算法" class="headerlink" title="中点画线算法"></a>中点画线算法</h2><p><strong>不进行除法运算，减少计算量，使用一种近似的思想进行取样。下面两幅图中说明了这种算法的实施方法：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230421191128590-513372133_1726324554561.jpg" alt="image"><br><strong>当曲线在一格的中间偏上时，使用上面的点作为采样点，当在中间偏下时，使用下面的一格。如此计算，便能绕靠斜率的除法运算。</strong><br><strong>实际实现方法：从左边的点开始，每次往右移动一格，计算这个点的中点处y与函数值的差，如果大于零，则y不变；反之y向上（下）移动一格。</strong><br><strong>那么有两个要求：<br>一、计算y移动的方向是上还是下<br>二、开始的点必须在左边</strong><br><strong>分析一下这个差值的计算：</strong><br>$$<br>F(x,y)&#x3D;ax+by+c&#x3D;0 </p>
<p>a&#x3D;y_0-y_1 </p>
<p>b&#x3D;x_1-x_0 </p>
<p>c&#x3D;x_0y_1-x_1y_0 </p>
<p>d&#x3D;F(x_i+1,y_i+0.5)<br>$$<br><strong>其中d也就是中点和直线的竖直距离，我们可以通过判断d的正负来进行采样。进一步分析</strong><br><strong>当d&gt;&#x3D;0时，下一个构造点为F$x_i+2,y_i$，那么</strong></p>
<p>$$<br>d_1&#x3D;a(x_i+1+1)+b(y_i+0.5)+c&#x3D;d+a<br>$$<br><strong>同理，当$d&lt;0$时d$_1&#x3D;F(x_i+2,y_i+1.5)$，即：</strong></p>
<p>$d&#x3D;a(x_i+2)+b(y_i+1.5)+c&#x3D;d+a+b$ </p>
<p><strong>这样我们就得到了迭代方程，我们可以写出这样的代码：</strong></p>
<blockquote>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (startx != endx &amp;&amp; starty != endy)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">bool</span> kFlag = <span class="number">0</span>;		<span class="comment">//斜率是否大于1</span></span><br><span class="line">	<span class="type">int</span> sFlag = <span class="number">1</span>;			<span class="comment">//斜率的正负</span></span><br><span class="line">	<span class="keyword">if</span> (startx &gt; endx) &#123;		<span class="comment">//因为算法是x递增的，所以要保持起点x在终点左边</span></span><br><span class="line">		<span class="type">int</span> tempx = startx, tempy = starty;</span><br><span class="line">		startx = endx, starty = endy;</span><br><span class="line">		endx = tempx, endy = tempy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">abs</span>(starty - endy) &gt; <span class="built_in">abs</span>(startx - endx)) &#123;</span><br><span class="line">		kFlag = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (starty &gt; endy) &#123;		<span class="comment">//标记斜率小于零</span></span><br><span class="line">		sFlag = <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> a, b, TA, TAB, d, x, y;</span><br><span class="line">	<span class="keyword">if</span> (sFlag == <span class="number">-1</span>)</span><br><span class="line">		endy = starty + (starty - endy);</span><br><span class="line"></span><br><span class="line">	a = starty - endy;</span><br><span class="line">	b = endx - startx;</span><br><span class="line">	TA = <span class="number">2</span> * a;					<span class="comment">//twoA</span></span><br><span class="line">	TAB = <span class="number">2</span> * (a + b);		<span class="comment">//twoAB</span></span><br><span class="line">	d = <span class="number">2</span> * a + b;</span><br><span class="line">	x = startx, y = starty;</span><br><span class="line">	<span class="keyword">if</span> (!kFlag) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (endx - startx); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (d &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(++x, y);</span><br><span class="line">				d += TA;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(++x, y += sFlag);</span><br><span class="line">				d += TAB;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (kFlag) &#123;</span><br><span class="line">		<span class="keyword">if</span> (kFlag == <span class="number">1</span>) &#123;</span><br><span class="line">			TA = <span class="number">2</span> * b;</span><br><span class="line">			d = <span class="number">2</span> * b + a;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">abs</span>(endy - starty); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (d &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(++x, y += sFlag);</span><br><span class="line">				d += TAB;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(x, y += sFlag);</span><br><span class="line">				d += TA;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>你可以在这里找到所有代码</strong></p>
<p>TMP算法完整代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TMP_Line</span><span class="params">(<span class="type">int</span> startx, <span class="type">int</span> starty, <span class="type">int</span> endx, <span class="type">int</span> endy)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_POINTS);</span><br><span class="line">	<span class="keyword">if</span> (startx != endx &amp;&amp; starty != endy)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">bool</span> kFlag = <span class="number">0</span>;		<span class="comment">//斜率是否大于1</span></span><br><span class="line">		<span class="type">int</span> sFlag = <span class="number">1</span>;			<span class="comment">//斜率的正负</span></span><br><span class="line">		<span class="keyword">if</span> (startx &gt; endx) &#123;		<span class="comment">//因为算法是x递增的，所以要保持起点x在终点左边</span></span><br><span class="line">			<span class="type">int</span> tempx = startx, tempy = starty;</span><br><span class="line">			startx = endx, starty = endy;</span><br><span class="line">			endx = tempx, endy = tempy;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">abs</span>(starty - endy) &gt; <span class="built_in">abs</span>(startx - endx)) &#123;</span><br><span class="line">			kFlag = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (starty &gt; endy) &#123;		<span class="comment">//标记斜率小于零</span></span><br><span class="line">			sFlag = <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> a, b, TA, TAB, d, x, y;</span><br><span class="line">		<span class="keyword">if</span> (sFlag == <span class="number">-1</span>)</span><br><span class="line">			endy = starty + (starty - endy);</span><br><span class="line"></span><br><span class="line">		a = starty - endy;</span><br><span class="line">		b = endx - startx;</span><br><span class="line">		TA = <span class="number">2</span> * a;					<span class="comment">//twoA</span></span><br><span class="line">		TAB = <span class="number">2</span> * (a + b);		<span class="comment">//twoAB</span></span><br><span class="line">		d = <span class="number">2</span> * a + b;</span><br><span class="line">		x = startx, y = starty;</span><br><span class="line">		<span class="keyword">if</span> (!kFlag) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (endx - startx); i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (d &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(++x, y);</span><br><span class="line">					d += TA;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(++x , y +=sFlag);</span><br><span class="line">					d += TAB;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (kFlag) &#123;</span><br><span class="line">			<span class="keyword">if</span> (kFlag == <span class="number">1</span>) &#123;</span><br><span class="line">				TA = <span class="number">2</span> * b;</span><br><span class="line">				d = <span class="number">2</span> * b + a;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">abs</span>(endy - starty); i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (d &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(++x , y +=sFlag);</span><br><span class="line">					d += TAB;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(x, y+=sFlag);</span><br><span class="line">					d += TA;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (startx == endx) &#123;<span class="comment">//垂直画线</span></span><br><span class="line">		<span class="keyword">if</span> (starty &lt; endy) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = starty; i &lt; endy; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(startx, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (starty &gt; endy) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = endy; i &lt; starty; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(startx, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (starty == endy) &#123;<span class="comment">//水平画线</span></span><br><span class="line">		<span class="keyword">if</span> (startx &lt; endx) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = startx; i &lt; endx; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(i, starty);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (startx &gt; endx) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = endx; i &lt; startx; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(i, starty);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glFlush</span>();</span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Bresenham画线算法"><a href="#Bresenham画线算法" class="headerlink" title="Bresenham画线算法"></a>Bresenham画线算法</h2><p><strong>这是目前计算机图形学使用的最多的直线生成算法。在计算最佳逼近中使用的全部都是整数运算，可以大幅度的提升计算速度。</strong><br><strong>与TMP不同的一点就是，TMP是计算中点与直线上的点，而Bresenham是计算上下格子与直线竖直距离的差。也就是下面图像中的d2-d1</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230421195628347-1007206271_1726324554561.jpg" alt="image"><br><strong>推导过程如下：</strong><br><strong>直线方程可以表示为（不管两种特殊情况）</strong></p>
<p>$$<br>y&#x3D;kx+b </p>
<p>k&#x3D;\frac{y_1-y_0}{x_1-x_0}&#x3D;\frac{dy}{dx},b&#x3D;y_0-kx_0<br>$$</p>
<p><strong>当 $ 0&lt;k&lt;1$时直线向正方向前进一个像素,对应的最佳逼近的 $x_{i+1}&#x3D;x_i+1$, $y_{i+1}&#x3D;y_i+1$or $y_i$</strong></p>
<p>$$<br>y&#x3D;k(x_i+1)+b </p>
<p>d_1&#x3D;y-y_i </p>
<p>d_2&#x3D;y_i+1-y<br>$$</p>
<p><strong>令</strong></p>
<p>$$<br>d_1-d_2&#x3D;2y-2y_i-1&#x3D;2(k(x_i+1)+b)-2y_i-1<br>$$</p>
<p><strong>当 $d_1-d_2&gt;0$时</strong></p>
<p>$y_{i+1}&#x3D;y_i+1$</p>
<p><strong>当 $d_1-d_2&lt;&#x3D;0$时</strong></p>
<p>$y_{i+1}&#x3D;y_i$ </p>
<p><strong>魔法:当dx&gt;0时,把 $d_10d_2$乘上$dx$,不影响整个式子的正负得到:</strong></p>
<p>$$<br>p_i&#x3D;dx(d_1-d_2)<br>$$</p>
<p><strong>又</strong></p>
<p>$$<br>k&#x3D;\frac{dy}{dx}<br>$$</p>
<p><strong>所以</strong></p>
<p>$$<br>p_i&#x3D;2x_0dy-2y_idx+2dy+(2b-1)dx<br>$$</p>
<p><strong>当i&#x3D;0时,得到迭代起点:</strong></p>
<p>$$<br>p_0&#x3D;2dy-dx<br>$$</p>
<p><strong>当 $p_i&gt;0时$</strong></p>
<p>$$<br>p_{i+1}&#x3D;pi+2dy-2dx<br>$$</p>
<p><strong>当 $p_i&lt;&#x3D;0时$</strong></p>
<p>$$<br>p_{i+1}&#x3D;p_i+2dy<br>$$</p>
<p><strong>推导到此结束,下面是实现,这个实现和TMP十分相似,但是计算量比TMP稍微小一点。</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (startx != endx &amp;&amp; starty != endy) &#123;</span><br><span class="line">	<span class="type">bool</span> kFlag = <span class="number">0</span>;		<span class="comment">//斜率是否大于1</span></span><br><span class="line">	<span class="type">int</span> sFlag = <span class="number">1</span>;			<span class="comment">//斜率的正负</span></span><br><span class="line">	<span class="keyword">if</span> (startx &gt; endx) &#123;		<span class="comment">//因为算法是x递增的，所以要保持起点x在终点左边</span></span><br><span class="line">		<span class="type">int</span> tempx = startx, tempy = starty;</span><br><span class="line">		startx = endx, starty = endy;</span><br><span class="line">		endx = tempx, endy = tempy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">abs</span>(starty - endy) &gt; <span class="built_in">abs</span>(startx - endx)) &#123;</span><br><span class="line">		kFlag = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (starty &gt; endy) &#123;		<span class="comment">//标记斜率小于零</span></span><br><span class="line">		sFlag = <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> x, y;</span><br><span class="line">	<span class="type">int</span> dx, dy, p;</span><br><span class="line">	<span class="keyword">if</span> (sFlag == <span class="number">-1</span>)</span><br><span class="line">		endy = starty + (starty - endy);</span><br><span class="line">	dx = endx - startx;</span><br><span class="line">	dy = endy - starty;</span><br><span class="line">	x = startx, y = starty;</span><br><span class="line">	<span class="keyword">if</span> (!kFlag) &#123;</span><br><span class="line">		p = <span class="number">2</span> * dy - dx;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (endx - startx); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (p &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(++x, y);</span><br><span class="line">				p += <span class="number">2</span> * dy;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(++x, y += sFlag);</span><br><span class="line">				p += <span class="number">2</span> * dy - <span class="number">2</span> * dx;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		p = <span class="number">2</span> * dx - dy;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (endy - starty); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (p &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(x, y += sFlag);</span><br><span class="line">				p += <span class="number">2</span> * dx;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(++x, y += sFlag);</span><br><span class="line">				p += <span class="number">2</span> * dx - <span class="number">2</span> * dy;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>同样的，你可以在这里找到完整代码：</strong></p>
<p>BRESENHAM算法完整代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">BRESENHAM_Line</span><span class="params">(<span class="type">int</span> startx, <span class="type">int</span> starty, <span class="type">int</span> endx, <span class="type">int</span> endy)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">glBegin</span>(GL_POINTS);</span><br><span class="line">	<span class="keyword">if</span> (startx != endx &amp;&amp; starty != endy) &#123;</span><br><span class="line">		<span class="type">bool</span> kFlag = <span class="number">0</span>;		<span class="comment">//斜率是否大于1</span></span><br><span class="line">		<span class="type">int</span> sFlag = <span class="number">1</span>;			<span class="comment">//斜率的正负</span></span><br><span class="line">		<span class="keyword">if</span> (startx &gt; endx) &#123;		<span class="comment">//因为算法是x递增的，所以要保持起点x在终点左边</span></span><br><span class="line">			<span class="type">int</span> tempx = startx, tempy = starty;</span><br><span class="line">			startx = endx, starty = endy;</span><br><span class="line">			endx = tempx, endy = tempy;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">abs</span>(starty - endy) &gt; <span class="built_in">abs</span>(startx - endx)) &#123;</span><br><span class="line">			kFlag = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (starty &gt; endy) &#123;		<span class="comment">//标记斜率小于零</span></span><br><span class="line">			sFlag = <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> x, y;</span><br><span class="line">		<span class="type">int</span> dx, dy, p;</span><br><span class="line">		<span class="keyword">if</span> (sFlag == <span class="number">-1</span>)</span><br><span class="line">			endy = starty + (starty - endy);</span><br><span class="line">		dx = endx - startx;</span><br><span class="line">		dy = endy - starty;</span><br><span class="line">		x = startx, y = starty;</span><br><span class="line">		<span class="keyword">if</span> (!kFlag) &#123;</span><br><span class="line">			p = <span class="number">2</span> * dy - dx;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (endx - startx); i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (p &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(++x, y);</span><br><span class="line">					p += <span class="number">2</span> * dy;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(++x, y += sFlag);</span><br><span class="line">					p += <span class="number">2</span> * dy - <span class="number">2</span> * dx;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			p = <span class="number">2</span> * dx - dy;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; (endy - starty); i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (p &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(x, y += sFlag);</span><br><span class="line">					p += <span class="number">2</span> * dx;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">glVertex2i</span>(++x, y += sFlag);</span><br><span class="line">					p += <span class="number">2</span> * dx - <span class="number">2</span> * dy;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (startx == endx) &#123;<span class="comment">//垂直画线</span></span><br><span class="line">		<span class="keyword">if</span> (starty &lt; endy) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = starty; i &lt; endy; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(startx, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (starty &gt; endy) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = endy; i &lt; starty; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(startx, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (starty == endy) &#123;<span class="comment">//水平画线</span></span><br><span class="line">		<span class="keyword">if</span> (startx &lt; endx) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = startx; i &lt; endx; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(i, starty);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (startx &gt; endx) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = endx; i &lt; startx; i++) &#123;</span><br><span class="line">				<span class="built_in">glVertex2i</span>(i, starty);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glFlush</span>();</span><br><span class="line">	<span class="built_in">glEnd</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="代码汇总"><a href="#代码汇总" class="headerlink" title="代码汇总"></a>代码汇总</h2><p>DrawLine.hpp代码</p>
<pre><code class="language-cpp">//DrawLine.hpp
#pragma once
#include &lt;cmath&gt;
#include &lt;gl/glut.h&gt;

/*
数值微分算法实现
*/
/// &lt;summary&gt;
/// digitial differential analyzer 
/// called DAA
/// &lt;/summary&gt;
/// &lt;param name=&quot;startx&quot;&gt;起始位置x&lt;/param&gt;
/// &lt;param name=&quot;starty&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;endx&quot;&gt;终止位置x&lt;/param&gt;
/// &lt;param name=&quot;endy&quot;&gt;&lt;/param&gt;
void DDA_Line(int startx, int starty, int endx, int endy) &#123;
	glBegin(GL_POINTS);
	if (startx != endx &amp;&amp; starty != endy)
	&#123;
		double x, y;
		double k;			//斜率
		k = (static_cast&lt;float&gt;(endy - starty) /static_cast&lt;float&gt;(endx - startx));
		x = (double)startx, y = (double)starty;
		if (abs(k)&lt;1.0) &#123;
			for (int i = 0; i &lt; abs(endx - startx); i++) &#123;
				if (endx &gt; startx) &#123;
					x += 1;
					y += k;
				&#125;
				else &#123;
					x -= 1;
					y -= k;
				&#125;
				glVertex2i(static_cast&lt;int&gt;(x), static_cast&lt;int&gt;(y+0.5));		//y四舍五入
			&#125;
		&#125;
		else if (abs(k) &gt; 1.0) &#123;
			for (int i = 0; i &lt; abs(endy - starty); i++) &#123;
				if (endy &gt; starty) &#123;
					y += 1;
					x += 1.0/k;
				&#125;
				else &#123;
					y -= 1;
					x -= 1.0/k;
				&#125;
				glVertex2i(static_cast&lt;int&gt;(x + 0.5), static_cast&lt;int&gt;(y));		//x四舍五入
			&#125;
		&#125;
	&#125;
	else if (startx == endx) &#123;//垂直画线
		if (starty &lt; endy) &#123;
			for (int i = starty; i &lt; endy; i++) &#123;
				glVertex2i(startx, i);
			&#125;
		&#125;
		else if (starty &gt; endy) &#123;
			for (int i = endy; i &lt; starty; i++) &#123;
				glVertex2i(startx, i);
			&#125;
		&#125;
	&#125;
	else if (starty == endy) &#123;//水平画线
		if (startx &lt; endx) &#123;
			for (int i = startx; i &lt; endx; i++) &#123;
				glVertex2i(i, starty);
			&#125;
		&#125;
		else if (startx &gt; endx) &#123;
			for (int i = endx; i &lt; startx; i++) &#123;
				glVertex2i(i, starty);
			&#125;
		&#125;
	&#125;
	glFlush();
	glEnd();
&#125;

/*
中点画线算法实现
*/
/// &lt;summary&gt;
/// The Middle Point
/// Called TMP
/// &lt;/summary&gt;
/// &lt;param name=&quot;startx&quot;&gt;起始位置x&lt;/param&gt;
/// &lt;param name=&quot;starty&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;endx&quot;&gt;终止位置x&lt;/param&gt;
/// &lt;param name=&quot;endy&quot;&gt;&lt;/param&gt;
void TMP_Line(int startx, int starty, int endx, int endy) &#123;
	glBegin(GL_POINTS);
	if (startx != endx &amp;&amp; starty != endy)
	&#123;
		bool kFlag = 0;		//斜率是否大于1
		int sFlag = 1;			//斜率的正负
		if (startx &gt; endx) &#123;		//因为算法是x递增的，所以要保持起点x在终点左边
			int tempx = startx, tempy = starty;
			startx = endx, starty = endy;
			endx = tempx, endy = tempy;
		&#125;
		if (abs(starty - endy) &gt; abs(startx - endx)) &#123;
			kFlag = true;
		&#125;
		if (starty &gt; endy) &#123;		//标记斜率小于零
			sFlag = -1;
		&#125;
		int a, b, TA, TAB, d, x, y;
		if (sFlag == -1)
			endy = starty + (starty - endy);

		a = starty - endy;
		b = endx - startx;
		TA = 2 * a;					//twoA
		TAB = 2 * (a + b);		//twoAB
		d = 2 * a + b;
		x = startx, y = starty;
		if (!kFlag) &#123;
			for (int i = 0; i &lt; (endx - startx); i++) &#123;
				if (d &gt;= 0) &#123;
					glVertex2i(++x, y);
					d += TA;
				&#125;
				else &#123;
					glVertex2i(++x , y +=sFlag);
					d += TAB;
				&#125;
			&#125;
		&#125;
		else if (kFlag) &#123;
			if (kFlag == 1) &#123;
				TA = 2 * b;
				d = 2 * b + a;
			&#125;
			for (int i = 0; i &lt; abs(endy - starty); i++) &#123;
				if (d &gt;= 0) &#123;
					glVertex2i(++x , y +=sFlag);
					d += TAB;
				&#125;
				else &#123;
					glVertex2i(x, y+=sFlag);
					d += TA;
				&#125;
			&#125;
		&#125;
	&#125;
	else if (startx == endx) &#123;//垂直画线
		if (starty &lt; endy) &#123;
			for (int i = starty; i &lt; endy; i++) &#123;
				glVertex2i(startx, i);
			&#125;
		&#125;
		else if (starty &gt; endy) &#123;
			for (int i = endy; i &lt; starty; i++) &#123;
				glVertex2i(startx, i);
			&#125;
		&#125;
	&#125;
	else if (starty == endy) &#123;//水平画线
		if (startx &lt; endx) &#123;
			for (int i = startx; i &lt; endx; i++) &#123;
				glVertex2i(i, starty);
			&#125;
		&#125;
		else if (startx &gt; endx) &#123;
			for (int i = endx; i &lt; startx; i++) &#123;
				glVertex2i(i, starty);
			&#125;
		&#125;
	&#125;
	glFlush();
	glEnd();
&#125;

/*
Bresenham算法
这是图形学中用的最多的直线生成算法，全部是整数计算，加快了计算的速度
*/
/// &lt;summary&gt;
/// Bresenham
/// &lt;/summary&gt;
/// &lt;param name=&quot;startx&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;starty&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;endx&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;endy&quot;&gt;&lt;/param&gt;
void BRESENHAM_Line(int startx, int starty, int endx, int endy) &#123;
	glBegin(GL_POINTS);
	if (startx != endx &amp;&amp; starty != endy) &#123;
		bool kFlag = 0;		//斜率是否大于1
		int sFlag = 1;			//斜率的正负
		if (startx &gt; endx) &#123;		//因为算法是x递增的，所以要保持起点x在终点左边
			int tempx = startx, tempy = starty;
			startx = endx, starty = endy;
			endx = tempx, endy = tempy;
		&#125;
		if (abs(starty - endy) &gt; abs(startx - endx)) &#123;
			kFlag = true;
		&#125;
		if (starty &gt; endy) &#123;		//标记斜率小于零
			sFlag = -1;
		&#125;
		int x, y;
		int dx, dy, p;
		if (sFlag == -1)
			endy = starty + (starty - endy);
		dx = endx - startx;
		dy = endy - starty;
		x = startx, y = starty;
		if (!kFlag) &#123;
			p = 2 * dy - dx;
			for (int i = 0; i &lt; (endx - startx); i++) &#123;
				if (p &lt;= 0) &#123;
					glVertex2i(++x, y);
					p += 2 * dy;
				&#125;
				else &#123;
					glVertex2i(++x, y += sFlag);
					p += 2 * dy - 2 * dx;
				&#125;
			&#125;
		&#125;
		else &#123;
			p = 2 * dx - dy;
			for (int i = 0;i &lt; (endy - starty); i++) &#123;
				if (p &lt;= 0) &#123;
					glVertex2i(x, y += sFlag);
					p += 2 * dx;
				&#125;
				else &#123;
					glVertex2i(++x, y += sFlag);
					p += 2 * dx - 2 * dy;
				&#125;
			&#125;
		&#125;
	&#125;
	else if (startx == endx) &#123;//垂直画线
		if (starty &lt; endy) &#123;
			for (int i = starty; i &lt; endy; i++) &#123;
				glVertex2i(startx, i);
			&#125;
		&#125;
		else if (starty &gt; endy) &#123;
			for (int i = endy; i &lt; starty; i++) &#123;
				glVertex2i(startx, i);
			&#125;
		&#125;
	&#125;
	else if (starty == endy) &#123;//水平画线
		if (startx &lt; endx) &#123;
			for (int i = startx; i &lt; endx; i++) &#123;
				glVertex2i(i, starty);
			&#125;
		&#125;
		else if (startx &gt; endx) &#123;
			for (int i = endx; i &lt; startx; i++) &#123;
				glVertex2i(i, starty);
			&#125;
		&#125;
	&#125;
	glFlush();
	glEnd();
&#125;
``` 用于测试的一个主函数

```cpp
/*
你可以使用左键绘制顶点
你可以使用右键删除顶点
直线的绘制沿着顶点顺序
*/
#include &lt;gl/glut.h&gt;
#include &lt;iostream&gt;
#include &lt;list&gt;
#include &quot;DrawLine.hpp&quot;
using namespace std;
#define m_POINT_SIZE 10
#define m_LINE_SIZE 2
list&lt;pair&lt;int, int &gt;&gt;Vertex;
void onDisplay();
void onReshape(int w, int h);
void onMouse(int button, int state, int x, int y);
void onReshape(int w, int h)
&#123;
	// 设置视口大小
	glViewport(0, 0, w, h);
	// 切换矩阵模式为投影矩阵
	glMatrixMode(GL_PROJECTION);
	// 载入单位矩阵
	glLoadIdentity();
	// 进行二维平行投影
	gluOrtho2D(0, w, h, 0);
	// 切换矩阵模式为模型矩阵
	glMatrixMode(GL_MODELVIEW);
	// 发送重绘
	glutPostRedisplay();
&#125;
void onMouse(int button, int state, int x, int y)&#123;
	if (state == GLUT_DOWN) &#123;
		if (button == GLUT_LEFT_BUTTON)Vertex.push_back(make_pair(x, y));
		else if (button == GLUT_RIGHT_BUTTON) &#123;
			auto ibeg = Vertex.begin();
			while (ibeg != Vertex.end()) &#123;
				if (((x - ibeg-&gt;first) * (x - ibeg-&gt;first)) + ((y - ibeg-&gt;second) * (y - ibeg-&gt;second)) &lt; 400) &#123;
					Vertex.erase(ibeg);
					break;
				&#125;
				ibeg++;
			&#125;
		&#125;
	&#125;
	onDisplay();
&#125;
void onDisplay() &#123;
	glClearColor(224 / 255.0, 237 / 255.0, 253 / 255.0,1.0);
	glClear(GL_COLOR_BUFFER_BIT);

	glColor3f(1.0f, 0, 0);
	auto ibeg = Vertex.begin(),jbeg=ibeg;
	bool flag = false;
	while (ibeg != Vertex.end()) &#123;
		glPointSize(m_POINT_SIZE);
		glBegin(GL_POINTS);
		glVertex2i(ibeg-&gt;first, ibeg-&gt;second);
		glEnd();
		glPointSize(m_LINE_SIZE);
		if (!flag)
			flag = true;
		else &#123;
			//这里可以选择直线绘制方式
			BRESENHAM_Line(ibeg-&gt;first, ibeg-&gt;second, jbeg-&gt;first, jbeg-&gt;second);
			//TMP_Line(ibeg-&gt;first, ibeg-&gt;second, jbeg-&gt;first, jbeg-&gt;second);
			//DDA_Line(ibeg-&gt;first, ibeg-&gt;second, jbeg-&gt;first, jbeg-&gt;second);
		&#125;
		jbeg = ibeg;
		ibeg++;
	&#125;
	glutSwapBuffers();
&#125;

int main(int argc, char* argv[])
&#123;
	// 初始化 glut
	glutInit(&amp;argc, argv);
	// 设置 OpenGL 显示模式(双缓存, RGB 颜色模式)
	glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);
	// 设置窗口初始尺寸
	glutInitWindowSize(1000,800);
	// 设置窗口初始位置
	glutInitWindowPosition(0, 0);
	// 设置窗口标题
	glutCreateWindow(&quot;Terix&quot;);
	glutReshapeFunc(onReshape);
	glutDisplayFunc(onDisplay);
	glutMouseFunc(onMouse);
	// 进入 glut 事件循环
	glutMainLoop();
	return 0;
&#125;
``` ## 下一篇 [下一篇-&gt;圆形的绘制](https://www.cnblogs.com/zhywyt/articles/17341756.html)
</code></pre>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/基于Glut的俄罗斯方块开发" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/15450/" class="article-date">
      <time datetime="2023-04-09T19:44:00.000Z" itemprop="datePublished">2023-04-09</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/15450/">基于Glut的俄罗斯方块开发</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h3 id="基于Glut的俄罗斯方块"><a href="#基于Glut的俄罗斯方块" class="headerlink" title="# 基于Glut的俄罗斯方块"></a># 基于Glut的俄罗斯方块</h3><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>作为大一下期的一个C++程序设计的作业，原本李卫明老师是打算让我们用MFC实现一个俄罗斯方块的，但是我不想学习MFC，所以使用了glut来实现它。所有的代码由自己一个人完成，Game类的维护由李卫明老师的教程优化而来。李卫明老师课程传送门：</strong><br><a target="_blank" rel="noopener" href="https://course.educg.net/assignment/imgUploadList.jsp?proNum=1&assignID=17360#/learn/_blank">1.建立框架</a><br><a target="_blank" rel="noopener" href="https://v.youku.com/v_show/id_XNTA5NTE5NjA0NA==.html">2.添加功能模块</a><br><a target="_blank" rel="noopener" href="https://v.youku.com/v_show/id_XNTA5NTIwMjIzNg==.html">3.消息响应和界面绘制</a><br><strong>其中，我借鉴了李老师俄罗斯方块的存储方式（4*4的二维数组来存储一个俄罗斯方块）然后在这篇博客的最后也回答一下李老师提出的这些问题：</strong>  </p>
<p><strong>Q1本游戏开发的主要过程分哪几步？<a href="#Q1">点击跳转</a><br>Q2游戏界面里控件ID有什么作用？ <a href="#Q2">点击跳转</a><br>Q3游戏中主要有哪些类？哪些类使用了继承？ A:并没有<br>Q4用什么表示俄罗斯方块的形状和颜色？<a href="#Q4">点击跳转</a><br>Q5l游戏里的俄罗斯方块判断是否可以下落、左移、右移、旋转的方法是什么？<a href="#Q5">点击跳转</a><br>Q6程序里如何实现俄罗斯方块实际下落、左移、右移、旋转？<a href="#Q6">点击跳转</a><br>Q7程序里是哪里使用了动态分配？如何避免内存泄漏？ A:没有使用，唯一的地方是Vector，不需要自己进行管理。<br>Q8主界面如何绘制、备用俄罗斯方块如何绘制？<a href="#Q8">点击跳转</a><br>Q9如何实现俄罗斯方块的定时下落？<a href="#Q9">点击跳转</a><br>Q10如何实现按钮点击响应？<a href="#Q10">点击跳转</a><br>所以这篇博客可能会比较长，就当自己的一次记录吧。</strong></p>
<h2 id="Game类"><a href="#Game类" class="headerlink" title="Game类"></a>Game类</h2><h3 id="Game类的规划"><a href="#Game类的规划" class="headerlink" title="Game类的规划"></a>Game类的规划</h3><p><strong>在我的Game类里面，存储了整个游戏需要的数据，而且维护了整个游戏的运行，但是因为回调函数不允许绑定了对象的函数指针，所以我使用了友元函数作为回调函数，至于为什么没有使用类的静态函数成员，可能是因为我懒吧。或者这个项目比较小，所以没在乎这么多了。这次的代码及其不规范，算是给自己积累一些经验吧。</strong></p>
<h3 id="Game类的数据成员"><a href="#Game类的数据成员" class="headerlink" title="Game类的数据成员"></a>Game类的数据成员</h3><p><strong>首先我们来分析一下俄罗斯方块这个游戏的场景和运行逻辑：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230408180643868-1071810635_1726324554561.png" alt="image"><br><strong>这里分为了三个方块单位，和一些文字单位，可以看到，蓝色的俄罗斯方块正在随着时间往下走，白色的预备方块静止在等待区域，那么我们需要两个俄罗斯方块对象来存储他们的信息。再看下面的绿色 L 形状的俄罗斯方块，它已经到底了，和场景融为了一体，那么我们也就不需要一个俄罗斯方块的类来存储它了，可以把它存储在场景中，我们用一个二维向量来存储这个场景的信息。</strong></p>
<h4 id="方块成员"><a href="#方块成员" class="headerlink" title="方块成员"></a>方块成员</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230408181549748-2094920393_1726324571706.png" alt="image"><br><strong>Tool类我们稍后再讲，它会是存储一个俄罗斯方块的工具类。然后我们使用vector&lt;vector&lt;int&gt;&gt;来存储这个场景的所有信息。（李卫明老师的教程中使用了动态分配的数组。）</strong></p>
<h4 id="信息成员（分数，等级）"><a href="#信息成员（分数，等级）" class="headerlink" title="信息成员（分数，等级）"></a>信息成员（分数，等级）</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230408183430897-22289316_1726324571706.png" alt="image"><br><strong>分数、最高分和等级我们使用三个无符号整型来存储。等级是难度等级，可以用于我们之后的提高难度。</strong></p>
<h4 id="Tool类"><a href="#Tool类" class="headerlink" title="Tool类"></a>Tool类</h4><p><strong>好了，现在我们来实现最基础的Tool类，Tool类是一个俄罗斯方块对象，它有着这些属性：</strong><br>**<br>1.记录了方俄罗斯方块的类型<br>2.记录了俄罗斯方块的形状<br>3.记录了俄罗斯方块的位置<br>4.记录是否有过移动（用于判断游戏结束）<br>5.可以进行移动、旋转<br>**  </p>
<p><a href="#back">点击返回问题目录</a></p>
<h5 id="1-俄罗斯方块的类型"><a href="#1-俄罗斯方块的类型" class="headerlink" title="1.俄罗斯方块的类型"></a>1.俄罗斯方块的类型</h5><p><strong>我们使用一个枚举类型，来方便自己绘制俄罗斯方块，枚举中的名字为俄罗斯方块的类型，还可以作为绘制方块时的颜色的枚举使用，如下：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230408185147821-1779582490_1726324571706.png" alt="image"><br><strong>其中 WALL是提供给场景使用的一个枚举常量</strong></p>
<h5 id="2-俄罗斯方块的形状"><a href="#2-俄罗斯方块的形状" class="headerlink" title="2.俄罗斯方块的形状"></a>2.俄罗斯方块的形状</h5><p><strong>每一个俄罗斯方块都可以认为被一个4 * 4的网格包裹住了，所以我们可以使用一个4 * 4的二维数组来记录它在地图中所占的位置：</strong></p>
<h5 id="3-俄罗斯方块的位置"><a href="#3-俄罗斯方块的位置" class="headerlink" title="3.俄罗斯方块的位置"></a>3.俄罗斯方块的位置</h5><p><strong>我们记录一个4 * 4的网格的位置，其实只需要这个网格左上角的方块的坐标就可以了，也就是说我们记录俄罗斯方块的位置，其实只需要记录一个点的x、y坐标。</strong></p>
<h5 id="4-是否移动过"><a href="#4-是否移动过" class="headerlink" title="4.是否移动过"></a>4.是否移动过</h5><p><strong>很简单，使用一个bool类型的变量即可，那么我们的Tool类的数据成员看起来像这样：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230408205154842-1045206341_1726324571706.png" alt="image">  </p>
<p><a href="#back">点击返回问题目录</a></p>
<h5 id="5-移动旋转的实现"><a href="#5-移动旋转的实现" class="headerlink" title="5.移动旋转的实现"></a>5.移动旋转的实现</h5><p><strong>判断是否可以旋转的时候，我们就需要和场景中的方块联系起来了，如果一个方块无法往某个方向移动的话，意味着移动了就会与已经存在的方块重合，或者出游戏区域，那么我们的Tool类旋转的工作就是返回一个移动后的Tool类的结果，但是不能直接对自己移动，因为对于一个Tool对象来说，它不能知道自己是否可以移动但是移动的函数，直接移动就行，之后后讲到为什么，这里举两个例子，旋转和下落：</strong></p>
<blockquote>
<p>旋转</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//顺时针旋转</span></span><br><span class="line"><span class="function">Tool <span class="title">Rotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function">Tool <span class="title">NewOne</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			NewOne._data[j][<span class="number">3</span> - i] = _data[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> NewOne;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下落</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MoveDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">setPosition</span>(_x, _y + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>特别的setPosition函数，就是更改了Tool的位置信息，就不说了。然后我们来说一下Tool的构造函数。我们需要自己定义两个构造函数，一个是默认的构造函数，一个是接受三个参数的构造函数，函数原型如下：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230408210520887-1968227040_1726324571706.png" alt="image"><br><strong>它接受了一个坐标和一个类型作为参数，对对象进行初始化。要记得对所有的数据成员进行初始化哦，保持好习惯~</strong></p>
<p>带参的构造函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Tool</span>(<span class="type">int</span> x, <span class="type">int</span> y, ToolType type) </span><br><span class="line">	:_x(x), _y(y), _type(type),<span class="built_in">run</span>(<span class="literal">false</span>) </span><br><span class="line">&#123;</span><br><span class="line">	_data.<span class="built_in">resize</span>(<span class="number">4</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">4</span>));</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			_data[i][j] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">switch</span> (type) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> LL:</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; i++)_data[<span class="number">1</span>][i] = LL;</span><br><span class="line">			_data[<span class="number">2</span>][<span class="number">2</span>] = LL;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> OO:</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">2</span>; i++)</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">2</span>; j++)</span><br><span class="line">					_data[i][j] = OO;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> DOT:</span><br><span class="line">			_data[<span class="number">1</span>][<span class="number">1</span>] = DOT;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> II:</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)_data[<span class="number">1</span>][i] = II;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> TT:</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)_data[<span class="number">2</span>][i] = TT;</span><br><span class="line">			_data[<span class="number">1</span>][<span class="number">1</span>] = TT;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>然后，我们还需要一个默认构造函数，来创建临时的Tool对象：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Tool</span>()</span><br><span class="line">	:<span class="built_in">run</span>(<span class="literal">false</span>),_x(<span class="number">0</span>),_y(<span class="number">0</span>),_type(LL)</span><br><span class="line">&#123;</span><br><span class="line">	_data.<span class="built_in">resize</span>(<span class="number">4</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">4</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>因为没有动态分配的数据（vector可以自己析构，不用处理），所以我们不需要写析构函数，使用默认的析构函数即可。</strong><br><strong>到此，我们的Tool类就写完了。</strong></p>
<h4 id="Game类的数据维护函数（私有）"><a href="#Game类的数据维护函数（私有）" class="headerlink" title="Game类的数据维护函数（私有）"></a>Game类的数据维护函数（私有）</h4><h5 id="NextTool"><a href="#NextTool" class="headerlink" title="NextTool"></a>NextTool</h5><p><strong>Game类有了他自己的数据成员，那么可以开始对数据成员进行维护了，当一个俄罗斯方块落地的时候，替补的俄罗斯方块就会替补当前使用的俄罗斯方块，然后再生成一个新的俄罗斯方块，这个函数我们叫NextTool()</strong></p>
<blockquote>
<p>NextTool</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Game::NextTool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">swap</span>(m_tool, m_next);</span><br><span class="line">	m_tool.<span class="built_in">setPosition</span>(rePx, rePy);</span><br><span class="line">	ToolType aType = <span class="built_in">ToolType</span>(<span class="built_in">abs</span>(<span class="built_in">rand</span>()%(TTEnd-LL))+LL);</span><br><span class="line">	m_next = <span class="built_in">Tool</span>(waitPx, waitPy, aType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>我们首先交换两个Tool对象，然后把工作中的Tool对象m_tool移动到游戏区域，并且把m_next对象重置为一个随机的俄罗斯方块。这里的随机操作其实是比较优美的形式，因为abs(rand()%a)得到是数据的范围是(0,a-1)，但是我们的ToolType的枚举的数值范围是(LL,TTEnd-1)，所以我们设置为abs(rand()%(TTEnd-LL))+LL就解决了这个问题。</strong></p>
<h5 id="AddToMap"><a href="#AddToMap" class="headerlink" title="AddToMap"></a>AddToMap</h5><p><strong>然后当这个Tool无法继续下落的时候，我们判断这个这个Tool对象应该加入场景了，我们创建函数AddToMap():</strong></p>
<blockquote>
<p>AddToMap</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先把游戏方块加入背景</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) </span><br><span class="line">		<span class="keyword">if</span> (m_tool._data[i][j]) </span><br><span class="line">			m_map[i + m_tool._x][j + m_tool._y] = m_tool._data[i][j];</span><br></pre></td></tr></table></figure>

<p><strong>思考一下，什么时候会出现一行被消除？是不是只有某一个对象加入场景的时候？也就是说，我们应该在对象加入场景的时候进行检测，是否存在某行可以消除。我们可以在加入场景的时候记录一下改变的行数，然后对这些改变的行进行检测。最终的AddToMap代码如下：</strong></p>
<p>AddToMap</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Game::AddToMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt;test;</span><br><span class="line">	<span class="comment">//先把游戏方块加入背景</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) </span><br><span class="line">			<span class="keyword">if</span> (m_tool._data[i][j]) &#123;</span><br><span class="line">				m_map[i + m_tool._x][j + m_tool._y] = m_tool._data[i][j];</span><br><span class="line">				test.<span class="built_in">push_back</span>(j + m_tool._y);</span><br><span class="line">			&#125;</span><br><span class="line">	<span class="comment">//检查游戏区域是否可以消除</span></span><br><span class="line">	<span class="keyword">auto</span> ibeg = test.<span class="built_in">begin</span>();</span><br><span class="line">	<span class="keyword">while</span> (ibeg != test.<span class="built_in">end</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> i = *ibeg;</span><br><span class="line">		<span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = dx; j &lt; GameRow; j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!m_map[j][i]) &#123;</span><br><span class="line">				flag = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//可以消除第 i 行</span></span><br><span class="line">		<span class="keyword">if</span> (flag) &#123;</span><br><span class="line">			<span class="comment">//把 i 行上面的所有行向下移动</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> k = i; k &gt; <span class="number">0</span>; k--) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = dx; j &lt; GameRow; j++) &#123;</span><br><span class="line">					m_map[j][k] = m_map[j][k - <span class="number">1</span>];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//把顶部置空</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = dx; j &lt; GameRow + dx; j++)</span><br><span class="line">				m_map[j][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			clearTimes++;</span><br><span class="line">			<span class="comment">//计算加分</span></span><br><span class="line">			_points += GameRow * clearTimes;</span><br><span class="line">			<span class="keyword">if</span> (_points &gt; PB_points) &#123;</span><br><span class="line">				PB = <span class="literal">true</span>;</span><br><span class="line">				PB_points = _points;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//设置难度</span></span><br><span class="line">		Diff = clearTimes / <span class="number">3</span>;</span><br><span class="line">		ibeg++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//如果加入的时候方块没有移动，判断游戏结束</span></span><br><span class="line">	<span class="keyword">if</span> (!m_tool.run) &#123;</span><br><span class="line">		<span class="built_in">GameOver</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>很好，我们的AddToMap函数就这样完成了。接下来就是让我们的Tool对象接受消息然后动起来了。我们需要实现向下、向左、向右以及旋转的判断和实施函数。</strong></p>
<h5 id="向下、向左、向右以及旋转"><a href="#向下、向左、向右以及旋转" class="headerlink" title="向下、向左、向右以及旋转"></a>向下、向左、向右以及旋转</h5><p><a href="#back">点击返回问题目录</a><br><strong>我们的Tool类可以返回变换之后的结果，那么我们的Game类就需要判断是否能够进行变换，以及管理变换，这里我们还是以向下和旋转来举例：</strong></p>
<blockquote>
<p>CanMoveDown</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Game::CanMoveDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (m_tool._data[i][j]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (m_tool._y +j+ <span class="number">1</span> &lt; Cow) &#123;</span><br><span class="line">					<span class="keyword">if</span> (m_map[m_tool._x+i][m_tool._y +j + <span class="number">1</span>])<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这个函数没什么意思，就是一个个的查看，如果重合，那么说明不能进行移动，否则可以。CangetMoveRight函数和CangetMoveLeft函数也相似。本质上是因为平移只需要改变Tool对象的坐标就行了，不需要对节点信息进行修改。让我们来看看旋转</strong></p>
<blockquote>
<p>Rotate</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Game::Rotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//剪枝，如果是中心对称的图形，直接返回true，代表以及完成了旋转。</span></span><br><span class="line">	<span class="keyword">if</span> (m_tool._type == DOT||m_tool._type==OO)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	Tool revTool = m_tool.<span class="built_in">Rotate</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) </span><br><span class="line">			<span class="keyword">if</span> (revTool._data[i][j]) </span><br><span class="line">				<span class="keyword">if</span> (m_map[revTool._x+i][revTool._y+j])<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="comment">//如果没有冲突，直接交换revTool和m_tool，这里和移动赋值的理念有点相似，</span></span><br><span class="line">	<span class="comment">//因为我的m_tool已经不需要了，直接让revTool来进行析构。</span></span><br><span class="line">	<span class="built_in">swap</span>(m_tool, revTool);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>因为旋转的开销还是比较大的，所以我们不进行多次旋转操作，也就是不设置CanRotate函数，直接改成Rotate函数，如果能够旋转就实施了。</strong></p>
<h5 id="Drop"><a href="#Drop" class="headerlink" title="Drop"></a>Drop</h5><p><strong>因为下落有着独特的数据维护方法，所以我们写一个Drop函数来维护这一行为，Drop函数需要检查是否可以下落，以及下落之后的状态更新，还有不能下落时的数据处理。</strong></p>
<blockquote>
<p>Drop</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Game::Drop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">CanMoveDown</span>()) &#123;</span><br><span class="line">		m_tool.run = <span class="literal">true</span>;</span><br><span class="line">		m_tool.<span class="built_in">MoveDown</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">AddToMap</span>();</span><br><span class="line">		<span class="built_in">NextTool</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在可以移动时，更新Tool的移动状态为true，并更新m_tool的数据，</strong></p>
<h5 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h5><p><strong>到这里，我们的数据维护函数就基本上写完了，我们的Game对象可以操控两个Tool对象进行移动，判断是否可以移动，计算游戏加分，计算游戏是否结束等等，接下来我们为Game类添加开始函数，因为在游戏开始之前，我们的Game对象中的Tool对象是没有任何数据的，所以我们使用两次NextTool来让m_tool和m_next都有数据。然后，我们还需要引入一个新的概念游戏状态，我们来看Start函数：</strong></p>
<blockquote>
<p>Start</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Game::Start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	status = RUN;</span><br><span class="line">	<span class="built_in">NextTool</span>();</span><br><span class="line">	<span class="built_in">NextTool</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>我们要做的事情很简单，把游戏的状态更改为<code>RUN</code>，然后调用两次NextTool就行了。</strong></p>
<h4 id="游戏状态的更新"><a href="#游戏状态的更新" class="headerlink" title="游戏状态的更新"></a>游戏状态的更新</h4><p><strong>首先我们为Game类添加一个枚举对象，用于描述游戏的状态：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">	STOP,			<span class="comment">//游戏暂停</span></span><br><span class="line">	PRESTART,		<span class="comment">//游戏开始前</span></span><br><span class="line">	RUN,			<span class="comment">//游戏进行时</span></span><br><span class="line">	GAMEOVER,		<span class="comment">//游戏结束</span></span><br><span class="line">	GAMEWIN,		<span class="comment">//游戏胜利</span></span><br><span class="line">&#125;GameMode;</span><br></pre></td></tr></table></figure>

<p><del>（其实是不存在游戏胜利这一说的，但是我想留一个小彩蛋，所以加入了这一状态，但是达到这个条件是人类不太可能完成的。）</del><br><strong>然后我们为之前需要更改游戏状态的地方添加游戏状态的更改。比如在AddToMap中提到的GameOver函数：</strong></p>
<h5 id="GameOver"><a href="#GameOver" class="headerlink" title="GameOver"></a>GameOver</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Game::GameOver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (_points &gt; PB_points) &#123;</span><br><span class="line">		PB = <span class="literal">true</span>;</span><br><span class="line">		PB_points = _points;</span><br><span class="line">	&#125;</span><br><span class="line">	status = GAMEOVER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>更新游戏状态，并检测是否破纪录。</strong></p>
<h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><p><strong>创建一个Game类的对象的时候，将游戏的状态设置为PRESTAT开始前：</strong></p>
<p>构造函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Game::<span class="built_in">Game</span>() </span><br><span class="line">:<span class="built_in">status</span>(PRESTART),_points(<span class="number">0</span>),<span class="built_in">PB_points</span>(<span class="number">0</span>),<span class="built_in">PB_Diff</span>(<span class="number">0</span>), </span><br><span class="line">	<span class="built_in">clearTimes</span>(<span class="number">0</span>),<span class="built_in">Diff</span>(<span class="number">0</span>),<span class="built_in">PB</span>(<span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">	m_map.<span class="built_in">resize</span>(Row, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(Cow));</span><br><span class="line">	<span class="built_in">srand</span>((<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Cow; i++) &#123;</span><br><span class="line">		<span class="comment">//左边竖墙</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; dx; j++)</span><br><span class="line">			m_map[j][i] = WALL;</span><br><span class="line">		<span class="comment">//中间竖墙</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= dx; j++)</span><br><span class="line">			m_map[GameRow + j][i] = WALL;</span><br><span class="line">		<span class="comment">//右边竖墙</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= dx; j++)</span><br><span class="line">			m_map[Row - j][i] = WALL;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//顶上底下横墙</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dx; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; Row - GameRow - <span class="number">3</span> * dx; j++) &#123;</span><br><span class="line">			m_map[GameRow + <span class="number">2</span> * dx + j][i] = WALL;</span><br><span class="line">			m_map[GameRow + <span class="number">2</span> * dx + j][Cow - <span class="number">1</span> - i] = WALL;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="comment">//中间横墙</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Row - GameRow - <span class="number">3</span> * dx; i++)m_map[GameRow + <span class="number">2</span> * dx + i][<span class="number">4</span> + dx] = WALL;</span><br><span class="line">	<span class="comment">//next Toll右边的横杆</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)m_map[<span class="number">2</span> * dx + GameRow][dx + i] = WALL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>构造函数不仅要初始化所有数据、设置游戏状态外，还需要将场景的WALL部分填充，dx是设置的一个静态整形变量，用于调整边界的厚度。Row和Cow是屏幕的大小；GameRow和GameCow就是游戏区域了，这些是整形常量，这个图可以说明这一关系：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409125459381-2131391684_1726324590488.png" alt="image"><br><strong>这里是我的初始化</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> mapScre = <span class="number">1</span>;						<span class="comment">//场景缩放</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>  NodeSize = <span class="number">20</span>;					<span class="comment">//方形边长</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Cow = <span class="number">30</span> * mapScre;				<span class="comment">//窗口行数  y</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Row = <span class="number">24</span> * mapScre;				<span class="comment">//列数  x</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> GameCow = <span class="number">30</span> * mapScre;			<span class="comment">//游戏场景行数</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> GameRow = <span class="number">16</span> * mapScre;			<span class="comment">//列数</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Game::public</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> dx, dy;				<span class="comment">//用于弥补场景边框距离</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> rePx, rePy;			<span class="comment">//操纵的Tool的初始位置</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> waitPx, waitPy;		<span class="comment">//等待初始位置</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> infoPx, infoPy;		<span class="comment">//信息所绘制的位置</span></span><br></pre></td></tr></table></figure>

<h5 id="reset"><a href="#reset" class="headerlink" title="reset"></a>reset</h5><p><strong>其他的状态更新操作会在消息处理的时候进行，然后我还需要完成Game类的最后一个成员函数reset，用于重置游戏：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Game::reset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	PB = <span class="literal">false</span>;</span><br><span class="line">	status = PRESTART;</span><br><span class="line">	_points = <span class="number">0</span>;</span><br><span class="line">	clearTimes = <span class="number">0</span>;</span><br><span class="line">	Diff = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = dx; i &lt; GameRow+dx; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; GameCow; j++)</span><br><span class="line">			 m_map[i][j] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Glut"><a href="#Glut" class="headerlink" title="Glut"></a>Glut</h2><p><strong>不会装glut的可以参考这篇博客</strong>  </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31788759/article/details/104342559">【Opengl】Glut下载与环境配置</a><br><a href="#irr">返回irrklang</a></p>
<p><strong>另外，我们还需要glfw来提供消息处理的宏定义。这里我只教VS的配置方法：<br>打开你的目标工程，然后点击上方的工具-&gt;NuGet包管理器</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409152852350-2051693689_1726324590488.png" alt="image"><br><strong>点击浏览-&gt;搜索glfw-&gt;下载</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409153000235-919398990_1726324590488.png" alt="image"><br><strong>下载到当前项目就行了。我们需要的头文件有这么两个：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gl/glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>当然还要包括你自己写的Game类的头文件，然后创建我们唯一的Game类对象（作为全局变量）<code>Game myGame;</code>在main函数中对窗口进行初始化：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化 glut</span></span><br><span class="line">	<span class="built_in">glutInit</span>(&amp;argc, argv);</span><br><span class="line">	<span class="comment">// 设置 OpenGL 显示模式(双缓存, RGB 颜色模式)</span></span><br><span class="line">	<span class="built_in">glutInitDisplayMode</span>(GLUT_DOUBLE | GLUT_RGB);</span><br><span class="line">	<span class="comment">// 设置窗口初始尺寸</span></span><br><span class="line">	<span class="built_in">glutInitWindowSize</span>(Row*NodeSize, Cow*NodeSize);</span><br><span class="line">	<span class="comment">// 设置窗口初始位置</span></span><br><span class="line">	<span class="built_in">glutInitWindowPosition</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">// 设置窗口标题</span></span><br><span class="line">	<span class="built_in">glutCreateWindow</span>(<span class="string">&quot;Terix&quot;</span>);</span><br><span class="line">	<span class="comment">// 进入 glut 事件循环</span></span><br><span class="line">	<span class="built_in">glutMainLoop</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>然后我们还需要绑定输入回调函数、显示回调函数、计时器、窗口尺寸改变的回调函数以及设置菜单（非必须）。</strong></p>
<h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><p><strong>回调函数中，大部分需要对Game类的的数据进行更新或者读取，那么最好的办法就是使用成员函数进行绑定，但是这是不被允许的。因为指向绑定函数的指针只能用于调用函数。也就是说我们的回调函数不能是类的成员函数。所以我们将其设置为友元。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">Input</span><span class="params">(<span class="type">int</span> data, <span class="type">int</span> x, <span class="type">int</span> y)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">onDisplay</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">Input</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> nchar, <span class="type">int</span> x, <span class="type">int</span> y)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">processMenuEvents</span><span class="params">(<span class="type">int</span> option)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>然后我们开始，先从简单的来处理</strong></p>
<h3 id="1-窗口尺寸变化回调函数"><a href="#1-窗口尺寸变化回调函数" class="headerlink" title="1.窗口尺寸变化回调函数"></a>1.窗口尺寸变化回调函数</h3><p><strong>这个函数允许我们的窗口在大小改变时，不会出现图像拉扯的情况，设置了这个回调函数之后的效果是这样的：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409153911761-1776818662_1726324590488.png" alt="image"><br><strong>拖动窗口，使其尺寸发生变化，会得到这样的结果：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409154004889-950934146_1726324590488.png" alt="image"><br><strong>不仅如此，我们的投影也发生在这个函数里面，投影的原理我就不讲了，这涉及到一些图形学的内容，有兴趣的可以去看Games101的课程，传送门：</strong><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1X7411F744/?share_source=copy_web" title="中国最好的计算机图形学入门课">【GAMES101-现代计算机图形学入门-闫令琪】</a><br><strong>这里我们设置一个简单的二维平行投影：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">onReshape</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 设置视口大小</span></span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">	<span class="comment">// 切换矩阵模式为投影矩阵</span></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_PROJECTION);</span><br><span class="line">	<span class="comment">// 载入单位矩阵</span></span><br><span class="line">	<span class="built_in">glLoadIdentity</span>();</span><br><span class="line">	<span class="comment">// 进行二维平行投影</span></span><br><span class="line">	<span class="built_in">gluOrtho2D</span>(<span class="number">0</span>, w, h, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 切换矩阵模式为模型矩阵</span></span><br><span class="line">	<span class="built_in">glMatrixMode</span>(GL_MODELVIEW);</span><br><span class="line">	<span class="comment">// 发送重绘</span></span><br><span class="line">	<span class="built_in">glutPostRedisplay</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// In main</span></span><br><span class="line">------------</span><br><span class="line">	<span class="comment">// 设置窗口尺寸变化回调函数</span></span><br><span class="line">	<span class="built_in">glutReshapeFunc</span>(onReshape);</span><br></pre></td></tr></table></figure>

<h3 id="2-计时器"><a href="#2-计时器" class="headerlink" title="2.计时器"></a>2.计时器</h3><p><strong>计时器可以让我们在一定的时间内调用一次该函数，我们需要计时器来使俄罗斯方块自动的下坠，并且下降的速度就是我们调用这个函数所间隔的时间，我们可以利用这点来动态的设置游戏的难度：</strong>  </p>
<p><a href="#back">点击返回问题目录</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Ontime</span><span class="params">(<span class="type">int</span> timeid)</span> </span>&#123;</span><br><span class="line">	timeid++;</span><br><span class="line">	timeid %= <span class="number">1000</span>;</span><br><span class="line">	<span class="comment">//如果游戏进行中，那么下降一格</span></span><br><span class="line">	<span class="keyword">if</span>(myGame.<span class="built_in">getStatus</span>() == RUN)</span><br><span class="line">		myGame.<span class="built_in">Drop</span>();</span><br><span class="line">	<span class="type">int</span> Deltatime = <span class="number">150</span> - <span class="number">3</span> * myGame.<span class="built_in">getDiff</span>();</span><br><span class="line">	<span class="comment">//It is imposible!!!</span></span><br><span class="line">	<span class="keyword">if</span> (Deltatime &lt;= <span class="number">50</span>)myGame.<span class="built_in">ChangeStatus</span>(GAMEWIN) ;</span><br><span class="line">	<span class="comment">//进行图形的绘制</span></span><br><span class="line">	<span class="built_in">onDisplay</span>();</span><br><span class="line">	<span class="built_in">glutTimerFunc</span>(Deltatime, Ontime, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里我设置了一个很简单的难度系统，难度和等级成正比？Deltatime就是调用该函数所间隔的时间，我设置了当Deltatime&lt;&#x3D;50时判定为游戏胜利，也就是1秒钟1000&#x2F;50&#x3D;20帧，就是说它会下降20格。（</strong></p>
<h3 id="3-显示回调函数"><a href="#3-显示回调函数" class="headerlink" title="3.显示回调函数"></a>3.显示回调函数</h3><p><strong>可以看到，在Ontime里面调用了onDisplay函数，这个函数绘制了Game类的所有信息。首先让我们学一下glut的绘制逻辑，在每次绘制之前，我们需要对屏幕上的像素进行清理，我们叫它Clear，清理也不是随便清理，相当于清除了一帧的缓存，清除之前设置一个清楚颜色：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//in OnDisplay()</span></span><br><span class="line">	<span class="comment">// 设置清屏颜色</span></span><br><span class="line">	<span class="built_in">glClearColor</span>(BCR_COLOR,<span class="number">1</span>);</span><br><span class="line">	<span class="comment">// 用指定颜色清除帧缓存</span></span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	绘制操作</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//Clear Buffer</span></span><br><span class="line">	<span class="built_in">glutSwapBuffers</span>();</span><br></pre></td></tr></table></figure>

<p><strong>因为我们采用了双缓存的模式，所以以交换缓存为绘制结束。这样我们就不会出现频闪的问题。这里我也可以解释一下频闪出现的原因，频闪的出现不是因为电脑性能不行，而是你在画图的时候给屏幕发的绘制指令数太多了，应该先把一帧的画图操作全部写在缓存中，然后一次性发给屏幕绘制。</strong></p>
<p><strong>让我们回到俄罗斯方块的游戏场景，这次我们分游戏状态来处理:</strong></p>
<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409160627367-1277858287_1726324605716.png" alt="image"><br><strong>这里我们需要绘制的信息有：两个俄罗斯方块、场景方块、游戏信息。</strong></p>
<h4 id="STOP"><a href="#STOP" class="headerlink" title="STOP"></a>STOP</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409160631565-514488294_1726324605716.png" alt="image"><br><strong>STOP很简单，我们只需要在RUN的基础上加上一句暂停的提示语就行了。</strong></p>
<h4 id="GAMEOVER"><a href="#GAMEOVER" class="headerlink" title="GAMEOVER"></a>GAMEOVER</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409160638296-1473794252_1726324605716.png" alt="image"><br><strong>为了让GAMEOVER的时候，玩家可以感受到一种视觉冲击，所以我设置为了只绘制失败信息，并且如果分数没有超过作者的话，会奉上一句Git Gud，<del>以表示敬意</del>。</strong></p>
<h4 id="PRESTART"><a href="#PRESTART" class="headerlink" title="PRESTART"></a>PRESTART</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409160640858-1534298872_1726324605716.png" alt="image"><br><strong>这个就是游戏开始之前的画面，需要绘制一些指导的信息，比如如何开始游戏、游戏的一些快捷操作、游戏的自动保存机制等等。</strong></p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p><strong>从上面的总结来看，不难发现：只有两个状态需要绘制场景和俄罗斯方块：</strong></p>
<h5 id="如何绘制一个方块？"><a href="#如何绘制一个方块？" class="headerlink" title="如何绘制一个方块？"></a>如何绘制一个方块？</h5><p><strong>在正式的绘制信息之前，我们先来介绍一下如何绘制一个正方形。在glut中绘制一个正方形的方式非常的简单，我们可以直接使用它封装的函数进行绘制。绘制一个矩形的代码会像这样：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glColor3f</span>(ITEM_COLOR);</span><br><span class="line"><span class="built_in">glRectd</span>(x1,y1,x2,y2);</span><br></pre></td></tr></table></figure>

<p><strong>在绘制矩形前设置矩形的填充颜色，然后设置矩形对角线的两个点的坐标就行了。</strong>  </p>
<p><a href="#back">点击返回问题目录</a></p>
<h5 id="如何绘制信息？"><a href="#如何绘制信息？" class="headerlink" title="如何绘制信息？"></a>如何绘制信息？</h5><p><strong>在画面上，还有各种的信息显示，这里使用的是全英文的位图，因为内置的位图不支持中文，所以使用英文图个方便。绘制一串话的代码会像这样：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">char</span> points[<span class="number">20</span>] = <span class="string">&quot;Points:&quot;</span>;</span><br><span class="line"><span class="type">char</span> points_num[<span class="number">20</span>];</span><br><span class="line"><span class="built_in">sprintf</span>(points_num, <span class="string">&quot;%d&quot;</span>, myGame._points);</span><br><span class="line"><span class="comment">//设置字体颜色</span></span><br><span class="line"><span class="built_in">glColor3f</span>(TEXT_COLOR);</span><br><span class="line"><span class="comment">//设置位图位置</span></span><br><span class="line"><span class="built_in">glRasterPos2d</span>(Infox, Infoy);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;points[i]!=<span class="string">&#x27;\0&#x27;</span>;i++)</span><br><span class="line">	<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, points[i]);</span><br><span class="line"><span class="comment">//设置位图位置</span></span><br><span class="line"><span class="built_in">glRasterPos2d</span>(Infox, Infoy<span class="number">+5</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;points_num[i]!=<span class="string">&#x27;\0&#x27;</span>;i++)</span><br><span class="line">	<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, points_num[i]);</span><br></pre></td></tr></table></figure>

<p><strong>因为使用了sprintf，所以这段代码在VS是跑不出来的，我们需要让VS认为这是安全的：加入宏定义：<code>#define _CRT_SECURE_NO_WARNINGS</code></strong></p>
<h5 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h5><p>运行时和暂停的绘制</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//Draw Normal Info</span></span><br><span class="line">	<span class="keyword">if</span> (myGame.status!=PRESTART&amp;&amp;myGame.status!=GAMEOVER&amp;&amp;myGame.status!=GAMEWIN) &#123;</span><br><span class="line">		<span class="comment">//Draw BackGroud</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Row; i++) &#123;</span><br><span class="line">			<span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; Cow; j++) &#123;</span><br><span class="line">				<span class="keyword">switch</span> (myGame.m_map[i][j]) &#123;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">					flag = <span class="literal">false</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::LL:</span><br><span class="line">					<span class="built_in">glColor3f</span>(LL_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::OO:</span><br><span class="line">					<span class="built_in">glColor3f</span>(OO_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::DOT:</span><br><span class="line">					<span class="built_in">glColor3f</span>(DOT_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::II:</span><br><span class="line">					<span class="built_in">glColor3f</span>(II_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::TT:</span><br><span class="line">					<span class="built_in">glColor3f</span>(TT_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::WALL:</span><br><span class="line">					<span class="built_in">glColor3f</span>(WALL_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">default</span>:</span><br><span class="line">					<span class="built_in">glColor3f</span>(ELSE_COLOR);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (flag)</span><br><span class="line">					<span class="built_in">glRectd</span>(i * NodeSize, j * NodeSize, (i + <span class="number">1</span>) * NodeSize, (j + <span class="number">1</span>) * NodeSize);</span><br><span class="line">				</span><br><span class="line">				flag = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Draw Active Terix</span></span><br><span class="line">		<span class="keyword">switch</span> (myGame.m_tool._type) &#123;</span><br><span class="line">		<span class="keyword">case</span> Game::LL:</span><br><span class="line">			<span class="built_in">glColor3f</span>(LL_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::OO:</span><br><span class="line">			<span class="built_in">glColor3f</span>(OO_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::DOT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(DOT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::II:</span><br><span class="line">			<span class="built_in">glColor3f</span>(II_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::TT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(TT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">glColor3f</span>(ELSE_COLOR);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (myGame.m_tool._data[i][j])</span><br><span class="line">					<span class="built_in">glRectd</span>((myGame.m_tool._x + i) * NodeSize, (myGame.m_tool._y + j) * NodeSize, (myGame.m_tool._x + i + <span class="number">1</span>) * NodeSize, (myGame.m_tool._y + j + <span class="number">1</span>) * NodeSize);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//Draw Waiting Terix</span></span><br><span class="line">		<span class="keyword">switch</span> (myGame.m_next._type) &#123;</span><br><span class="line">		<span class="keyword">case</span> Game::LL:</span><br><span class="line">			<span class="built_in">glColor3f</span>(LL_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::OO:</span><br><span class="line">			<span class="built_in">glColor3f</span>(OO_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::DOT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(DOT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::II:</span><br><span class="line">			<span class="built_in">glColor3f</span>(II_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::TT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(TT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">glColor3f</span>(ELSE_COLOR);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (myGame.m_next._data[i][j])</span><br><span class="line">					<span class="built_in">glRectd</span>((myGame.m_next._x + i) * NodeSize, (myGame.m_next._y + j) * NodeSize, (myGame.m_next._x + i + <span class="number">1</span>) * NodeSize, (myGame.m_next._y + j + <span class="number">1</span>) * NodeSize);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//Draw Info</span></span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> points[<span class="number">20</span>] = <span class="string">&quot;Points:&quot;</span>, PBpoints[<span class="number">20</span>] = <span class="string">&quot;PB:&quot;</span>, Diff[<span class="number">20</span>] = <span class="string">&quot;Rank:&quot;</span>,zhywyt[]=<span class="string">&quot;zhywyt:&quot;</span>;</span><br><span class="line">		<span class="type">char</span> points_num[<span class="number">20</span>], PBpoints_num[<span class="number">20</span>], Diff_num[<span class="number">20</span>],zhywyt_num[<span class="number">20</span>];</span><br><span class="line">		<span class="built_in">sprintf</span>(points_num, <span class="string">&quot;%d&quot;</span>, myGame._points);</span><br><span class="line">		<span class="built_in">sprintf</span>(PBpoints_num, <span class="string">&quot;%d&quot;</span>, myGame.PB_points);</span><br><span class="line">		<span class="built_in">sprintf</span>(Diff_num, <span class="string">&quot;%d&quot;</span>, myGame.Diff);</span><br><span class="line">		<span class="built_in">sprintf</span>(zhywyt_num, <span class="string">&quot;%d&quot;</span>, myGame.zhywyt);</span><br><span class="line"></span><br><span class="line">		<span class="type">const</span> <span class="type">char</span>* strinfo[] = &#123; points,PBpoints,Diff,zhywyt &#125;;</span><br><span class="line">		<span class="type">char</span>* str_num[] = &#123; points_num,PBpoints_num,Diff_num ,zhywyt_num&#125;;</span><br><span class="line">		<span class="keyword">if</span> (!myGame.PB)</span><br><span class="line">			<span class="built_in">glColor3f</span>(TEXT_COLOR);</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">			<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i == <span class="number">3</span>)<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>(Game::infoPx * NodeSize, (Game::infoPy + <span class="number">5</span> * i) * NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; strinfo[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, strinfo[i][j]);</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>(Game::infoPx * NodeSize, (Game::infoPy + <span class="number">5</span> * i + <span class="number">2</span>) * NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; str_num[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, str_num[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//Draw Stop Info</span></span><br><span class="line">		<span class="keyword">if</span> (myGame.status == STOP) &#123;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> PrestartInfo[<span class="number">30</span>] = <span class="string">&quot;Press Space to start.&quot;</span>;</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>((Game::dx)*NodeSize, (GameCow + <span class="number">3</span> * Game::dx) / <span class="number">2</span> * NodeSize);</span><br><span class="line">			<span class="built_in">glColor3f</span>(TEXT_COLOR);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; PrestartInfo[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">				<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, PrestartInfo[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">``` 其他的纯文本绘制</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (myGame.status == GAMEOVER) &#123;</span><br><span class="line">		<span class="comment">//Draw gameover info</span></span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> GameOverinfo[<span class="number">30</span>] = <span class="string">&quot;Game Over!&quot;</span>;</span><br><span class="line">		<span class="type">char</span> Score[<span class="number">30</span>], Points[<span class="number">30</span>];</span><br><span class="line">		<span class="built_in">sprintf</span>(Points, <span class="string">&quot;%d&quot;</span>, myGame._points);</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span>* VAO[<span class="number">3</span>] = &#123; GameOverinfo,Score,Points &#125;;</span><br><span class="line">		<span class="keyword">if</span> (!myGame.PB) &#123;</span><br><span class="line">			<span class="built_in">glColor3f</span>(GAMEOVER_TEXT_COLOR);</span><br><span class="line">			<span class="built_in">sprintf</span>(Score, <span class="string">&quot;Your score is &quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">			<span class="built_in">sprintf</span>(Score, <span class="string">&quot;WoW!! PB! &quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>((Game::dx * <span class="number">2</span>) * NodeSize, ((GameCow - <span class="number">4</span> * Game::dx) / <span class="number">2</span>+i*<span class="number">2</span>*Game::dx) * NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; VAO[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)</span><br><span class="line">				<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, VAO[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">char</span> Good[<span class="number">40</span>];</span><br><span class="line">		<span class="keyword">if</span> (myGame.exZhywyt) &#123;</span><br><span class="line">			<span class="built_in">sprintf</span>(Good, <span class="string">&quot;You are great ! You over the zhywyt!!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">sprintf</span>(Good, <span class="string">&quot;Git Gud.&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">glRasterPos2d</span>((Game::dx * <span class="number">2</span>)* NodeSize, ((GameCow<span class="number">-4</span>*Game::dx ) / <span class="number">2</span><span class="number">+6</span>*Game::dx) * NodeSize);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;Good[j] != <span class="string">&#x27;\0&#x27;</span>; j++)</span><br><span class="line">			<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, Good[j]);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == GAMEWIN) &#123;</span><br><span class="line">		<span class="comment">//It is imposible!!!!!</span></span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> Info1[<span class="number">30</span>] = <span class="string">&quot;You may use something else&quot;</span>, Info2[<span class="number">30</span>] = <span class="string">&quot;To do this imposible task.&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span>* str[] = &#123; Info1,Info2 &#125;;</span><br><span class="line">		<span class="built_in">glColor3f</span>(<span class="built_in">RGB</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>((Game::dx * <span class="number">2</span>) * NodeSize, (GameCow + (i * <span class="number">3</span> + <span class="number">1</span>) * Game::dx) / <span class="number">2</span> * NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;str[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)</span><br><span class="line">				<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, str[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> helpInfo1[] = <span class="string">&quot;Your Can Press the Space to stop Game.&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> helpInfo2[] = <span class="string">&quot;And you can click the right butttom to-&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> helpInfo21[] = <span class="string">&quot;-open the emun&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> helpInfo3[] = <span class="string">&quot;You should use the emnu \&quot;exit\&quot; to exit-&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> helpInfo31[] = <span class="string">&quot;-not close the window&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> PrestartInfo[<span class="number">30</span>] = <span class="string">&quot;Press Space to start.&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> LuckInfo[] = <span class="string">&quot;Have Good Time!&quot;</span>;</span><br><span class="line">		<span class="type">const</span> <span class="type">char</span>* str[] = &#123;PrestartInfo,helpInfo31,helpInfo3,helpInfo21,helpInfo2,helpInfo1 &#125;;</span><br><span class="line">		<span class="built_in">glColor3f</span>(TEXT_COLOR);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">5</span>; j &gt;=<span class="number">0</span>; j--) &#123;</span><br><span class="line">		<span class="built_in">glRasterPos2d</span>((Game::dx)*NodeSize, ((GameCow + <span class="number">9</span> * Game::dx) / <span class="number">2</span>-j*<span class="number">2</span> )* NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; str[j][i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">				<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, str[j][i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">		<span class="built_in">glRasterPos2d</span>((Game::dx)*NodeSize, ((GameCow + <span class="number">12</span> * Game::dx)/<span class="number">2</span>* NodeSize));</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; LuckInfo[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">			<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, LuckInfo[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">``` onDisplay</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onDisplay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 设置清屏颜色</span></span><br><span class="line">	<span class="built_in">glClearColor</span>(BCR_COLOR,<span class="number">1</span>);</span><br><span class="line">	<span class="comment">// 用指定颜色清除帧缓存</span></span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Draw Normal Info</span></span><br><span class="line">	<span class="keyword">if</span> (myGame.status!=PRESTART&amp;&amp;myGame.status!=GAMEOVER&amp;&amp;myGame.status!=GAMEWIN) &#123;</span><br><span class="line">		<span class="comment">//Draw BackGroud</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Row; i++) &#123;</span><br><span class="line">			<span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; Cow; j++) &#123;</span><br><span class="line">				<span class="keyword">switch</span> (myGame.m_map[i][j]) &#123;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">					flag = <span class="literal">false</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::LL:</span><br><span class="line">					<span class="built_in">glColor3f</span>(LL_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::OO:</span><br><span class="line">					<span class="built_in">glColor3f</span>(OO_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::DOT:</span><br><span class="line">					<span class="built_in">glColor3f</span>(DOT_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::II:</span><br><span class="line">					<span class="built_in">glColor3f</span>(II_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::TT:</span><br><span class="line">					<span class="built_in">glColor3f</span>(TT_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> Game::WALL:</span><br><span class="line">					<span class="built_in">glColor3f</span>(WALL_COLOR);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">default</span>:</span><br><span class="line">					<span class="built_in">glColor3f</span>(ELSE_COLOR);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (flag)</span><br><span class="line">					<span class="built_in">glRectd</span>(i * NodeSize, j * NodeSize, (i + <span class="number">1</span>) * NodeSize, (j + <span class="number">1</span>) * NodeSize);</span><br><span class="line">				</span><br><span class="line">				flag = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Draw Active Terix</span></span><br><span class="line">		<span class="keyword">switch</span> (myGame.m_tool._type) &#123;</span><br><span class="line">		<span class="keyword">case</span> Game::LL:</span><br><span class="line">			<span class="built_in">glColor3f</span>(LL_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::OO:</span><br><span class="line">			<span class="built_in">glColor3f</span>(OO_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::DOT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(DOT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::II:</span><br><span class="line">			<span class="built_in">glColor3f</span>(II_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::TT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(TT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">glColor3f</span>(ELSE_COLOR);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (myGame.m_tool._data[i][j])</span><br><span class="line">					<span class="built_in">glRectd</span>((myGame.m_tool._x + i) * NodeSize, (myGame.m_tool._y + j) * NodeSize, (myGame.m_tool._x + i + <span class="number">1</span>) * NodeSize, (myGame.m_tool._y + j + <span class="number">1</span>) * NodeSize);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//Draw Waiting Terix</span></span><br><span class="line">		<span class="keyword">switch</span> (myGame.m_next._type) &#123;</span><br><span class="line">		<span class="keyword">case</span> Game::LL:</span><br><span class="line">			<span class="built_in">glColor3f</span>(LL_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::OO:</span><br><span class="line">			<span class="built_in">glColor3f</span>(OO_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::DOT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(DOT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::II:</span><br><span class="line">			<span class="built_in">glColor3f</span>(II_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Game::TT:</span><br><span class="line">			<span class="built_in">glColor3f</span>(TT_COLOR);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">glColor3f</span>(ELSE_COLOR);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (myGame.m_next._data[i][j])</span><br><span class="line">					<span class="built_in">glRectd</span>((myGame.m_next._x + i) * NodeSize, (myGame.m_next._y + j) * NodeSize, (myGame.m_next._x + i + <span class="number">1</span>) * NodeSize, (myGame.m_next._y + j + <span class="number">1</span>) * NodeSize);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//Draw Info</span></span><br><span class="line">		<span class="type">const</span> <span class="type">char</span> points[<span class="number">20</span>] = <span class="string">&quot;Points:&quot;</span>, PBpoints[<span class="number">20</span>] = <span class="string">&quot;PB:&quot;</span>, Diff[<span class="number">20</span>] = <span class="string">&quot;Rank:&quot;</span>,zhywyt[]=<span class="string">&quot;zhywyt:&quot;</span>;</span><br><span class="line">		<span class="type">char</span> points_num[<span class="number">20</span>], PBpoints_num[<span class="number">20</span>], Diff_num[<span class="number">20</span>],zhywyt_num[<span class="number">20</span>];</span><br><span class="line">		<span class="built_in">sprintf</span>(points_num, <span class="string">&quot;%d&quot;</span>, myGame._points);</span><br><span class="line">		<span class="built_in">sprintf</span>(PBpoints_num, <span class="string">&quot;%d&quot;</span>, myGame.PB_points);</span><br><span class="line">		<span class="built_in">sprintf</span>(Diff_num, <span class="string">&quot;%d&quot;</span>, myGame.Diff);</span><br><span class="line">		<span class="built_in">sprintf</span>(zhywyt_num, <span class="string">&quot;%d&quot;</span>, myGame.zhywyt);</span><br><span class="line"></span><br><span class="line">		<span class="type">const</span> <span class="type">char</span>* strinfo[] = &#123; points,PBpoints,Diff,zhywyt &#125;;</span><br><span class="line">		<span class="type">char</span>* str_num[] = &#123; points_num,PBpoints_num,Diff_num ,zhywyt_num&#125;;</span><br><span class="line">		<span class="keyword">if</span> (!myGame.PB)</span><br><span class="line">			<span class="built_in">glColor3f</span>(TEXT_COLOR);</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">			<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i == <span class="number">3</span>)<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>(Game::infoPx * NodeSize, (Game::infoPy + <span class="number">5</span> * i) * NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; strinfo[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, strinfo[i][j]);</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>(Game::infoPx * NodeSize, (Game::infoPy + <span class="number">5</span> * i + <span class="number">2</span>) * NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; str_num[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, str_num[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//Draw Stop Info</span></span><br><span class="line">		<span class="keyword">if</span> (myGame.status == STOP) &#123;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> PrestartInfo[<span class="number">30</span>] = <span class="string">&quot;Press Space to start.&quot;</span>;</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>((Game::dx)*NodeSize, (GameCow + <span class="number">3</span> * Game::dx) / <span class="number">2</span> * NodeSize);</span><br><span class="line">			<span class="built_in">glColor3f</span>(TEXT_COLOR);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; PrestartInfo[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">				<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, PrestartInfo[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Draw Prestart info</span></span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (myGame.status == GAMEOVER) &#123;</span><br><span class="line">			<span class="comment">//Draw gameover info</span></span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> GameOverinfo[<span class="number">30</span>] = <span class="string">&quot;Game Over!&quot;</span>;</span><br><span class="line">			<span class="type">char</span> Score[<span class="number">30</span>], Points[<span class="number">30</span>];</span><br><span class="line">			<span class="built_in">sprintf</span>(Points, <span class="string">&quot;%d&quot;</span>, myGame._points);</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span>* VAO[<span class="number">3</span>] = &#123; GameOverinfo,Score,Points &#125;;</span><br><span class="line">			<span class="keyword">if</span> (!myGame.PB) &#123;</span><br><span class="line">				<span class="built_in">glColor3f</span>(GAMEOVER_TEXT_COLOR);</span><br><span class="line">				<span class="built_in">sprintf</span>(Score, <span class="string">&quot;Your score is &quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">				<span class="built_in">sprintf</span>(Score, <span class="string">&quot;WoW!! PB! &quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">				<span class="built_in">glRasterPos2d</span>((Game::dx * <span class="number">2</span>) * NodeSize, ((GameCow - <span class="number">4</span> * Game::dx) / <span class="number">2</span>+i*<span class="number">2</span>*Game::dx) * NodeSize);</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; VAO[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)</span><br><span class="line">					<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, VAO[i][j]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">char</span> Good[<span class="number">40</span>];</span><br><span class="line">			<span class="keyword">if</span> (myGame.exZhywyt) &#123;</span><br><span class="line">				<span class="built_in">sprintf</span>(Good, <span class="string">&quot;You are great ! You over the zhywyt!!&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">sprintf</span>(Good, <span class="string">&quot;Git Gud.&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>((Game::dx * <span class="number">2</span>)* NodeSize, ((GameCow<span class="number">-4</span>*Game::dx ) / <span class="number">2</span><span class="number">+6</span>*Game::dx) * NodeSize);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;Good[j] != <span class="string">&#x27;\0&#x27;</span>; j++)</span><br><span class="line">				<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, Good[j]);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == GAMEWIN) &#123;</span><br><span class="line">			<span class="comment">//It is imposible!!!!!</span></span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> Info1[<span class="number">30</span>] = <span class="string">&quot;You may use something else&quot;</span>, Info2[<span class="number">30</span>] = <span class="string">&quot;To do this imposible task.&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span>* str[] = &#123; Info1,Info2 &#125;;</span><br><span class="line">			<span class="built_in">glColor3f</span>(<span class="built_in">RGB</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">				<span class="built_in">glRasterPos2d</span>((Game::dx * <span class="number">2</span>) * NodeSize, (GameCow + (i * <span class="number">3</span> + <span class="number">1</span>) * Game::dx) / <span class="number">2</span> * NodeSize);</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;str[i][j] != <span class="string">&#x27;\0&#x27;</span>; j++)</span><br><span class="line">					<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, str[i][j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> helpInfo1[] = <span class="string">&quot;Your Can Press the Space to stop Game.&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> helpInfo2[] = <span class="string">&quot;And you can click the right butttom to-&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> helpInfo21[] = <span class="string">&quot;-open the emun&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> helpInfo3[] = <span class="string">&quot;You should use the emnu \&quot;exit\&quot; to exit-&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> helpInfo31[] = <span class="string">&quot;-not close the window&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> PrestartInfo[<span class="number">30</span>] = <span class="string">&quot;Press Space to start.&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> LuckInfo[] = <span class="string">&quot;Have Good Time!&quot;</span>;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span>* str[] = &#123;PrestartInfo,helpInfo31,helpInfo3,helpInfo21,helpInfo2,helpInfo1 &#125;;</span><br><span class="line">			<span class="built_in">glColor3f</span>(TEXT_COLOR);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">5</span>; j &gt;=<span class="number">0</span>; j--) &#123;</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>((Game::dx)*NodeSize, ((GameCow + <span class="number">9</span> * Game::dx) / <span class="number">2</span>-j*<span class="number">2</span> )* NodeSize);</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; str[j][i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">					<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, str[j][i]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">glColor3f</span>(PB_TEXT_COLOR);</span><br><span class="line">			<span class="built_in">glRasterPos2d</span>((Game::dx)*NodeSize, ((GameCow + <span class="number">12</span> * Game::dx)/<span class="number">2</span>* NodeSize));</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; LuckInfo[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">				<span class="built_in">glutBitmapCharacter</span>(INFO_FONT, LuckInfo[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Clear Buffer</span></span><br><span class="line">	<span class="built_in">glutSwapBuffers</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>如果仔细的读过代码的人会发现，代码里面出现了很多的宏定义，那是为了编程的方便，我们会设置一个Reasource.h文件，来统一管理我们的资源。完整的Reasource.h代码在这里贴出：</strong></p>
<p>Reasource.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> REASOURCE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REASOURCE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLUT_KEY_ESCAPE 27</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RGB(a,b,c) (a/255.0),(b/255.0),(c/255.0)	<span class="comment">//用于255转0.0-1.0</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BCR_COLOR RGB(0,0,0)						<span class="comment">//背景颜色</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//所有俄罗斯方块的颜色</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL_COLOR RGB(0,255,0)									</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OO_COLOR RGB(255,0,0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DOT_COLOR RGB(255,255,255)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> II_COLOR RGB(0,255,255)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TT_COLOR RGB(164, 225, 202)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELSE_COLOR RGB(0,0,0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WALL_COLOR RGB(100,255,0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//状态颜色</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TEXT_COLOR RGB(255,255,255)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GAMEOVER_TEXT_COLOR RGB(255,0,0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PB_TEXT_COLOR RGB(0,255,0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//字体设置</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INFO_FONT GLUT_BITMAP_TIMES_ROMAN_24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h3 id="4-输入回调函数"><a href="#4-输入回调函数" class="headerlink" title="4.输入回调函数"></a>4.输入回调函数</h3><p><strong>终于到了激动人心的输入回调函数了，这里将是用户和窗口进行交互的地方，会处理用户所有的键盘敲击。用户的输入的作用是会随着游戏的状态的改变而改变的。在俄罗斯方块中，用户的输入大概有这些</strong>  </p>
<p>1.WASD<br>2.UP DOWN LEFT RIGHT  </p>
<p><strong>其实我们知道他们是对应相等的。这里我还添加了第三个输入:</strong>  </p>
<p>3.SPACE  </p>
<p><strong>这个SPACE可以干很多事情，比如在游戏运行的时候可以暂停游戏，在游戏暂停的时候可以恢复游戏，在游戏结束的时候可以重置游戏，在游戏准备阶段可以开始游戏。我个人觉得是非常好的一个设计。好了，知道了输入的信息种类，我们来介绍一下glut的消息处理机制。glut中有两种消息的大类型：普通消息和特殊消息</strong></p>
<h4 id="普通消息处理"><a href="#普通消息处理" class="headerlink" title="普通消息处理"></a>普通消息处理</h4><p><strong>普通消息的回调函数的绑定是这样的：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glutKeyboardFunc</span>(Input);</span><br></pre></td></tr></table></figure>

<p><strong>其中Input函数的声明式这样的：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Input</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> nchar, <span class="type">int</span> x, <span class="type">int</span> y)</span></span>; </span><br></pre></td></tr></table></figure>

<p><strong>从参数列表中可以看到nchar就是消息的信息，它的类型是unsigned char也就是说它所能承载的消息数量是不多的，包括了大部分的键盘输入但是没有功能键和方向键。所以我们还需要一个特殊消息处理回调函数。</strong></p>
<h4 id="特殊消息处理"><a href="#特殊消息处理" class="headerlink" title="特殊消息处理"></a>特殊消息处理</h4><p><strong>与普通消息处理不同的是，特殊消息处理中的nchar参数的类型是int 这允许了它可以包含几乎所有的消息。它的绑定回调函数是这样的：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glutSpecialFunc</span>(Input);</span><br></pre></td></tr></table></figure>

<p><strong>回调函数是这样的：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Input</span><span class="params">( <span class="type">int</span> nchar, <span class="type">int</span> x, <span class="type">int</span> y)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="输入信息"><a href="#输入信息" class="headerlink" title="输入信息"></a>输入信息</h4><p><strong>我们来分析这个过程，从游戏开始到结束，分别可以接受的输入有哪些。</strong></p>
<h5 id="1-游戏开始前"><a href="#1-游戏开始前" class="headerlink" title="1.游戏开始前"></a>1.游戏开始前</h5><p><strong>只能接受一个SPACE信息，然后进入RUN状态。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理游戏开始前的输入</span></span><br><span class="line"><span class="keyword">if</span> (myGame.status == PRESTART) &#123;</span><br><span class="line">	<span class="keyword">if</span> (nchar == GLFW_KEY_SPACE) &#123;</span><br><span class="line">	myGame.<span class="built_in">Start</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-游戏进行中"><a href="#2-游戏进行中" class="headerlink" title="2.游戏进行中"></a>2.游戏进行中</h5><p><strong>可以接受移动的信息，以及空格信息进行暂停操作。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理游戏时的输入</span></span><br><span class="line"><span class="keyword">if</span> (myGame.status == RUN) &#123;	</span><br><span class="line">	<span class="keyword">if</span> (nchar == GLUT_KEY_UP || nchar == GLFW_KEY_W) &#123;</span><br><span class="line">		myGame.<span class="built_in">Rotate</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_S || nchar == GLUT_KEY_DOWN) &#123;</span><br><span class="line">		myGame.<span class="built_in">Drop</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_A || nchar == GLUT_KEY_LEFT) &#123;</span><br><span class="line">		<span class="keyword">if</span> (myGame.<span class="built_in">CangetMoveLeft</span>())</span><br><span class="line">			myGame.m_tool.<span class="built_in">MoveLeft</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_D || nchar == GLUT_KEY_RIGHT) &#123;</span><br><span class="line">		<span class="keyword">if</span> (myGame.<span class="built_in">CangetMoveRight</span>())</span><br><span class="line">			myGame.m_tool.<span class="built_in">MoveRight</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_SPACE) &#123;</span><br><span class="line">		<span class="keyword">if</span> (myGame.status == GAMEOVER) &#123;</span><br><span class="line">			myGame.status = PRESTART;</span><br><span class="line">			myGame.<span class="built_in">reset</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == RUN) &#123;</span><br><span class="line">			myGame.status = STOP;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-游戏暂停"><a href="#3-游戏暂停" class="headerlink" title="3.游戏暂停"></a>3.游戏暂停</h5><p><strong>很简单，接受一个信息SPACE，转换游戏状态为RUN就行。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理暂停时的输入</span></span><br><span class="line"><span class="keyword">if</span> (myGame.status == STOP ) &#123;</span><br><span class="line">	<span class="keyword">if</span> (nchar == GLFW_KEY_SPACE) &#123;</span><br><span class="line">		myGame.status = RUN;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-游戏结束"><a href="#4-游戏结束" class="headerlink" title="4.游戏结束"></a>4.游戏结束</h5><p><strong>接受一个SPACE信号，把游戏状态转换为PRESTART。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理结束的操作</span></span><br><span class="line"><span class="comment">//处理结束的操作</span></span><br><span class="line"><span class="keyword">if</span> (myGame.status == GAMEOVER) &#123;</span><br><span class="line">		<span class="keyword">if</span>(nchar==GLFW_KEY_SPACE)</span><br><span class="line">		myGame.<span class="built_in">reset</span>();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-游戏胜利"><a href="#5-游戏胜利" class="headerlink" title="5.游戏胜利"></a>5.游戏胜利</h5><p><strong>这个比较模糊，大家自由发挥。）</strong></p>
<h5 id="6-特殊的特殊"><a href="#6-特殊的特殊" class="headerlink" title="6.特殊的特殊"></a>6.特殊的特殊</h5><p><strong>在任何状态下，我们都可以使用esc退出游戏，我们把这个输入设置在普通消息中，为了让消息处理看上去更加啊的完整，我们在普通消息处理中调用特殊消息处理函数，使用特殊消息处理函数来处理除esc以外的所有消息。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Input</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> nchar, <span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (nchar == GLUT_KEY_ESCAPE) &#123;</span><br><span class="line">		<span class="comment">//退出前保存数据</span></span><br><span class="line">		myGame.<span class="built_in">GameOver</span>();</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//全部转化为大写进行处理</span></span><br><span class="line">	<span class="keyword">if</span> (nchar &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; nchar &lt;= <span class="string">&#x27;z&#x27;</span>)nchar += <span class="string">&#x27;A&#x27;</span> - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">	<span class="built_in">Input</span>((<span class="type">int</span>)nchar, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>普通消息处理函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简单键盘输入</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Input</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> nchar, <span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (nchar == GLUT_KEY_ESCAPE) &#123;</span><br><span class="line">		<span class="comment">//推出前保存数据</span></span><br><span class="line">		myGame.<span class="built_in">GameOver</span>();</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (nchar &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; nchar &lt;= <span class="string">&#x27;z&#x27;</span>)nchar += <span class="string">&#x27;A&#x27;</span> - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">		<span class="built_in">Input</span>((<span class="type">int</span>)nchar, x, y);</span><br><span class="line">&#125;</span><br><span class="line">``` 特殊的消息处理函数</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Input</span><span class="params">( <span class="type">int</span> nchar, <span class="type">int</span> x, <span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="comment">//处理游戏时的输入</span></span><br><span class="line">	<span class="keyword">if</span> (myGame.status == RUN) &#123;	</span><br><span class="line">		<span class="keyword">if</span> (nchar == GLUT_KEY_UP || nchar == GLFW_KEY_W) &#123;</span><br><span class="line">			myGame.<span class="built_in">Rotate</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_S || nchar == GLUT_KEY_DOWN) &#123;</span><br><span class="line">			myGame.<span class="built_in">Drop</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_A || nchar == GLUT_KEY_LEFT) &#123;</span><br><span class="line">			<span class="keyword">if</span> (myGame.<span class="built_in">CangetMoveLeft</span>())</span><br><span class="line">				myGame.m_tool.<span class="built_in">MoveLeft</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_D || nchar == GLUT_KEY_RIGHT) &#123;</span><br><span class="line">			<span class="keyword">if</span> (myGame.<span class="built_in">CangetMoveRight</span>())</span><br><span class="line">				myGame.m_tool.<span class="built_in">MoveRight</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (nchar == GLFW_KEY_SPACE) &#123;</span><br><span class="line">			<span class="keyword">if</span> (myGame.status == GAMEOVER) &#123;</span><br><span class="line">				myGame.status = PRESTART;</span><br><span class="line">				myGame.<span class="built_in">reset</span>();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == RUN) &#123;</span><br><span class="line">				myGame.status = STOP;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">//处理暂停时的输入</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == STOP ) &#123;</span><br><span class="line">		<span class="keyword">if</span> (nchar == GLFW_KEY_SPACE) &#123;</span><br><span class="line">			myGame.status = RUN;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//处理游戏开始前的输入</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == PRESTART) &#123;</span><br><span class="line">		<span class="keyword">if</span> (nchar == GLFW_KEY_SPACE) &#123;</span><br><span class="line">			myGame.<span class="built_in">Start</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//处理结束的操作</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == GAMEOVER) &#123;</span><br><span class="line">		<span class="keyword">if</span>(nchar==GLFW_KEY_SPACE)</span><br><span class="line">		myGame.<span class="built_in">reset</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (myGame.status == GAMEWIN) &#123;</span><br><span class="line">		<span class="keyword">if</span> (nchar)<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这样，我们的消息处理就完整啦！！（快要做完了！！好激动）</strong></p>
<h2 id="菜单（非必要）"><a href="#菜单（非必要）" class="headerlink" title="菜单（非必要）"></a>菜单（非必要）</h2><h3 id="创建菜单"><a href="#创建菜单" class="headerlink" title="创建菜单"></a>创建菜单</h3><p><strong>做完上面的内容之后，我觉得我的小游戏还是少了些什么东西，它好像不能存档，它好像没有菜单，它好像很垃圾？？然后我就给它加上了几行代码，使得这个小游戏 更加的有意思了。我们可以在菜单对游戏进行重置，我们可以在提供的三个存档位中进行选择，我们可以在正常退出时保存数据，下次打开自动保存存档又能回到之前的进度！</strong></p>
<h3 id="关于glut的Menu"><a href="#关于glut的Menu" class="headerlink" title="关于glut的Menu"></a>关于glut的Menu</h3><p><strong>首先我们需要做的是创建一个菜单，glut提供的注册函数是glutCreateMenu()</strong></p>
<hr>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span> APIENTRY <span class="title">glutCreateMenu</span><span class="params">(<span class="type">void</span> (*)(<span class="type">int</span>))</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>它会返回所创建的菜单的ID，类型是int。</strong><br><strong>然后是创建这个ID下的菜单列表，使用函数:glutAddMenuEntry()</strong></p>
<hr>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">void</span> APIENTRY <span class="title">glutAddMenuEntry</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *label, <span class="type">int</span> value)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>需要一个执行操作的函数，和一个对应执行的“值”，这个值我们一般使用枚举来提高代码可读性。</strong>  </p>
<p><a href="#back">点击返回问题目录</a><br><strong>然后我们可以使用一个菜单的ID去创建一个父菜单，像这样：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230409192044851-238051188_1726324605716.png" alt="image"><br><strong>使用函数glutAddSubMenu()</strong></p>
<hr>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">void</span> APIENTRY <span class="title">glutAddSubMenu</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *label, <span class="type">int</span> submenu)</span></span>;</span><br></pre></td></tr></table></figure>

<p><a href="#back">点击返回问题目录</a><br><strong>最后，我们需要绑定菜单触发的输入，比如GLUT_RIGHT_BUTTON，就是鼠标右键。</strong></p>
<h3 id="响应菜单"><a href="#响应菜单" class="headerlink" title="响应菜单"></a>响应菜单</h3><p><strong>在创建菜单的时候，会将子菜单绑定到一个函数上，这个函数需要接受一个value值，然后处理对应的操作。这里先给出createGLUTMenus函数的定义：</strong></p>
<p>createGLUTMenus</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createGLUTMenus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//菜单ID</span></span><br><span class="line">	<span class="type">int</span> menu,submenu, Savemenu, Loadmenu;</span><br><span class="line">	<span class="comment">//设置回调函数processMenuEvents()，获取与之对于的菜单ID</span></span><br><span class="line">	submenu = <span class="built_in">glutCreateMenu</span>(processMenuEvents);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Start&quot;</span>, RUN);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Reset&quot;</span>, PRESTART);</span><br><span class="line">	<span class="comment">//以后再做</span></span><br><span class="line">	<span class="comment">//glutAddMenuEntry(&quot;Check My Best&quot;, CHECKBEST);</span></span><br><span class="line">	Savemenu = <span class="built_in">glutCreateMenu</span>(processMenuEvents);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Save1&quot;</span>, SAVE1);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Save2&quot;</span>, SAVE2);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Save3&quot;</span>, SAVE3);</span><br><span class="line">	Loadmenu = <span class="built_in">glutCreateMenu</span>(processMenuEvents);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Load1&quot;</span>, LOAD1);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Load2&quot;</span>, LOAD2);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Load3&quot;</span>, LOAD3);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;LoadAutoSave&quot;</span>, LOADAUTOSAVE);</span><br><span class="line">	menu = <span class="built_in">glutCreateMenu</span>(processMenuEvents);</span><br><span class="line">	<span class="comment">//设置父菜单</span></span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Stop&quot;</span>, STOP);</span><br><span class="line">	<span class="built_in">glutAddSubMenu</span>(<span class="string">&quot;Option&quot;</span>, submenu);</span><br><span class="line">	<span class="built_in">glutAddSubMenu</span>(<span class="string">&quot;Save&quot;</span>, Savemenu);</span><br><span class="line">	<span class="built_in">glutAddSubMenu</span>(<span class="string">&quot;LoadSave&quot;</span>, Loadmenu);</span><br><span class="line">	<span class="built_in">glutAddMenuEntry</span>(<span class="string">&quot;Exit&quot;</span>, GAMEOVER);</span><br><span class="line">	<span class="comment">//绑定鼠标点击</span></span><br><span class="line">	<span class="built_in">glutAttachMenu</span>(GLUT_RIGHT_BUTTON);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>然后我们定义在createGLUTMenus中使用过的函数指针processMenuEvents。在这个函数中，我们对应各个枚举进行实现。</strong></p>
<p>processMenuEvents</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">processMenuEvents</span><span class="params">(<span class="type">int</span> option)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">switch</span> (option) &#123;</span><br><span class="line">	<span class="keyword">case</span> RUN:</span><br><span class="line">		<span class="keyword">if</span> (myGame.status == PRESTART)myGame.<span class="built_in">Start</span>();</span><br><span class="line">		myGame.status = RUN;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> GAMEOVER:</span><br><span class="line">		myGame.<span class="built_in">GameOver</span>();</span><br><span class="line">		myGame.<span class="built_in">Save</span>(<span class="string">&quot;AutoSave.zhywyt&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> PRESTART:</span><br><span class="line">		myGame.status = PRESTART;</span><br><span class="line">		myGame.<span class="built_in">GameOver</span>();</span><br><span class="line">		myGame.<span class="built_in">reset</span>();</span><br><span class="line">		<span class="comment">//添加重置的操作</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> STOP:</span><br><span class="line">		<span class="keyword">if</span>(myGame.status!=PRESTART)</span><br><span class="line">		myGame.status = STOP;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (option &gt;= SAVE1 &amp;&amp; option &lt;= SAVE3) &#123;</span><br><span class="line">		<span class="keyword">if</span> (myGame.<span class="built_in">getStatus</span>() != PRESTART) &#123;</span><br><span class="line">			<span class="type">int</span> index = option - SAVE1 + <span class="number">1</span>;</span><br><span class="line">			<span class="type">char</span> FileName[<span class="number">30</span>];</span><br><span class="line">			<span class="built_in">sprintf</span>(FileName, <span class="string">&quot;Save%d.zhywyt&quot;</span>, index);</span><br><span class="line">			<span class="function">string <span class="title">name</span><span class="params">(FileName)</span></span>;</span><br><span class="line">			<span class="keyword">if</span> (myGame.<span class="built_in">Save</span>(name))</span><br><span class="line">				myGame.<span class="built_in">ChangeStatus</span>(STOP);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (option &gt;= LOAD1 &amp;&amp; option &lt;= LOAD3) &#123;</span><br><span class="line">		<span class="type">int</span> index = option - LOAD1 + <span class="number">1</span>;</span><br><span class="line">		<span class="type">char</span> FileName[<span class="number">30</span>];</span><br><span class="line">		<span class="built_in">sprintf</span>(FileName, <span class="string">&quot;Save%d.zhywyt&quot;</span>, index);</span><br><span class="line">		<span class="function">string <span class="title">name</span><span class="params">(FileName)</span></span>;</span><br><span class="line">		<span class="keyword">if</span>(myGame.<span class="built_in">Load</span>(name))</span><br><span class="line">			myGame.<span class="built_in">ChangeStatus</span>(STOP);</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			myGame.<span class="built_in">reset</span>();</span><br><span class="line">			myGame.<span class="built_in">ChangeStatus</span>(PRESTART);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (option == LOADAUTOSAVE) &#123;</span><br><span class="line">		<span class="keyword">if</span>(myGame.<span class="built_in">Load</span>(<span class="string">&quot;AutoSave.zhywyt&quot;</span>))</span><br><span class="line">			myGame.<span class="built_in">ChangeStatus</span>(STOP);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="存档（非必要）"><a href="#存档（非必要）" class="headerlink" title="存档（非必要）"></a>存档（非必要）</h2><p><strong>前面的菜单里面，有着需要Game类内部实现的存档系统，那么我们来稍微修改一下Game类，为它添加存档的功能。</strong></p>
<h3 id="Save函数和Load函数"><a href="#Save函数和Load函数" class="headerlink" title="Save函数和Load函数"></a>Save函数和Load函数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Save</span><span class="params">(string FileName)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Load</span><span class="params">(string FileName)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>实现：</strong></p>
<p>Save</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Game::Save</span><span class="params">(string FileName)</span> </span>&#123;</span><br><span class="line">	<span class="function">ofstream <span class="title">ofs</span><span class="params">(FileName, fstream::out)</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (ofs) &#123;</span><br><span class="line">		<span class="comment">//按照数据顺序来</span></span><br><span class="line">		ofs &lt;&lt; status &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; clearTimes &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">			&lt;&lt; zhywyt &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; _points &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">			&lt;&lt; PB_points &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; Diff &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">			&lt;&lt; PB_Diff &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; PB &lt;&lt; endl;</span><br><span class="line">		ofs &lt;&lt; m_tool._type &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; m_next._type &lt;&lt; endl;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Row; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; Cow; j++)</span><br><span class="line">				ofs &lt;&lt; m_map[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">			ofs &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">``` Load</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Game::Load</span><span class="params">(string FileName)</span> </span>&#123;</span><br><span class="line">	<span class="function">ifstream <span class="title">ifs</span><span class="params">(FileName, fstream::in)</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (ifs) &#123;</span><br><span class="line">		<span class="type">int</span> Status, m_tool_Type, m_next_Type;</span><br><span class="line">		ifs &gt;&gt; Status &gt;&gt; clearTimes</span><br><span class="line">			&gt;&gt; zhywyt &gt;&gt; _points</span><br><span class="line">			&gt;&gt; PB_points &gt;&gt; Diff</span><br><span class="line">			&gt;&gt; PB_Diff &gt;&gt; PB</span><br><span class="line">			&gt;&gt; m_tool_Type &gt;&gt; m_next_Type;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Row; i++)</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; Cow; j++)</span><br><span class="line">				ifs &gt;&gt; m_map[i][j];</span><br><span class="line">		status = <span class="built_in">GameMode</span>(Status);</span><br><span class="line">		m_tool = <span class="built_in">Tool</span>(rePx,rePy,<span class="built_in">ToolType</span>(m_tool_Type));</span><br><span class="line">		m_next = <span class="built_in">Tool</span>(waitPx, waitPy, <span class="built_in">ToolType</span>(m_next_Type));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动存档"><a href="#自动存档" class="headerlink" title="自动存档"></a>自动存档</h3><p><strong>在用户是哟esc进行退出时，和使用exit进行退出时，我们先保存一次游戏的数据，再退出，这样可以让用户在下次进入游戏的时候找回之前忘记保存的存档。我们更新之前的普通消息处理函数：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Input</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> nchar, <span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (nchar == GLUT_KEY_ESCAPE) &#123;</span><br><span class="line">		<span class="comment">//退出前保存数据</span></span><br><span class="line">		myGame.<span class="built_in">GameOver</span>();</span><br><span class="line">		<span class="comment">//真正的保存数据</span></span><br><span class="line">		myGame.<span class="built_in">Save</span>(<span class="string">&quot;AutoSave.zhywyt&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//全部转化为大写信息处理</span></span><br><span class="line">	<span class="keyword">if</span> (nchar &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; nchar &lt;= <span class="string">&#x27;z&#x27;</span>)nchar += <span class="string">&#x27;A&#x27;</span> - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">		<span class="built_in">Input</span>((<span class="type">int</span>)nchar, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>最后，要注意存档不存在的时候，这里我就没有进行额外的处理了，只是在没有存档的时候不做任何事情。</strong></p>
<blockquote>
</blockquote>
<p>更新于2023.4.15</p>
<h2 id="音乐"><a href="#音乐" class="headerlink" title="音乐"></a>音乐</h2><p><strong>一个游戏不能没有音乐，或者说一个完整的游戏不能没有音乐，所以我还是给我的俄罗斯方块小游戏加上了音乐。</strong></p>
<h3 id="irrklang"><a href="#irrklang" class="headerlink" title="irrklang"></a>irrklang</h3><p><strong>因为OpenGL是没有提供音频的接口的，所以我需要使用外部库来实现音乐部分。这里使用的是irrklang音频库，它可以非常方便的使用多种文件的音频。可以在这里找到它的下载链接</strong>  </p>
<p><a target="_blank" rel="noopener" href="https://www.ambiera.com/irrklang/downloads.html">irrKlang</a><strong>我使用了32位进行实现。下载好后按照之前配置glut的方式配置irrklang</strong><a href="#glut">glut的配置</a></p>
<h3 id="irrklang使用"><a href="#irrklang使用" class="headerlink" title="irrklang使用"></a>irrklang使用</h3><p><strong>irrklang可以实现3D音效，但是我们这里不需要用到这个高级的方法。我们只使用它的2D效果。主要介绍它的两个类：</strong></p>
<h4 id="ISoundEngine类"><a href="#ISoundEngine类" class="headerlink" title="ISoundEngine类"></a>ISoundEngine类</h4><p><strong>ISoundEngine类允许我们创建一个可以播放音乐的对象，这个对象由函数<code>createIrrKlangDevice</code>得到。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISoundEngine* SoundEngine = <span class="built_in">createIrrKlangDevice</span>();</span><br></pre></td></tr></table></figure>

<p><strong>ISoundEngine类拥有很多的成员函数，我们需要使用的只有两个，分别是：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SoundEngine-&gt;<span class="built_in">play2D</span>();</span><br><span class="line">SoundEngine-&gt;<span class="built_in">drop</span>();</span><br><span class="line"><span class="comment">//函数原型</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> ISound* <span class="title">play2D</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* soundFileName, </span></span></span><br><span class="line"><span class="params"><span class="function">	   <span class="type">bool</span> playLooped = <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	   <span class="type">bool</span> startPaused = <span class="literal">false</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">	   <span class="type">bool</span> track = <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	   E_STREAM_MODE streamMode = ESM_AUTO_DETECT,</span></span></span><br><span class="line"><span class="params"><span class="function">	   <span class="type">bool</span> enableSoundEffects = <span class="literal">false</span>)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>drop函数很单纯，就是释放这个ISoundEngine对象的内存，销毁该对象。在程序退出前记得调用这个函数；而play2D这个函数使用了大量的默认形参，所以我们甚至可以简洁的写成：<code>SoundEngine-&gt;play2D(&quot;Filename&quot;)</code>这样简单的代码直接播放一首歌曲。它第二个参数的意义是是否进行循环播放，第三个参数的意义是第一次触发是否暂停播放，等待第二次触发再播放，第四个参数是是否返回ISound指针。后面的参数我们用不到了。我们可以得到两种使用方式，分别对应我们的背景音乐和音效。</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BackGroundMusic背景音乐</span></span><br><span class="line"><span class="comment">//需要持续播放且进行&quot;track&quot;的的音乐</span></span><br><span class="line">ISound*BackGroundSound SoundEngine-&gt;<span class="built_in">play2D</span>(<span class="string">&quot;filename&quot;</span>,GL_TRUE,GL_FALSE,GL_TRUE);</span><br><span class="line"><span class="comment">//音效</span></span><br><span class="line"><span class="comment">//只需要当前位置播放一次的音乐</span></span><br><span class="line">SoundEngine-&gt;<span class="built_in">play2D</span>(<span class="string">&quot;filename&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>然后我们来讲一下ISound类，它可以对一段音乐的播放进行更加细致的操纵。</strong></p>
<h4 id="ISound类"><a href="#ISound类" class="headerlink" title="ISound类"></a>ISound类</h4><p><strong>ISound类对象的指针由play2D开启第四个参数时返回，得到的ISound对象可以对这首音乐进行操纵，比如暂停、调节音量、释放空间等等。这里我们只需要用到暂停和释放空间就行了。我们用到它的两个成员函数</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启音乐播放</span></span><br><span class="line"><span class="comment">//TRUE暂停</span></span><br><span class="line">BackGroundMusic-&gt;<span class="built_in">setIsPaused</span>(GL_FLASE);</span><br><span class="line"><span class="comment">//销毁音乐，之后置空</span></span><br><span class="line">BackGroundMusic-&gt;<span class="built_in">drop</span>();</span><br><span class="line"><span class="comment">//设置音量（0.0 - 1.0）</span></span><br><span class="line">RunSound-&gt;<span class="built_in">setVolume</span>(value);</span><br></pre></td></tr></table></figure>

<p>2023.4.15更新至此</p>
<p><a href="#back">点击返回问题目录</a></p>
<h2 id="一个游戏的开发过程主要有哪些呢？"><a href="#一个游戏的开发过程主要有哪些呢？" class="headerlink" title="一个游戏的开发过程主要有哪些呢？"></a>一个游戏的开发过程主要有哪些呢？</h2><p><strong>以下全部都是个人见解，肯定是非常不全面的，但是既然是自己第一个完整的游戏，那么也把整个开发过程的想法说一说。</strong></p>
<h3 id="1-分析游戏对象"><a href="#1-分析游戏对象" class="headerlink" title="1.分析游戏对象"></a>1.分析游戏对象</h3><p><strong>想要做一个游戏，首先我们得知道这个游戏会有哪些对象，先从对象入手。把对象作为我们游戏的最小单元，比如游戏中的NPC，我们可能先剥离所有NPC的共性，然后写出一个基类people类，再people这个类的基础上进行继承，形成新的类，逐渐完善所有的对象类。我觉得这个步骤至关重要，也能理解为什么策划在团体中的重要性了。</strong></p>
<h3 id="2-分析游戏过程"><a href="#2-分析游戏过程" class="headerlink" title="2.分析游戏过程"></a>2.分析游戏过程</h3><p><strong>在我自己的想法中，我还是不能把Game类和过程剥离开，整个Game类的设计还是在进行一种面向过程的编程方式，但是我觉得面向对象的意义其实就是更好的面向过程，我无法想象如何真正意义上的面向对象？我的绘图，我的消息处理，甚至我的Timer计时器，从里到外都透露着面向过程的思想。但是就这一个俄罗斯方块来说，我觉得我的处理还是很正确的，以友元作为回调函数，设置唯一的Game类。但是转念一想，那我的Game类有什么意义呢？认真的思考过后，我认为：这个游戏中对对象的封装止步于Game类的数据维护，剩下的所有事情都是在面向过程。</strong></p>
<h3 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3.代码实现"></a>3.代码实现</h3><p><strong>涉及到的知识就很多了，包括C++的编程基础和图形API&#x2F;库的接口使用。</strong></p>
<h1 id="感谢您的阅读，谢谢！"><a href="#感谢您的阅读，谢谢！" class="headerlink" title="感谢您的阅读，谢谢！"></a>感谢您的阅读，谢谢！</h1><p><strong>有什么问题请大家狠狠的指出，大家的意见都是小白在学习中的一次进步！代码多有不规范的地方还请大家包涵。</strong></p>
<h1 id="代码汇总"><a href="#代码汇总" class="headerlink" title="代码汇总"></a>代码汇总</h1><p><a target="_blank" rel="noopener" href="https://github.com/zhywyt/Terix-With-Glut" title="zhywyt&#39;s gitHub">zhywyt</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/games系列课程/games101/Games101笔记 P11~" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/10536/" class="article-date">
      <time datetime="2023-04-04T23:42:00.000Z" itemprop="datePublished">2023-04-04</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/10536/">Games101笔记 P11~?</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h2 id="贝塞尔曲线（Bezier-Curve-General-Algebraic-Formula）"><a href="#贝塞尔曲线（Bezier-Curve-General-Algebraic-Formula）" class="headerlink" title="贝塞尔曲线（Bezier Curve-General Algebraic Formula）"></a>贝塞尔曲线（Bezier Curve-General Algebraic Formula）</h2><p><strong>三个点的贝塞尔曲线迭代公式：</strong></p>
<p>\[b^1_0(t)&#x3D;(1-t)b_0+tb_1 \]</p>
<p>\[b_1^1(t)&#x3D;(1-t)b_1+tb_2 \]</p>
<p>\[b_0^2(t)&#x3D;(1-t)b_0^1+tb_!^1 \]</p>
<p><strong>展开得到</strong></p>
<p>\[b^2_0(t)&#x3D;(1-t)^2b_0+(1-t)tb_1+t^2b_2 \]</p>
<p><strong>n个控制点的贝塞尔曲线，每一个时刻曲线上的点的坐标，可以通过二项式展开得到。</strong></p>
<p>\[b^n(t)&#x3D;b_0^n(t)&#x3D;\sum^n_{j&#x3D;0}b_j B^n_j(t) \]</p>
<p><strong>其中\(B^n_j(t)\)就是伯恩斯坦多项式，也就是二项式展开的系数，写作：</strong></p>
<p>\[B_i^n(t)&#x3D;(n,i)^Tt^i(1-t)^{n-1}&#x3D;{C_n^i}t^i(1-t)^{n-i} \]</p>
<p><strong>用语言表述就是，用伯恩斯坦系数给各个控制点加权得到贝塞尔曲线的解。</strong></p>
<p><strong>优美的性质-&gt;1.线性不变：贝塞尔曲线只需要记录控制点的位置，在线性变换下，对控制点进行变换之后重新生成的曲线与直接对曲线进行变换得到的曲线相同。</strong><br><strong>2.凸包性：贝塞尔曲线一定在控制点形成的凸包内。</strong></p>
<h3 id="逐段的贝塞尔曲线"><a href="#逐段的贝塞尔曲线" class="headerlink" title="逐段的贝塞尔曲线"></a>逐段的贝塞尔曲线</h3><p><strong>因为在控制点很多的时候，每一个控制点对曲线的影响很小了，人们更趋向于使用较少的控制点和较多的贝塞尔曲线，来刻画曲线，一般使用四个控制点来处理一段曲线，然后把各段曲线连起来，可以得到不错的效果。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404092403841-28911758_1726324614867.png" alt="image"><br><strong>当一条贝塞尔的曲线的终点和另一条贝塞尔曲线的起点重合时即\(a_n&#x3D;b_0\)，我们叫它\(C_0\)连续。也就是函数连续。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404093138491-201717717_1726324614867.png" alt="image"><br><strong>在\(C_0\)连续的情况下，当一条贝塞尔曲线的终止向量的和另一个贝塞尔曲线的起始向量反向相等时，我们称之为\(C_1\)连续。理解起来就是这条曲线在这点导数连续。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404093530146-333650404_1726324614867.png" alt="image"></p>
<h2 id="Bezier-Surfaces（贝塞尔曲面）"><a href="#Bezier-Surfaces（贝塞尔曲面）" class="headerlink" title="Bezier Surfaces（贝塞尔曲面）"></a>Bezier Surfaces（贝塞尔曲面）</h2><p><strong>用四条贝塞尔曲线的点当作四个控制点，再生成一条贝塞尔曲线，然后遍历之前的贝塞尔曲线，就可以得到贝塞尔曲面。</strong><br><strong>如图，四个贝塞尔曲线上的点形成了新的控制点，然后绘制新的贝塞尔曲线。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404120348910-1769722002_1726324614867.png" alt="image"><br><strong>最后形成贝塞尔曲面：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404120352291-514470948_1726324614867.png" alt="image"></p>
<h2 id="网格细分-Mesh-Subdivision"><a href="#网格细分-Mesh-Subdivision" class="headerlink" title="网格细分(Mesh Subdivision)"></a>网格细分(Mesh Subdivision)</h2><h3 id="一、Loop-Subdivision（发明人叫Loop和循环没关系）"><a href="#一、Loop-Subdivision（发明人叫Loop和循环没关系）" class="headerlink" title="一、Loop Subdivision（发明人叫Loop和循环没关系）"></a>一、Loop Subdivision（发明人叫Loop和循环没关系）</h3><h4 id="对新顶点"><a href="#对新顶点" class="headerlink" title="对新顶点"></a>对新顶点</h4><p><strong>通过提高三角形的数量来提高模型的质量，把一个三角形分成等大的四块三角形。对于一般情况添加的点来说它会由两三角形所共享，那么这个点就可以由已知的两个三角形所确定。具体就是取加权平均数。</strong></p>
<p>\[E&#x3D;\frac{3}{8}(A++B)+\frac{1}{8}(C+D) \]</p>
<p><strong>其中E点就在AB线段上，C、D就是两个三角形的另外两个顶点。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404194429206-1325605307_1726324633584.png" alt="image"></p>
<h4 id="对旧的顶点"><a href="#对旧的顶点" class="headerlink" title="对旧的顶点"></a>对旧的顶点</h4><p><strong>对于旧的顶点，参考周围的老的顶点，按照“度”（就是一个节点与周围的连线的数量）来进行加权平均，当然旧的点也需要参考自己的坐标。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404194826298-608227788_1726324633584.png" alt="image"><br><strong>其中 u 就是旧节点的度，这里是6。u 就是需要周围点的权值，参考度来生成。除去周围节点的权值，剩下的就是旧节点自己所占的权值了。</strong></p>
<h3 id="二、Catmull-Clark-Subdivision-General-Mesh"><a href="#二、Catmull-Clark-Subdivision-General-Mesh" class="headerlink" title="二、Catmull-Clark Subdivision(General Mesh)"></a>二、Catmull-Clark Subdivision(General Mesh)</h3><p><strong>Loop Subdivision只能处理三角形网格，Catmull则可以细分四边形网格。</strong></p>
<h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p><strong>Non-quad face——非四边形面</strong><br><strong>Extrordinary vertex(degree!&#x3D;4)——奇异点（度不等于4的点）</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404195707955-1284945440_1726324633584.png" alt="image"></p>
<h4 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h4><p><strong>在每一条边上取中电，每一个面上取中点，然后把这些点连起来，增加面密度。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404200142005-592999505_1726324633584.png" alt="image"><br><strong>经过一次操作，把所有的非四边形面变成了奇异点，使得所有的面都是四边形面，又因为非四边形面细分之后得到奇异点，所以在第一次细分之后不会再出现非四边形面。</strong></p>
<h4 id="点的更新"><a href="#点的更新" class="headerlink" title="点的更新"></a>点的更新</h4><h5 id="第一类：四边形中间的点-Face-Point"><a href="#第一类：四边形中间的点-Face-Point" class="headerlink" title="第一类：四边形中间的点(Face Point)"></a>第一类：四边形中间的点(Face Point)</h5><p><strong>直接取顶点的平均即可</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404201130766-1879211902_1726324633584.png" alt="image"></p>
<h5 id="第二类：在边上的点-Edge-Point"><a href="#第二类：在边上的点-Edge-Point" class="headerlink" title="第二类：在边上的点(Edge Point)"></a>第二类：在边上的点(Edge Point)</h5><p><strong>参照构成该边的两个点和附近两个区域的内点进行平均（无视图中的f ）</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404201131296-1917199397_1726324650205.png" alt="image"></p>
<h5 id="第三类：顶点-Vertex-Point"><a href="#第三类：顶点-Vertex-Point" class="headerlink" title="第三类：顶点(Vertex Point)"></a>第三类：顶点(Vertex Point)</h5><p><strong>使用周围的八个点和自身，进行加权平均计算</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404201137194-961881070_1726324650205.png" alt="image"></p>
<h2 id="网格简化-Mesh-Simplification"><a href="#网格简化-Mesh-Simplification" class="headerlink" title="网格简化(Mesh Simplification)"></a>网格简化(Mesh Simplification)</h2><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p><strong>Goal : reduce number of mesh elements while maintaining the overall shape.</strong><br><strong>在保证模型不走样的情况下，减少网格元素。</strong></p>
<h3 id="edge-collapsing-边塌缩"><a href="#edge-collapsing-边塌缩" class="headerlink" title="edge collapsing 边塌缩"></a>edge collapsing 边塌缩</h3><p><strong>边塌缩不是随便删除点就行，需要进行二次度量误差Quadric Error Metrics</strong></p>
<h4 id="Quadric-Error-Of-Edge-Collapse-二次度量误差"><a href="#Quadric-Error-Of-Edge-Collapse-二次度量误差" class="headerlink" title="Quadric Error Of Edge Collapse 二次度量误差"></a>Quadric Error Of Edge Collapse 二次度量误差</h4><p><strong>计算二次度量误差，给每一个边进行二次度量误差检查，给每一个边进行计算，得到一个二次度量误差。从二次度量误差最小的开始。然后每次塌缩最小的一条边，再更新被影响的边。</strong></p>
<h1 id="Shadows-阴影"><a href="#Shadows-阴影" class="headerlink" title="Shadows(阴影)"></a>Shadows(阴影)</h1><h2 id="Shadow-Mapping"><a href="#Shadow-Mapping" class="headerlink" title="Shadow Mapping"></a>Shadow Mapping</h2><p><strong>只能处理点光源</strong></p>
<h3 id="Key-idea-中心思想"><a href="#Key-idea-中心思想" class="headerlink" title="Key idea 中心思想"></a>Key idea 中心思想</h3><p><strong>如果一个点不在阴影里面，那么这个点可以被光源看到，也可以被相机看到。</strong></p>
<h4 id="Pass1-Render-from-Light-从光源进行光栅化"><a href="#Pass1-Render-from-Light-从光源进行光栅化" class="headerlink" title="Pass1 :Render from Light 从光源进行光栅化"></a>Pass1 :Render from Light 从光源进行光栅化</h4><p><strong>&gt;Depth image from light sourse 从光源进行光栅化，记录点的深度</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404204032301-321657898_1726324650205.png" alt="image"></p>
<h4 id="Pass2A-Render-from-eye"><a href="#Pass2A-Render-from-eye" class="headerlink" title="Pass2A:Render from eye"></a>Pass2A:Render from eye</h4><p><strong>从摄像机进行光栅化</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404204835108-1566699171_1726324650205.png" alt="image"></p>
<h4 id="Pass2B-Project-to-light"><a href="#Pass2B-Project-to-light" class="headerlink" title="Pass2B:Project to light"></a>Pass2B:Project to light</h4><p><strong>把摄像机中的点和这个点对于光源的深度和之前光源光栅化记录的深度进行比较，如果深度一样，说明这个点是可见的，可以被光源和摄像机同时看到。但是如果深度不一样，如图红色的深度是对于光源的深度，蓝色的深度是记录的深度，但深度大于记录的深度时，说明这个点无法被光照到。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404205013148-1468706654_1726324650205.png" alt="image"></p>
<h3 id="Problems-with-shadow-maps"><a href="#Problems-with-shadow-maps" class="headerlink" title="Problems with shadow maps"></a>Problems with shadow maps</h3><p><strong>shadow maps只能做硬阴影，也就是说阴影要么是黑，要么是白，但是现实生活中是软阴影，因为非点光源导致的影子是存在本影和伴影，所以Shadow maps 只能做点光源的阴影，但是不能做立体光源的阴影，也就是软阴影。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404210928547-689965799_1726324662912.png" alt="image"></p>
<h1 id="Ray-Tracing-光线追踪"><a href="#Ray-Tracing-光线追踪" class="headerlink" title="Ray Tracing 光线追踪"></a>Ray Tracing 光线追踪</h1><h2 id="Why-Ray-Tracing"><a href="#Why-Ray-Tracing" class="headerlink" title="Why Ray Tracing?"></a>Why Ray Tracing?</h2><p><strong>Rasterization could’t handle global effects well<br>光栅化不能很好的表现全局的效果</strong><br><strong>And especially when the light bounces more than once<br>光栅化无法很好的处理光线在场景中反射了不止一次的情况</strong><br><strong>(Soft)shadows 不能很好的表示和软阴影</strong><br><strong>Glossy reflection 光泽反射</strong><br><strong>indirect illumination 间接光照</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404212153195-1136159067_1726324662912.png" alt="image"><br><strong>光栅化在处理多次反射的时候会比较麻烦，而且不能保证物理上的正确性。相当于光珊化是一种快速的近似。而光线追踪是非常非常慢的，很真实的图形，一般用于离线，比如动画的渲染。</strong></p>
<h2 id="Basic-Ray-Tracing-Algorithm"><a href="#Basic-Ray-Tracing-Algorithm" class="headerlink" title="Basic Ray-Tracing Algorithm"></a>Basic Ray-Tracing Algorithm</h2><h3 id="Light-Rays-光线"><a href="#Light-Rays-光线" class="headerlink" title="Light Rays 光线"></a>Light Rays 光线</h3><p><strong>Three ideas about light rays</strong><br><strong>1.Light travels in straight lines 光线沿直线传播<br>2.Light rays do not “collide” with each other if they cross 光路互不干扰<br>(though are wrong)<br>3.Light rays travel from the light sources to the eye(光路可逆)</strong></p>
<h3 id="Ray-Casting-光线投射"><a href="#Ray-Casting-光线投射" class="headerlink" title="Ray Casting 光线投射"></a>Ray Casting 光线投射</h3><p><strong>1.Generate an image by casting one ray per pixel通过每像素投射一条光线来生成图像</strong><br><strong>2.Check for shadows by sending aray to the light通过向灯光发送光线来检查阴影</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404213634080-1644512687_1726324662912.png" alt="image"><br><strong>在光线投射中，记录每一根光线碰到的第一个物体closest scene，那么就完美的解决了深度测试的问题，不需要再考虑深度测试。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404214644843-1536928035_1726324662912.png" alt="image"><br><strong>找到一个交点之后，我们考虑这个点会不会被照亮，然后从这个点连一条线到光源，如果路径上没有阻挡，那么就可以说明这点被光照亮了，再利用法线进行着色Shading</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404215058882-1678221168_1726324662912.png" alt="image"><br><strong>这种方法光线还是只反射了一次。</strong></p>
<h3 id="Recursive-Whitted-Style-Ray-Tracing"><a href="#Recursive-Whitted-Style-Ray-Tracing" class="headerlink" title="Recursive(Whitted-Style) Ray Tracing"></a>Recursive(Whitted-Style) Ray Tracing</h3><p><strong>在光线投射的基础上，我们把从像素出发的点在碰到物体之后进行反射和折射。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404215638357-1153355011_1726324741943.jpg" alt="image"><br><strong>最后的着色则由各个点的着色的加权叠加组成，每一个点都需要计算它的shadow ray</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404220203692-491081183_1726324741943.jpg" alt="image"></p>
<h4 id="问题一：Ray-Surface-Intersection（交点）"><a href="#问题一：Ray-Surface-Intersection（交点）" class="headerlink" title="问题一：Ray-Surface Intersection（交点）"></a>问题一：Ray-Surface Intersection（交点）</h4><p><strong>Ray is defined by its origin and a directino vector<br>光线定义为一个起点和一个方向向量</strong><br><strong>光线的方程：</strong></p>
<p>\[Ray: r(t)&#x3D;o+td,0&lt;t&lt; \infty \]</p>
<h5 id="与最简单的图形球的交："><a href="#与最简单的图形球的交：" class="headerlink" title="与最简单的图形球的交："></a>与最简单的图形球的交：</h5><p><strong>球:</strong></p>
<p>\[p:(p-c)^2-R^2&#x3D;0 \]</p>
<p><strong>若相交，那么交点会满足两个方程，我们把光线的方程带入球的方程：</strong></p>
<p>\[(o+td-c)^2-R^2&#x3D;0 \]</p>
<p><strong>然后解时间t，需要满足：</strong><br><strong>1.t是正的<br>2.t不是虚数<br>3.t得是最小的</strong></p>
<h5 id="与隐式表面的交："><a href="#与隐式表面的交：" class="headerlink" title="与隐式表面的交："></a>与隐式表面的交：</h5><p><strong>隐式表面就是L:\(p:f(p)\)表示的一个方程<br>带入得到:</strong></p>
<p>\[f(o+td)&#x3D;0 \]</p>
<p><strong>同样的需要满足，t是正的，t不是虚数</strong><br><strong>目前的求根的方法已经很发达了，所以求根不是问题</strong></p>
<h4 id="怎么计算交点？"><a href="#怎么计算交点？" class="headerlink" title="怎么计算交点？"></a>怎么计算交点？</h4><p><strong>Simple idea:jusr intersect ray with each triangle<br>直接计算每一个三角形与光线是否相交。（很慢，但有效）</strong><br><strong>把问题分解为两个小的问题：<br>1.光线经不经过三角形所在平面<br>2.光线与平面的交点在不在三角形内</strong></p>
<h5 id="三角形所在平面"><a href="#三角形所在平面" class="headerlink" title="三角形所在平面"></a>三角形所在平面</h5><p><strong>点法式<br>平面方程为</strong></p>
<p>\[(P-P’)\cdot N&#x3D;0 \]</p>
<h5 id="求交点"><a href="#求交点" class="headerlink" title="求交点"></a>求交点</h5><p>简单的方法</p>
<p>\[(o+td-P’)\cdot N&#x3D;0 \]</p>
<p>\[t&#x3D;\frac{(P’ -o)\cdot N}{d\cdot N} \]</p>
<p><strong>Check:$0&lt;t&lt;\infty $</strong></p>
<h5 id="交点是不是在三角形内"><a href="#交点是不是在三角形内" class="headerlink" title="交点是不是在三角形内"></a>交点是不是在三角形内</h5><p><strong>交点与顶点构成的向量与边的向量进行叉乘</strong></p>
<p>快速的方法</p>
<h5 id="一步到位-Moller-Trumbore-Algorithm"><a href="#一步到位-Moller-Trumbore-Algorithm" class="headerlink" title="一步到位 Moller Trumbore Algorithm"></a>一步到位 Moller Trumbore Algorithm</h5><p><strong>其中\(\vec O+t\vec D\)就是光线的位置，如果在三角形内，那么一定可以用三角形的重心公式写出来，又这是三维向量，那么就是三个未知数，三个方程，可以直接解线性方程组，就能判断是否相交。甚至可以直接计算行列式来进行在否的判断，而不需要计算点的具体位置。用到克莱默法则</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230404224056612-1622881563_1726324741943.jpg" alt="image"></p>
<h4 id="问题二：加速求交（从三角形数量上）"><a href="#问题二：加速求交（从三角形数量上）" class="headerlink" title="问题二：加速求交（从三角形数量上）"></a>问题二：加速求交（从三角形数量上）</h4><h5 id="Bounding-Volumes-包围盒"><a href="#Bounding-Volumes-包围盒" class="headerlink" title="Bounding Volumes 包围盒"></a>Bounding Volumes 包围盒</h5><p><strong>1.Object is fully contained in the volume.<br>2.If it doesn’t hit the volume, it doesn’t hit the object.<br>3.So test BVol first, then test object if it hits.<br>如果碰不到包围盒，那么肯定碰不到物体，所以首先测试包围盒，如果能碰到包围盒，再测试物体本身。</strong></p>
<p><strong>Axis-Aligned Bounding Box，使用三个对面来唯一确定一个长方体，使用AABB来当作包围盒，与光线进行求交。在二维时候，对于两个对面，我们可以计算出光线进入面和出面的时间（可能为负数），把光线和经过的两个线段求交集，得到的就是光线进入和出去光线的路径。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230415203303290-1777157668_1726324741943.png" alt="image"><br><strong>拓展到三维：只有当光线进入了所有的三个对面后，再出某一个对面。也就是光线进入三个对面的时间都小于离开任意一个对面的时间。也就是最大的进入时间小于最小的离开时间时，说明光线进入了AABB。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230415203557343-697638646_1726324741943.png" alt="image"><br><strong>得到光线与AABB有交点：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230415204025133-259082333_1726324757389.png" alt="image"><br><strong>为什么使用AABB?计算简单</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230415204203806-874702992_1726324757389.png" alt="image"></p>
<h5 id="Preprocess-Build-Acceleration-Grid"><a href="#Preprocess-Build-Acceleration-Grid" class="headerlink" title="Preprocess - Build Acceleration Grid"></a>Preprocess - Build Acceleration Grid</h5><p><strong>通过画小网格，来细分包围盒。找出可能有物体（边缘）的格子，然后进行光线追踪。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230415205816943-335155476_1726324757389.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230415205943409-445354630_1726324757389.png" alt="image"><br><strong>那么对于划分格子也相当有技术，太稀疏和太密集都不太好，一般使用物体的数量乘以27（虽然没什么意义hh）</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417155520214-1087260474_1726324757389.png" alt="image"></p>
<h5 id="Spatial-Partitions"><a href="#Spatial-Partitions" class="headerlink" title="Spatial Partitions"></a>Spatial Partitions</h5><p><strong>空间划分，因为空旷的地方出现一个小的物体，会导致网格划分非常的低效。使用空间划分来解决这个问题。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417155855907-1138254026_1726324787053.png" alt="image"><br><strong>第一个是八叉树，进行细分，并且给一个停止细分的规则，比如格子中的物体数量小于某个数。但是八叉树的性质不好，因为细分度和维度呈几何次数上升。2 4 8</strong></p>
<p><strong>第二个是每一次只在格子里沿着某一个轴，进行划分，但是保证划分是交替出现，x\y\z。这么进行不会导致非常高的复杂度，而且保存了二叉树的原理。</strong></p>
<p><strong>第三个是BSP树，不满足AABB</strong></p>
<p><strong>我们主要学习KD-Tree</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417160746091-1602623499_1726324787053.png" alt="image"><br><strong>进行空间划分，但是对于左边的蓝也需要进行相同弄的操作。会形成一棵二叉树。实际的数据只存储在叶子节点上。进行计算时，首先对最大的包围盒进行计算：</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417161116330-1146040910_1726324787053.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417161230652-577072786_1726324787053.png" alt="image"><br><strong>发现光线和左边的叶子节点有交点，那么开始计算光线和左边包围盒中的物体进行求交。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417161438955-543348270_1726324787053.png" alt="image"><br><strong>然后继续搜索。计算所有和光线相交的叶子节点。</strong><br><strong>问题出现了，两个包围盒会同时包括一个物体，那么会产生极大的消耗。使用BVH（Bounding Volume Hierarchy）来解决这个问题。在KD的基础上，进行优化不再划分空间，而是对物体进行划分：把物体分为两堆，然后对物体堆进行包围盒的计算。</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417162452547-942305627_1726324800127.png" alt="image"><br><strong>但是BVH划分的包围盒存在相交，这也是另一个问题，但是比KD-Tree得到的划分更加的好。BVH的怎么划分就成了重要的问题。</strong><br><strong>BVH的划分：</strong><br><strong>把三角形进行排序，然后取中间的三角形进行划分，可以使得这个树更加的平衡，也就意味着树的深度可以达到最小。算法：</strong><br><strong>给一列n个的数，你要找第i大的数，你可以在o(k)进行处理（快速选择算法）。BVH的递归算法：（伪代码）</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417163919832-84045790_1726324800127.png" alt="image"><br><strong>KD-Tree与BVH</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230417164037206-1828217995_1726324800127.png" alt="image"></p>
<h2 id="Basic-radiometry-辐射度量学"><a href="#Basic-radiometry-辐射度量学" class="headerlink" title="Basic radiometry(辐射度量学)"></a>Basic radiometry(辐射度量学)</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-算法基础/快速读入模板" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/49493/" class="article-date">
      <time datetime="2023-03-18T19:59:00.000Z" itemprop="datePublished">2023-03-18</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/49493/">快速读入模板</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> New int</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> New <span class="title">read</span><span class="params">()</span><span class="comment">//快速读入</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	New X = <span class="number">0</span>, w = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> ch = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		w |= ch == <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">		ch = <span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		X = (X &lt;&lt; <span class="number">3</span>) + (X &lt;&lt; <span class="number">1</span>) + (ch ^ <span class="number">48</span>);</span><br><span class="line">		ch = <span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> w ? -X : X;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> F[<span class="number">200</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(New x)</span> <span class="comment">//快速输出</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	New tmp = x &gt; <span class="number">0</span> ? x : -x;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span> (tmp &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		F[cnt++] = tmp % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">		tmp /= <span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (cnt &gt; <span class="number">0</span>)</span><br><span class="line">		<span class="built_in">putchar</span>(F[--cnt]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Git 教程转载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/50901/" class="article-date">
      <time datetime="2023-02-16T12:55:00.000Z" itemprop="datePublished">2023-02-16</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/50901/">Git 教程转载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<p><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/896043488029600/897889638509536">https://www.liaoxuefeng.com/wiki/896043488029600/897889638509536</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/Linux/">Linux</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-算法基础/c语言文件读写" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/27853/" class="article-date">
      <time datetime="2023-02-16T11:18:00.000Z" itemprop="datePublished">2023-02-16</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/27853/">c语言文件读写</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="C语言文件读写"><a href="#C语言文件读写" class="headerlink" title="C语言文件读写"></a>C语言文件读写</h1><h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><h3 id="1-fseek-函数"><a href="#1-fseek-函数" class="headerlink" title="1.fseek()函数"></a>1.fseek()函数</h3><p><strong>此函数用于移动文件指针到指定位置。例如，要将文件指针移动到文件的第5个字节处，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fseek(fp, <span class="number">5</span>, SEEK_SET); <span class="comment">// 将文件指针移动到第5个字节</span></span><br></pre></td></tr></table></figure>

<p><strong>其中，第二个参数是移动的字节数，第三个参数指定移动的起始位置。</strong></p>
<h3 id="2-ftell-函数"><a href="#2-ftell-函数" class="headerlink" title="2.ftell()函数"></a>2.ftell()函数</h3><p><strong>此函数用于获取文件指针的当前位置。例如：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> pos;</span><br><span class="line">pos = ftell(fp); <span class="comment">// 获取当前位置</span></span><br></pre></td></tr></table></figure>

<p><strong>此函数返回一个长整型值，表示文件指针的当前位置。</strong></p>
<h3 id="3-freopen-函数"><a href="#3-freopen-函数" class="headerlink" title="3. freopen()函数"></a>3. freopen()函数</h3><p><strong>此函数用于重新打开文件，并将其关联到另一个文件流。例如，要将文件指针fp关联到一个名为”output.txt”的文件，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fp = freopen(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="built_in">stdout</span>); <span class="comment">// 将stdout（标准输出）关联到output.txt文件</span></span><br></pre></td></tr></table></figure>

<p><strong>此函数将文件指针fp重新打开，并将其与stdout流关联，以便将输出写入文件而不是控制台。</strong></p>
<h3 id="4-remove-函数"><a href="#4-remove-函数" class="headerlink" title="4. remove()函数"></a>4. remove()函数</h3><p><strong>此函数用于删除指定的文件。例如，要删除名为”example.txt”的文件，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remove(<span class="string">&quot;example.txt&quot;</span>); <span class="comment">// 删除文件</span></span><br></pre></td></tr></table></figure>

<h3 id="5-rename-函数"><a href="#5-rename-函数" class="headerlink" title="5.rename()函数"></a>5.rename()函数</h3><p><strong>此函数用于重命名文件。例如，要将名为”oldname.txt”的文件重命名为”newname.txt”，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename(<span class="string">&quot;oldname.txt&quot;</span>, <span class="string">&quot;newname.txt&quot;</span>); <span class="comment">// 重命名文件</span></span><br></pre></td></tr></table></figure>

<h3 id="6-temfile-函数"><a href="#6-temfile-函数" class="headerlink" title="6.temfile()函数"></a>6.temfile()函数</h3><p><strong>此函数用于创建一个临时文件。例如，要创建一个临时文件，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FILE *fp;</span><br><span class="line">fp = tmpfile(); <span class="comment">// 创建临时文件</span></span><br></pre></td></tr></table></figure>

<p><strong>该函数将创建一个二进制文件，并返回一个指向该文件的文件指针。当程序退出时，临时文件将自动被删除。</strong></p>
<h3 id="7-setbuf-函数"><a href="#7-setbuf-函数" class="headerlink" title="7.setbuf()函数"></a>7.setbuf()函数</h3><p><strong>此函数用于为文件流设置缓冲区。例如，要为文件指针fp设置一个8192字节的缓冲区，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buffer[<span class="number">8192</span>];</span><br><span class="line">setbuf(fp, buffer); <span class="comment">// 为文件流设置缓冲区</span></span><br></pre></td></tr></table></figure>

<h3 id="8-fflush-函数"><a href="#8-fflush-函数" class="headerlink" title="8.fflush()函数"></a>8.fflush()函数</h3><p><strong>此函数用于将缓冲区中的数据写入文件。例如，要将文件指针fp的缓冲区中的数据写入文件，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fflush(fp); <span class="comment">// 将缓冲区中的数据写入文件</span></span><br></pre></td></tr></table></figure>

<h2 id="文本文件"><a href="#文本文件" class="headerlink" title="文本文件"></a>文本文件</h2><h3 id="1-fopen-函数"><a href="#1-fopen-函数" class="headerlink" title="1. fopen()函数"></a>1. fopen()函数</h3><p><strong>此函数用于打开文件，并返回一个文件指针。您可以使用文件指针来读取或写入文件。例如，要打开一个名为”example.txt”的文件，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FILE *fp;</span><br><span class="line">fp = fopen(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;r&quot;</span>); <span class="comment">// 打开文件</span></span><br></pre></td></tr></table></figure>

<h3 id="2-fclose-函数"><a href="#2-fclose-函数" class="headerlink" title="2. fclose()函数"></a>2. fclose()函数</h3><p><strong>此函数用于关闭文件。当您完成对文件的操作时，应使用fclose()函数将其关闭。例如：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fclose(fp);<span class="comment">// 关闭文件</span></span><br></pre></td></tr></table></figure>

<h3 id="3-fgetc-函数"><a href="#3-fgetc-函数" class="headerlink" title="3. fgetc()函数"></a>3. fgetc()函数</h3><p><strong>此函数用于从文件中读取一个字符。例如：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> c;</span><br><span class="line">c = fgetc(fp); <span class="comment">// 读取一个字符</span></span><br></pre></td></tr></table></figure>

<h3 id="4-fputs-函数"><a href="#4-fputs-函数" class="headerlink" title="4. fputs()函数"></a>4. fputs()函数</h3><p><strong>此函数用于将一个字符写入文件。例如：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fputc(<span class="string">&#x27;A&#x27;</span>, fp); <span class="comment">// 将字符&#x27;A&#x27;写入文件</span></span><br></pre></td></tr></table></figure>

<h3 id="5-fgets-函数"><a href="#5-fgets-函数" class="headerlink" title="5. fgets()函数"></a>5. fgets()函数</h3><p><strong>此函数用于从文件中读取一行文本。例如：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buf[<span class="number">100</span>];</span><br><span class="line">fgets(buf, <span class="number">100</span>, fp); <span class="comment">// 读取一行文本</span></span><br></pre></td></tr></table></figure>

<h3 id="6-fputs-函数"><a href="#6-fputs-函数" class="headerlink" title="6. fputs()函数"></a>6. fputs()函数</h3><p><strong>此函数用于将一行文本写入文件。例如：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">fputs</span>(<span class="string">&quot;Hello, world!&quot;</span>, fp); <span class="comment">// 将一行文本写入文件</span></span><br></pre></td></tr></table></figure>

<h3 id="7-fprintf-函数"><a href="#7-fprintf-函数" class="headerlink" title="7.fprintf()函数"></a>7.fprintf()函数</h3><p><strong>此函数用于将格式化的文本写入文件。例如：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">fprintf</span>(fp, <span class="string">&quot;The value of x is %d&quot;</span>, x); <span class="comment">// 将格式化的文本写入文件</span></span><br></pre></td></tr></table></figure>

<h2 id="二进制文件"><a href="#二进制文件" class="headerlink" title="二进制文件"></a>二进制文件</h2><h3 id="1-fread-函数"><a href="#1-fread-函数" class="headerlink" title="1. fread()函数"></a>1. fread()函数</h3><p><strong>此函数用于从文件中读取一定数量的数据。例如，要从文件中读取10个整数，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> data[<span class="number">10</span>];</span><br><span class="line">fread(data, <span class="keyword">sizeof</span>(<span class="type">int</span>), <span class="number">10</span>, fp); <span class="comment">// 读取10个整数</span></span><br></pre></td></tr></table></figure>

<p><strong>其中，第一个参数是数据的存储位置，第二个参数是数据类型的大小，第三个参数是要读取的数据数量，第四个参数是文件指针。</strong></p>
<h3 id="2-fwrite-函数"><a href="#2-fwrite-函数" class="headerlink" title="2.fwrite()函数"></a>2.fwrite()函数</h3><p><strong>此函数用于将一定数量的数据写入文件。例如，要将10个整数写入文件，您可以使用以下代码：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> data[<span class="number">10</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line">fwrite(data, <span class="keyword">sizeof</span>(<span class="type">int</span>), <span class="number">10</span>, fp); <span class="comment">// 写入10个整数</span></span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-算法基础/康托展开" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/63067/" class="article-date">
      <time datetime="2023-02-03T19:40:00.000Z" itemprop="datePublished">2023-02-03</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/63067/">康托展开</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="康托展开"><a href="#康托展开" class="headerlink" title="康托展开"></a>康托展开</h1><h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释:"></a>名词解释:</h2><p><strong>康托展开是一个全排列到一个自然数的双射，常用于构建哈希表时的空间压缩。<br>-–康托展开的实质是计算当前排列在所有由小到大全排列中的顺序，因此是可逆的。</strong></p>
<h2 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h2><p>\(X &#x3D; a_{n}(n-1)!+a_{n-1}(n-2)!+… +a_{1} \times 0!\)<br>其中,\(a_i\) 为整数,并且\(0\leq a_{i}&lt;i,1\leq i\leq n\) 。<br>表示原数的第i位在当前未出现的元素中是排在第几个<br>康托展开的逆运算<br>既然康托展开是一个双射，那么一定可以通过康托展开值求出原排列，即可以求出n的全排列中第x大排列。<br>如n&#x3D;5,x&#x3D;96时：<br>首先用96-1得到95，说明x之前有95个排列.(将此数本身减去1)用95去除4! 得到3余23，说明有3个数比第1位小，所以第一位是4.用23去除3! 得到3余5，说明有3个数比第2位小，所以是4，但是4已出现过，因此是5.用5去除2!得到2余1，类似地，这一位是3.用1去除1!得到1余0，这一位是2.最后一位只能是1.所以这个数是45321。<br>按以上方法可以得出通用的算法。{^1}</p>
<h2 id="康托展开-1"><a href="#康托展开-1" class="headerlink" title="康托展开"></a>康托展开</h2><p>再举个例子说明。<br>在{\({1, 2, 3, 4,5}\)}5个数的排列组合中，计算\(34152\)的康托展开值。<br>首位是\(3\)，则小于\(3\)的数有两个，为\(1\)和\(2\)，\(a[5]&#x3D;2\)，则首位小于3的所有排列组合为\(a[5]\times (5-1)!\)<br>第二位是4，由于第一位小于\(4\),{\({1,2,3}\)}中一定会有\(1\)个充当第一位，所以排在\(4\)之下的只剩\(2\)个，所以其实计算的是在第二位之后小于\(4\)的个数。因此\(a[4]&#x3D;2\)。<br>第三位是1，则在其之后小于1的数有0个，所以\(a[3]&#x3D;0\)。<br>第四位是5，则在其之后小于5的数有1个，为2，所以\(a[2]&#x3D;1\)。<br>最后一位就不用计算啦，因为在它之后已经没有数了，所以\(a[1]\)固定为0<br>根据公式：</p>
<p>\[X&#x3D;2\times 4!+2\times 3!+0\times 2!+1\times 1!+0\times 0!&#x3D;61 \]</p>
<p>所以比34152小的组合有61个，即34152是排第62。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> factorial[]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">24</span>,<span class="number">120</span>,<span class="number">720</span>,<span class="number">5040</span>,<span class="number">40320</span>,<span class="number">362880</span>,<span class="number">3628800</span>&#125;;<span class="comment">//阶乘0-10</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cantor</span><span class="params">(<span class="type">int</span> a[],<span class="type">int</span> n)</span></span>&#123;<span class="comment">//cantor展开,n表示是n位的全排列，a[]表示全排列的数（用数组表示）</span></span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i<span class="number">+1</span>;j&lt;=n;j++)</span><br><span class="line">            <span class="keyword">if</span>(a[j]&lt;a[i])</span><br><span class="line">                sum++;</span><br><span class="line">        ans+=sum*factorial[n-i];<span class="comment">//累积</span></span><br><span class="line">        sum=<span class="number">0</span>;<span class="comment">//计数器归零</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans<span class="number">+1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> sb[<span class="number">12</span>],gs;</span><br><span class="line">    cin&gt;&gt;gs;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=gs;i++)</span><br><span class="line">        cin&gt;&gt;sb[i];</span><br><span class="line">    cout&lt;&lt;<span class="built_in">cantor</span>(sb,gs);<span class="comment">//输出该集合在全排列所在位置 </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="康托逆展开"><a href="#康托逆展开" class="headerlink" title="康托逆展开"></a>康托逆展开</h2><p>一开始已经提过了，康托展开是一个全排列到一个自然数的双射，因此是可逆的。即对于上述例子，在给出61可以算出起排列组合为34152。由上述的计算过程可以容易的逆推回来.</p>
<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> FAC[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">120</span>, <span class="number">720</span>, <span class="number">5040</span>, <span class="number">40320</span>, <span class="number">362880</span>&#125;;   <span class="comment">// 阶乘</span></span><br><span class="line"><span class="comment">//康托展开逆运算</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decantor</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v;  <span class="comment">// 存放当前可选数</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; a;  <span class="comment">// 所求排列组合</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        v.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> r = x % FAC[i<span class="number">-1</span>];</span><br><span class="line">        <span class="type">int</span> t = x / FAC[i<span class="number">-1</span>];</span><br><span class="line">        x = r;</span><br><span class="line">        <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>());<span class="comment">// 从小到大排序</span></span><br><span class="line">        a.<span class="built_in">push_back</span>(v[t]);      <span class="comment">// 剩余数里第t+1个数为当前位</span></span><br><span class="line">        v.<span class="built_in">erase</span>(v.<span class="built_in">begin</span>()+t);   <span class="comment">// 移除选做当前位的数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>就到这里啦!</strong></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-算法基础/P1088 [NOIP2004 普及组] 火星人" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/32280/" class="article-date">
      <time datetime="2023-02-03T19:09:00.000Z" itemprop="datePublished">2023-02-03</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/32280/">P1088 [NOIP2004 普及组] 火星人</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="NOIP2004-普及组-火星人"><a href="#NOIP2004-普及组-火星人" class="headerlink" title="[NOIP2004 普及组] 火星人"></a>[NOIP2004 普及组] 火星人</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>人类终于登上了火星的土地并且见到了神秘的火星人。人类和火星人都无法理解对方的语言，但是我们的科学家发明了一种用数字交流的方法。这种交流方法是这样的，首先，火星人把一个非常大的数字告诉人类科学家，科学家破解这个数字的含义后，再把一个很小的数字加到这个大数上面，把结果告诉火星人，作为人类的回答。</p>
<p>火星人用一种非常简单的方式来表示数字――掰手指。火星人只有一只手，但这只手上有成千上万的手指，这些手指排成一列，分别编号为 \(1,2,3,\cdots\)。火星人的任意两根手指都能随意交换位置，他们就是通过这方法计数的。</p>
<p>一个火星人用一个人类的手演示了如何用手指计数。如果把五根手指――拇指、食指、中指、无名指和小指分别编号为 \(1,2,3,4\) 和 \(5\)，当它们按正常顺序排列时，形成了 \(5\) 位数 \(12345\)，当你交换无名指和小指的位置时，会形成 \(5\) 位数 \(12354\)，当你把五个手指的顺序完全颠倒时，会形成 \(54321\)，在所有能够形成的 \(120\) 个 \(5\) 位数中，\(12345\) 最小，它表示 \(1\)；\(12354\) 第二小，它表示 \(2\)；\(54321\) 最大，它表示 \(120\)。下表展示了只有 \(3\) 根手指时能够形成的 \(6\) 个 \(3\) 位数和它们代表的数字：</p>
<table>
<thead>
<tr>
<th align="center">三进制数</th>
<th align="center">代表的数字</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\(123\)</td>
<td align="center">\(1\)</td>
</tr>
<tr>
<td align="center">\(132\)</td>
<td align="center">\(2\)</td>
</tr>
<tr>
<td align="center">\(213\)</td>
<td align="center">\(3\)</td>
</tr>
<tr>
<td align="center">\(231\)</td>
<td align="center">\(4\)</td>
</tr>
<tr>
<td align="center">\(312\)</td>
<td align="center">\(5\)</td>
</tr>
<tr>
<td align="center">\(321\)</td>
<td align="center">\(6\)</td>
</tr>
</tbody></table>
<p>现在你有幸成为了第一个和火星人交流的地球人。一个火星人会让你看他的手指，科学家会告诉你要加上去的很小的数。你的任务是，把火星人用手指表示的数与科学家告诉你的数相加，并根据相加的结果改变火星人手指的排列顺序。输入数据保证这个结果不会超出火星人手指能表示的范围。</p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>共三行。<br>第一行一个正整数 \(N\)，表示火星人手指的数目（\(1 \le N \le 10000\)）。<br>第二行是一个正整数 \(M\)，表示要加上去的小整数（\(1 \le M \le 100\)）。<br>下一行是 \(1\) 到 \(N\) 这 \(N\) 个整数的一个排列，用空格隔开，表示火星人手指的排列顺序。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>\(N\) 个整数，表示改变后的火星人手指的排列顺序。每两个相邻的数中间用一个空格分开，不能有多余的空格。</p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例 #1"></a>样例 #1</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入 #1"></a>样例输入 #1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">3</span><br><span class="line">1 2 3 4 5</span><br></pre></td></tr></table></figure>

<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出 #1"></a>样例输出 #1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 4 5 3</span><br></pre></td></tr></table></figure>

<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>对于 \(30\%\) 的数据，\(N \le 15\)。</p>
<p>对于 \(60\%\) 的数据，\(N \le 50\)。</p>
<p>对于 \(100\%\) 的数据，\(N \le 10000\)。</p>
<p>noip2004 普及组第 4 题</p>
<h2 id="这题可以用到康托展开-https-www-cnblogs-com-zhywyt-p-17090301-html-但是这里并不像展开说明康托展开-只把他当作一个理论基础来完成这个模拟题"><a href="#这题可以用到康托展开-https-www-cnblogs-com-zhywyt-p-17090301-html-但是这里并不像展开说明康托展开-只把他当作一个理论基础来完成这个模拟题" class="headerlink" title="这题可以用到康托展开-&gt;https://www.cnblogs.com/zhywyt/p/17090301.html,但是这里并不像展开说明康托展开,只把他当作一个理论基础来完成这个模拟题"></a>这题可以用到康托展开-&gt;<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17090301.html">https://www.cnblogs.com/zhywyt/p/17090301.html</a>,但是这里并不像展开说明康托展开,只把他当作一个理论基础来完成这个模拟题</h2><h2 id="由康托展开我们可以知道-康托展开的实质是计算当前排列在所有由小到大全排列中的顺序，因此是可逆的。-那么我们就可以先把外星人的排列映射成一个数的序列-这个序列是可以和自然数进行加减的-所以可以很方便的完成本题的要求"><a href="#由康托展开我们可以知道-康托展开的实质是计算当前排列在所有由小到大全排列中的顺序，因此是可逆的。-那么我们就可以先把外星人的排列映射成一个数的序列-这个序列是可以和自然数进行加减的-所以可以很方便的完成本题的要求" class="headerlink" title="由康托展开我们可以知道:康托展开的实质是计算当前排列在所有由小到大全排列中的顺序，因此是可逆的。,那么我们就可以先把外星人的排列映射成一个数的序列,这个序列是可以和自然数进行加减的,所以可以很方便的完成本题的要求."></a>由康托展开我们可以知道:康托展开的实质是计算当前排列在所有由小到大全排列中的顺序，因此是可逆的。,那么我们就可以先把外星人的排列映射成一个数的序列,这个序列是可以和自然数进行加减的,所以可以很方便的完成本题的要求.</h2><h2 id="映射方法"><a href="#映射方法" class="headerlink" title="映射方法:"></a>映射方法:</h2><p><strong>对于一个序列,比如\({1, 3, 2, 4, 5}\)</strong><br><strong>第一个数\(1\),是数列{\({1, 2, 3, 4, 5}\)}中的第一个,所对应的值就是\(0\)</strong><br><strong>第二个数\(3\),是数列{\({2, 3, 4, 5}\)}中的第二个,所对应的值也就是\(1\)</strong><br><strong>第三个数\(2\),是数列{\({2, 4, 5}\)}中的第一个,所对应的值也就是\(0\)</strong><br><strong>以此类推</strong><br><strong>得到最后的映射就是{\({0,1,0,0,0}\)}</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关于这个映射, 有一个和进制规则在里面: 从右往左, 序列的下标代表该位数字的进制, 比如这里的$1$, 就是4进制数, 所以这个序列代表的十进制数就是3.</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">序列长度 \(n&#x3D;5\)</th>
<th align="center"></th>
</tr>
</thead>
<tbody><tr>
<td align="center">映射序列数</td>
<td align="center">进制</td>
<td align="center">index</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">5</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">4</td>
</tr>
</tbody></table>
<p>所以代表的进制就等于\(n-index\)</p>
<h2 id="这样我们就有了-to-方法和-back-方法了"><a href="#这样我们就有了-to-方法和-back-方法了" class="headerlink" title="这样我们就有了\(to()\)方法和\(back()\)方法了!"></a>这样我们就有了\(to()\)方法和\(back()\)方法了!</h2><h3 id="to-方法"><a href="#to-方法" class="headerlink" title="\(to()\)方法"></a>\(to()\)方法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">to</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; n; j++)</span><br><span class="line">			<span class="keyword">if</span> (str[j] &lt; str[i])</span><br><span class="line">				sum++;</span><br><span class="line">		sav[i] = sum;</span><br><span class="line">		sum = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="back-方法"><a href="#back-方法" class="headerlink" title="\(back()\)方法"></a>\(back()\)方法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">back</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(via, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>) * n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (via[index])index++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; sav[i]; j++) &#123;</span><br><span class="line">			<span class="keyword">do</span> &#123;</span><br><span class="line">				index++;</span><br><span class="line">			&#125; <span class="keyword">while</span> (via[index]);</span><br><span class="line">		&#125;</span><br><span class="line">		via[index] = <span class="number">1</span>;</span><br><span class="line">		str[i] = index <span class="number">+1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>中途一个进位的小函数就不再复述了,没有什么难度.</strong><br><strong>最后奉上完整代码</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> str[<span class="number">10010</span>],sav[<span class="number">10010</span>];</span><br><span class="line"><span class="type">int</span> via[<span class="number">10010</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">back</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		cin &gt;&gt; str[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">to</span>();</span><br><span class="line">	sav[n - <span class="number">1</span>] += m;</span><br><span class="line">	<span class="type">int</span> jin = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		sav[n - i] += jin;</span><br><span class="line">		jin = sav[n - i] / i;</span><br><span class="line">		sav[n - i] %= i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">back</span>();</span><br><span class="line">	cout &lt;&lt; str[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; str[i];</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; n; j++)</span><br><span class="line">			<span class="keyword">if</span> (str[j] &lt; str[i])</span><br><span class="line">				sum++;</span><br><span class="line">		sav[i] = sum;</span><br><span class="line">		sum = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">back</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(via, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>) * n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (via[index])index++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; sav[i]; j++) &#123;</span><br><span class="line">			<span class="keyword">do</span> &#123;</span><br><span class="line">				index++;</span><br><span class="line">			&#125; <span class="keyword">while</span> (via[index]);</span><br><span class="line">		&#125;</span><br><span class="line">		via[index] = <span class="number">1</span>;</span><br><span class="line">		str[i] = index <span class="number">+1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/Yelee/page/7/">&laquo; Prev</a><a class="page-number" href="/Yelee/">1</a><span class="space">&hellip;</span><a class="page-number" href="/Yelee/page/6/">6</a><a class="page-number" href="/Yelee/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/Yelee/page/9/">9</a><a class="extend next" rel="next" href="/Yelee/page/9/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2025 zhywyt
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/Yelee/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>